<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>SuperSonic 分析文档</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	padding-inline-start: 0;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.page-description {
    margin-bottom: 2em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-default_background {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 237, 214, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-default_background {
	color: inherit;
	fill: inherit;
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 237, 214, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-uiBlue { background-color: rgba(35, 131, 226, .07); }
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-transparentGray { background-color: rgba(227, 226, 224, 0); }
.select-value-color-translucentGray { background-color: rgba(0, 0, 0, 0.06); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(249, 228, 188, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }
.select-value-color-pageGlass { background-color: undefined; }
.select-value-color-washGlass { background-color: undefined; }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="4c6b9ed8-7a81-46b7-8a51-419e54e7b612" class="page sans"><header><h1 class="page-title">SuperSonic 分析文档</h1><p class="page-description"></p></header><div class="page-body"><p id="99dff5b8-a82a-4054-ace6-7af313770891" class="">
</p><p id="0f37a46b-e42c-40d5-abf3-80588dc7db49" class="">作者：罗天成 </p><p id="c77fa947-2ac7-4864-9e3a-96588aa7f2dc" class="">日期：2024.08.15</p><p id="121a0385-9755-4cb4-a624-5437848e5de9" class="">
</p><nav id="38c2d468-9029-46de-bd83-e32487be35bb" class="block-color-gray table_of_contents"><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#564d9f3b-4c55-4778-88ee-e265e44ef7b0">1. 文档概述</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#a64a9e26-21c8-4970-a49d-983d7d08ef03">1.1 目的和范围</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#967363f8-6f60-4ffb-8caf-6697d273f53b">1.2 文档结构</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#a5b27e8d-da50-41c1-90f5-23f0ad3ec096">2. 项目背景</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#280e3484-8b9d-4ac8-8844-20fa159f5958">2.1 项目简介</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#6b554a56-7d36-406c-b03b-f034ce211c38">项目动机</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#93e9367e-ecf8-4bee-9a7b-b5dd32f5f597">开箱即用的特性</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#8f787a1d-24bf-4b4b-95d3-3467d049e5d8">2.2 项目资源</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#65db15fc-af36-4e44-8768-8e792d768a4c">项目地址</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#36350fe6-9176-4eb5-8ba9-ab5cb35114fb">项目DEMO</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#80292ea9-00fe-4f5e-992c-866ee42fd21d">官方文档</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#0abbfccd-b3d5-4462-a8be-3b27cd668001">相关社区</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#3d3b7f94-e053-415e-881d-af645bdf10df">相关资料</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#f362464a-25de-4b63-b9b2-efb2dd607469">3. 系统架构概述</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#d5808fb2-ba3d-4c19-94ef-7a8a3e4bbcba">3.1 整体架构</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#80309f08-16ed-4715-b76a-8e08b91cb34b">3.2 模块功能</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#307c9317-b9c4-4e5a-9419-e19dd005ee6f">4. 数据流分析</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#3a5c66dc-5f6c-49a8-97dc-4e13e856c7f6">4.1 数据流图</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#293910e4-12a4-41ff-9533-5d80075221ef">流程分析</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#c6542bac-1795-4a53-b1ce-f5f99cdeebd4">规则分析途径</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#eff34f1a-3277-4742-b66c-db168023ace0">大模型分析途径</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#2dc5f2f8-76d1-4474-8c5b-7dee03145e30">4.2 运行日志相关</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#0da7edc5-f25d-4afd-a17e-ac1343bfab82">标准日志参考</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#cac4d0e4-5bea-469f-9e94-9be22b8eb127">完整版日志分析</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#91daa91a-30be-4fca-81fc-e60d1724f404">整理版日志分析</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#696bcf62-c203-42ef-984a-1e4f93d4ef3b">4.3 数据处理流程分析</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#8fd357e2-429d-4bf7-a500-5cae87362a0d">输入搜索</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#3b2dd876-84bc-4ba8-aca9-ede6ad287d26">生成优化</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#6a57b1f7-8c7a-4568-b925-d7bc5db45859">Apache Calcite优化</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#60da6df7-5290-4741-b070-14e99b9c01d7">最终查询</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#bf81528b-c540-4ca5-8a6c-e3033d9f8397">缓存相关</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#5d99acd2-4602-4b7c-b53a-4feb87b95ff7">4.4  前后端交互（网络抓包）</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#bf1d0e52-542a-4c56-85de-4c87502d3d7a">抓包内容分析</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#c941d9c3-1a9b-40d7-872e-6068ee9ff185">4.5 LLM生成流程</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#db49a10b-8f12-4174-ab77-3f597436a78a">总结构：</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#9e7f9f0b-0bbe-484b-b131-98af9b68c156">提示词：</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#9c192e72-0a02-4320-9698-3ac1ca57c981">少样本提示+自一致性投票：</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#67219df9-fe50-4f15-b302-35ac8ae44e65">用户问题增强：</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#b8964a53-b893-448a-8e48-444940b27fbd">关键词映射：</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#b5e48ceb-deef-4487-9b61-a33dd08c28a3">寻问框架生成代码：</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#fb7fc505-8d9b-4ea1-bb62-eda0521d1fdf">4.6 数据存储与检索</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#6c65d501-c57c-41d8-b56b-36118f66bdfd">反复出现数据库查询示例</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#6b4cd0f9-b1c6-47aa-8548-7f7d932b3390">5. 代码分析</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#b3bd7a95-6437-4c9d-b7fe-a5ed06f0968a">5.1 源码结构</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#7e93c1a5-7ed2-4cf4-a276-270719da0c92">5.2 模块位置</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#c47643f7-f069-4de5-8843-3a31c936c464">5.3 模块依赖关系</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#ce57e276-8620-4663-a13c-316d72b91bed">6. 关键技术</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#de31e4ec-dedd-4c8f-9cc6-42182b4b876c">6.1 大模型相关技术</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#3e12cbef-c715-4b97-857a-b477e94b66e2">少样本提示：</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#f4a41d14-692c-462d-a2ad-8ee9876a0c16">自一致性：</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#f36bbb2f-2cf8-4678-b5cb-474fba1b1c7f">6.2 SQL解析框架 Apache Calcite</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#3eaa5121-20d4-432d-8170-0b1c78716c86">主要功能</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#56a4b8d0-a8d7-49d4-8902-b8d2f3536553">其他资料</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#35f06384-6ac3-4e3b-9525-7af8281064f6">6.3 大模型交互框架 langchain4j</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#438a50e9-082d-410b-9535-56ac4c0101c4">OPENAI协议样例（Supersonic使用）</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#4f60713f-d7a5-4ac7-9a5d-300e7527cb7b">可参考SQL交互库（包含Fewshot模板，源代码具有参考价值）</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#1a347d70-ed9e-4d9d-99d6-c38cb950e580">6.4 自动文档框架 Swagger </a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#29e522c9-c07f-405d-9f80-1dc570f2d27c">参考内容</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#ce9d89a3-39b7-434a-a0ac-3985e11931dc">导出</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#75372289-c070-4fd6-b3af-3e81b148824c">7. 测试和验证</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#a5d3ae20-05bc-44d7-aa16-6eb800323cb9">7.1 LLM配置验证</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#1f182e22-2847-44c0-b82e-4977a7dad66a">7.2 Mysql数据库验证</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#e9ea3236-2721-474d-9617-80194a2a41f9">7.3 大模型LLM输出验证</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#f488256d-1079-4299-96b7-ba64f8a28f2e">8. 常见问题与解决方案</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#1e34d064-3e45-489c-83ac-eb94e8deab0b">8.1 常见疑问</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#2ba9036f-f539-438f-9204-24f8de6d2973">官方FAQ?</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#29507826-5566-467e-aa11-4a88553de7d1">S2SQL歧义指正？</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#d40dc298-8179-422e-9b02-31fd4c92435a">项目中数据集指代什么？</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#83e081d7-326a-46bf-8c5e-9e2d11295b49">语义解析是什么？</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#992a40a4-702f-4bc5-af4f-47021d6fc076">一致性投票是如何进行的？</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#5661688f-f4ec-416f-843a-72cf7021c54f">8.2 故障排查</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#368f25cf-f214-4e98-bec9-60c8e5dc0af8">编译bug修正</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#52099e58-1149-4fa6-b0a1-a9cb8b8501bf">数据库连接bug修正</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#a9c64795-73d2-45d5-9537-3380d3bbc6ef">无影响-JWT报错</a></div></nav><p id="74f92c7e-760a-43d6-a9b6-358aa877347c" class="">
</p><h1 id="564d9f3b-4c55-4778-88ee-e265e44ef7b0" class="">1. 文档概述</h1><h2 id="a64a9e26-21c8-4970-a49d-983d7d08ef03" class="">1.1 目的和范围</h2><p id="34a8d1bd-f4f7-4486-9486-20a6411df7cb" class="">本文档旨在为SuperSonic项目提供全面的源码分析和数据流说明，帮助开发团队深入理解系统的内部工作机制。文档内容涵盖了系统架构、数据流动、关键代码结构、技术实现细节、测试与验证、以及开发建议等多个方面，确保开发团队能够快速上手并在工作中遵循最佳实践。</p><h2 id="967363f8-6f60-4ffb-8caf-6697d273f53b" class="">1.2 文档结构</h2><p id="0cd03afd-f1e2-409f-9daa-d442c6175d28" class="">本文档共分为8个主要部分，分别如下：</p><ol type="1" id="4f1faa74-e48c-4003-bea0-842bb0ba07cc" class="numbered-list" start="1"><li><strong>项目背景</strong>：介绍SuperSonic项目的基本信息，包括项目的背景、主要功能、及相关资源链接。</li></ol><ol type="1" id="9b0c94ab-c359-4e13-8fac-70104264a1f0" class="numbered-list" start="2"><li><strong>系统架构概述</strong>：提供系统的整体架构图，并解释各模块的功能及其相互关系。</li></ol><ol type="1" id="e55a0548-6f9f-454a-9df8-de09c16756ee" class="numbered-list" start="3"><li><strong>数据流分析</strong>：详细描述数据在系统中的流动过程，包括关键数据处理流程及数据存储与检索方式。</li></ol><ol type="1" id="4a411971-386b-4d4f-9697-9b80cb91035e" class="numbered-list" start="4"><li><strong>代码分析</strong>：分析项目源码结构，解释核心类和方法的设计及其相互关系。</li></ol><ol type="1" id="b6574520-eb16-430c-bbb8-23334853c8c3" class="numbered-list" start="5"><li><strong>关键技术</strong>：探讨系统中使用的核心技术和算法，并阐述性能优化的相关内容。</li></ol><ol type="1" id="85814859-2fbf-43e0-9718-5b43a2ef194e" class="numbered-list" start="6"><li><strong>测试和验证</strong>：介绍系统的测试框架、测试用例设计，以及性能测试与调优策略。</li></ol><ol type="1" id="8b0a2c6b-95af-4fea-8cf0-d810561df7cf" class="numbered-list" start="7"><li><strong>常见问题与解决方案</strong>：提供故障排查指南，帮助开发人员解决常见的系统问题。</li></ol><ol type="1" id="0148e43d-6a17-4a23-a855-127c48e0eedd" class="numbered-list" start="8"><li><strong>参考资料</strong>：列出文档中引用的所有资源及附录内容，提供额外的技术支持。</li></ol><p id="0cd1bfa9-211b-4de9-b3be-fdd913f9459b" class="">
</p><h1 id="a5b27e8d-da50-41c1-90f5-23f0ad3ec096" class="">2. 项目背景</h1><h2 id="280e3484-8b9d-4ac8-8844-20fa159f5958" class="">2.1 项目简介</h2><p id="2c735f16-7757-4a06-84d8-b2e14dab8ecb" class="">SuperSonic融合Chat BI（powered by LLM）和Headless BI（powered by 语义层）打造新一代的BI平台。这种融合确保了Chat BI能够与传统BI一样访问统一化治理的语义数据模型。此外，两种BI新范式都从中获得收益：</p><ul id="451f7198-cb4f-47c6-ad62-8f1cd4fecfab" class="bulleted-list"><li style="list-style-type:disc">Chat BI的Text2SQL生成通过检索语义数据模型得到增强。</li></ul><ul id="39633e47-0d71-4a69-84ca-c88241fc797a" class="bulleted-list"><li style="list-style-type:disc">Headless BI的查询接口通过支持自然语言API得到拓展。</li></ul><figure id="3023969c-ceee-4452-a2a5-62f19f7f58f9" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/image.png"><img style="width:1988px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/image.png"/></a></figure><p id="93e41365-8255-4238-82c2-f5314c74ef5c" class="">通过SuperSonic的问答对话界面，用户能够使用自然语言查询数据，系统会选择合适的可视化图表呈现结果。SuperSonic不需要修改或复制数据，只需要在物理数据模型之上构建逻辑语义模型（定义指标/维度/实体/标签，以及它们的业务含义、相互关系等），即可开启数据问答体验。与此同时，SuperSonic被设计为可插拔的框架，采用Java SPI机制来扩展定制功能。</p><figure id="de247b6c-77c5-437e-ad48-ef09de074bf1" class="image"><a href="https://github.com/supersonicbi/supersonic-website/raw/main/static/img/supersonic_demo.gif"><img style="width:700px" src="https://github.com/supersonicbi/supersonic-website/raw/main/static/img/supersonic_demo.gif"/></a></figure><h3 id="6b554a56-7d36-406c-b03b-f034ce211c38" class="">项目动机</h3><p id="e1716ebd-0093-4c0e-8ff4-04d955276b30" class="">大型语言模型（LLM）如ChatGPT的出现正在重塑信息检索的方式，引领数据分析领域的一种新范式，被称为Chat BI。为了实现Chat BI，学术界和工业界主要关注利用LLM的能力将自然语言转换为SQL，通常称为Text2SQL或NL2SQL。尽管一些方法显示出有希望的结果，但它们在大规模实际应用中的可靠性还不足。</p><p id="2c3376dc-d5e2-4a5c-aa4b-afc7d6c3adf1" class="">与此同时，另一种新兴范式被称为Headless BI，它专注于构建统一的语义数据模型，并引起了广泛的关注。Headless BI通过一个通用的语义层来实现，通过开放的API公开一致的数据语义。从我们的角度来看，Chat BI和Headless BI的融合有潜力在两个方面增强Text2SQL的能力：</p><ol type="1" id="6dadf276-d027-45e4-b57c-b14e67e65a88" class="numbered-list" start="1"><li>将数据语义（如业务术语、列值等）纳入提示词中，使LLM能够更好地理解语义，以减少幻觉。</li></ol><ol type="1" id="fed29a47-2442-4b89-9b9f-086a294494a8" class="numbered-list" start="2"><li>将高级SQL语法（如连接、公式等）的生成从LLM卸载到语义层，以减少复杂度。</li></ol><p id="4da25720-9c52-42cd-b8f4-1c91440c2b6d" class="">为了验证上述想法，我们开发了SuperSonic项目，并将其应用在实际的内部产品中。与此同时，我们将SuperSonic作为一个可扩展的框架开源，希望能够促进数据问答对话领域的进一步发展。</p><h3 id="93e9367e-ecf8-4bee-9a7b-b5dd32f5f597" class="">开箱即用的特性</h3><ul id="1788945d-9442-45d4-9e44-24a09af150ee" class="bulleted-list"><li style="list-style-type:disc">内置Chat BI界面以便<em>业务用户</em>输入数据查询。</li></ul><ul id="056ff788-7c46-40a4-8479-1fe872576844" class="bulleted-list"><li style="list-style-type:disc">内置Headless BI界面以便<em>分析工程师</em>构建语义模型。</li></ul><ul id="abf3f4ec-3490-41a8-a9fd-18322f08f2cf" class="bulleted-list"><li style="list-style-type:disc">内置基于规则的语义解析器，在特定场景（比如DEMO演示、集成测试）可以提升推理效率。</li></ul><ul id="e5139d85-e17f-4f31-983a-744d5913f3ae" class="bulleted-list"><li style="list-style-type:disc">支持文本输入联想、多轮对话、查询后问题推荐等高级特征。</li></ul><ul id="a689753f-33ee-4353-827c-97a87e6d50f7" class="bulleted-list"><li style="list-style-type:disc">支持三级权限控制：数据集级、列级、行级。</li></ul><h2 id="8f787a1d-24bf-4b4b-95d3-3467d049e5d8" class="">2.2 项目资源</h2><h3 id="65db15fc-af36-4e44-8768-8e792d768a4c" class="">项目地址</h3><figure id="f0269616-762c-4e0a-ba72-d017eaf95f88"><div class="source">https://github.com/tencentmusic/supersonic/blob/master/README.md</div></figure><h3 id="36350fe6-9176-4eb5-8ba9-ab5cb35114fb" class="">项目DEMO</h3><figure id="a74e6557-5de8-4553-9362-5d597ddbf960"><a href="http://117.72.46.148:9080/chat" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">http://117.72.46.148:9080/chat</div></div><div class="bookmark-href">http://117.72.46.148:9080/chat</div></div></a></figure><h3 id="80292ea9-00fe-4f5e-992c-866ee42fd21d" class="">官方文档</h3><figure id="f9b605aa-9248-49e9-969e-36c860cd58c9"><a href="https://supersonicbi.github.io/" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">项目介绍</div><div class="bookmark-description">项目介绍 # SuperSonic是融合Headless BI和Chat BI的新一代数据分析平台，致力于通过自然语言对话来分析数据，与传统交互的分析产品组合，推动数据民主化。SuperSonic提供两套开箱即用的产品界面： Headless BI界面，用于构建语义数据模型，并设置数据访问权限。 Chat BI界面，用于输入自然语言，并获得可视化的数据结果。 BI新范式融合 # 当前，BI领域分别在应用架构和产品交互两个层面兴起新的范式：一方面，随着数据应用和产品的百花齐放，Headless BI架构范式致力于构建与治理统一的语义数据模型，通过语义层Open API开放给消费端查询调用，以此提升数据复用，解决口径差异。另一方面，随着以ChatGPT为代表的大语言模型横空出世，Chat BI交互范式致力于通过大模型将自然语言转换成SQL语言，以此降低数据分析门槛。 SuperSonic主张通过两种BI新范式的融合，一方面让数据得到更好的治理与复用，另一方面让大模型更好地理解数据语义，最终使得两者皆受益： Headless BI的Query能力，通过自然语言API获得智能拓展。 Chat BI的Text2SQL能力，通过语义数据模型获得RAG增强。 项目社区建设 # 项目开源地址：https://github.com/tencentmusic/supersonic Playground地址：http://117.72.46.148:9080 微信公众号，不定期更新项目发版计划与通知，进入公众号后可获取用户交流群二维码。</div></div><div class="bookmark-href"><img src="https://supersonicbi.github.io/favicon.png" class="icon bookmark-icon"/>https://supersonicbi.github.io/</div></div></a></figure><h3 id="0abbfccd-b3d5-4462-a8be-3b27cd668001" class="">相关社区</h3><figure id="61210daa-dadf-4349-b932-b287df81bc27" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/image%201.png"><img style="width:336px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/image%201.png"/></a></figure><h3 id="3d3b7f94-e053-415e-881d-af645bdf10df" class="">相关资料</h3><figure id="f0ef26bb-ce1f-4ee6-b0bb-d6b0c693bf7a"><a href="https://www.cnblogs.com/tgzhu/p/17911526.html" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">SuperSonic简介 - 天戈朱 - 博客园</div><div class="bookmark-description">SuperSonic融合ChatBI和HeadlessBI打造新一代的数据分析平台。通过SuperSonic的问答对话界面，用户能够使用自然语言查询数据，系统会选择合适的可视化图表呈现结果。 SuperSonic不需要修改或复制数据，只需要在物理数据模型之上构建逻辑语义模型（指标/维度/实体的定义，</div></div><div class="bookmark-href"><img src="https://assets.cnblogs.com/favicon.svg?v=2" class="icon bookmark-icon"/>https://www.cnblogs.com/tgzhu/p/17911526.html</div></div></a></figure><h1 id="f362464a-25de-4b63-b9b2-efb2dd607469" class="">3. 系统架构概述</h1><h3 id="d5808fb2-ba3d-4c19-94ef-7a8a3e4bbcba" class="">3.1 整体架构</h3><p id="c0ec05c3-2800-4f42-b3d7-13d97170bcd1" class="">SuperSonic的整体架构和主流程如下图所示：</p><figure id="3c49d2a8-06f7-400f-8299-a2a693b22a02" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/image%202.png"><img style="width:672px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/image%202.png"/></a></figure><h2 id="80309f08-16ed-4715-b76a-8e08b91cb34b" class="">3.2 模块功能</h2><p id="8b9700e2-c82d-42dc-a584-0e165c3d7ee0" class="">每个模块的功能及其在系统中的角色。</p><ul id="5b485c49-dd8f-46af-8b26-1984cb613ed2" class="bulleted-list"><li style="list-style-type:disc"><strong>模型知识库</strong>(Knowledge Base)： 定期从语义模型中提取相关的模式信息，构建词典和索引，以便后续的模式映射。</li></ul><ul id="f7cc4f64-0798-4609-b28e-44da8e8f7d27" class="bulleted-list"><li style="list-style-type:disc"><strong>模式映射器(Schema Mapper)：</strong> 将自然语言文本在知识库中进行匹配，为后续的语义解析提供相关信息。</li></ul><ul id="fbba209c-aa12-438d-b079-ec7856c22483" class="bulleted-list"><li style="list-style-type:disc"><strong>语义解析器(Semantic Parser)：</strong> 理解用户查询并抽取语义信息，生成语义查询语句S2SQL。</li></ul><ul id="cbdab032-aac6-41ab-a7c4-1610b32526d1" class="bulleted-list"><li style="list-style-type:disc"><strong>语义修正器(Semantic Corrector)：</strong> 检查语义查询语句的合法性，对不合法的信息做修正和优化处理。</li></ul><ul id="33edeef2-a825-4362-bb79-9f714365dab5" class="bulleted-list"><li style="list-style-type:disc"><strong>语义翻译器(Semantic Translator)：</strong> 将语义查询语句翻译成可在物理数据模型上执行的SQL语句。</li></ul><ul id="23585c3f-5f40-45b1-8aab-e0a4319e171d" class="bulleted-list"><li style="list-style-type:disc"><strong>问答插件(Chat Plugin)：</strong> 通过第三方工具扩展功能。给定所有配置的插件及其功能描述和示例问题，大语言模型将选择最合适的插件。</li></ul><ul id="22ff2a01-355a-4dda-936f-9aa7f5d925bc" class="bulleted-list"><li style="list-style-type:disc"><strong>问答记忆(Chat Memory)：</strong> 将历史的查询轨迹进行封装，可被召回作为few-shot样例嵌入提示词。</li></ul><h1 id="307c9317-b9c4-4e5a-9419-e19dd005ee6f" class="">4. 数据流分析</h1><h2 id="3a5c66dc-5f6c-49a8-97dc-4e13e856c7f6" class="">4.1 数据流图</h2><p id="eb753c9f-4840-4c0f-8091-b7e71ebfb2e5" class="">项目数据流图，展示数据在系统中的流动路径，包括输入、处理、存储和输出的过程，基于原项目框架基础上构建：</p><figure id="e0c1b1cc-61ea-4bd3-8f74-50242b5f4e35" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/image%203.png"><img style="width:1200px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/image%203.png"/></a></figure><h3 id="293910e4-12a4-41ff-9533-5d80075221ef" class="">流程分析</h3><figure id="267b4d16-dfc2-44b2-8411-ad901ff50da7"><a href="https://supersonicbi.github.io/docs/chat-bi/问答对话/" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">SuperSonic</div><div class="bookmark-description">问答对话 # 进入问答对话后，我们会看到如下图所示页面；主要包括三部分：助理列表、输入模块、展示模块；现在对其进行详细说明； 1. 助理列表 # 智能助理可以理解为超音数一系列工具的集合, 如单个智能助理可以集成规则解析, LLM语义解析, 插件等多种工具和能力。而每个工具可指定模型范围（支持的view列表）和查询模型，用户可以根据自己需求定制化不同的智能助理； 默认会创建算指标、标签圈选助理；助理列表是将用户创建的助理都展示在此，方便用户进行助理间的切换； 2. 输入模块 # 输入模块主要包括文本输入框、会话管理两部分； 2.1. 文本输入框 # 顾名思义，可在此处进行自然语音交互；如果在助理设置中开启了联想，输入文本时会实时进行联想提示 实时联想原理： 先对文本进行分词 然后再进行并行分段探测 选取探测文本最长的、且有联想结果的那项进行返回 2.2. 会话管理 # 主要包括四个部分：新对话、历史对话、智能助理、showcase； 新对话，创建新的一轮对话；查询过的问题将按对话级别进行保存，后续多轮对话也是在对话基础之上进行； 历史对话，能够查询历史对话记录，包括曾经问过哪些问题以及查询结果；支持搜索、删除历史会话； 智能助理，对智能助理的管理，是否展示助理列表； showcase，通过对查询结果点赞功能加入至showcase，用于展示典型的查询case和问法； 3. 展示模块 # 展示模块主要四个部分：意图解析、SQL生成、数据查询、推荐相似问题；每部分都会记录耗时；如下图所示： 3.1. 意图解析 # 用于展示supersonic对输入文本的解析；parser阶段会生成多个解析结果，如上图生成2个解析，可点击切换解析结果； 为了让用户快速分析识别结果，解析内容目前包括：识别到的数据模型、查询模式、指标以及筛选条件等关键数据； 其中筛选条件可按需修改，如数据时间的灵活切换、切换其他维度值；修改条件后，点击重新查询即可； 3.2. SQL生成 # SQL生成展示按照解析类型分为两类，Rule解析、LLM解析； Rule解析：主要包括解析S2SQL、修正S2Sql、最终执行SQL; Rule解析S2SQL是通过按规则方式从文本中解析维度、维度值、指标等内容，构造成S2SQL；再经过修正操作生成修正S2SQL；Headless再将S2SQL解析成最终可在数据库引擎的执行SQL； LLM解析：在Rule解析基础上增加Schema映射、Few-shot示例信息；这两项是用于与大模型交互构造prompt，并生成S2SQL时使用到的信息； 3.3. 数据查询 # 主要功能是展示查询结果；根据返回结果的不同，前端灵活展示不同的样式； 结果中存在时间、指标，则展示指标趋势； 结果中只有一条数据则展示指标卡； 结果中存在多个维度、指标等，则按照表格进行展示； 注意 几点说明如下： 如果是指标模式，并且返回结果中存在指标，会进行指标的同环比计算，如上图； 如果是趋势图，可进行固定天数的时间范围切换；如近7天、近30天等；点击最右侧可进行切换； 指标和维度推荐；在查询结果下方，会展示推荐的维度和指标；点击指标，则整个查询会切换成该指标查询；点击维度，会按照该维度进行下钻查询； 4. 推荐相似问题 # 每次用户查询成功的问题会被记录下来，并按对话级别向量化存储到向量数据库；用于后续用户查询时召回相似问题使用；用户输入新问题时，使用输入文本按相似度召回已成功的问题，供用户选择；</div></div><div class="bookmark-href"><img src="https://supersonicbi.github.io/favicon.png" class="icon bookmark-icon"/>https://supersonicbi.github.io/docs/chat-bi/问答对话/</div></div></a></figure><h3 id="c6542bac-1795-4a53-b1ce-f5f99cdeebd4" class="">规则分析途径</h3><figure id="3ddf6ae2-c5ff-469b-b031-8fccc346347e" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled.png"><img style="width:480px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled.png"/></a></figure><p id="bb781e92-4b2c-4be8-880c-6840ae01e465" class="">依赖预定义规则，快速解析简单查询，适用于规则覆盖范围内的场景。</p><h3 id="eff34f1a-3277-4742-b66c-db168023ace0" class="">大模型分析途径</h3><figure id="94e7594a-7fa5-433e-9ab1-750a78df4236" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%201.png"><img style="width:933px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%201.png"/></a></figure><p id="2af1d4b2-e39a-4dd0-9572-8853b7e37111" class=""><div class="indented"><h3 id="1025ac72-b1cc-4c22-a390-204ccb2a9b9b" class="">1. Schema映射（提供prompt参考）</h3><ul id="c664a5f1-9271-4257-891a-a8f7977a7008" class="bulleted-list"><li style="list-style-type:disc"><strong>步骤</strong>：<ul id="dea857c7-3663-482b-b091-eb41ed34099b" class="bulleted-list"><li style="list-style-type:circle">用户提出自然语言查询，系统提取查询中的关键元素并映射到数据库的实际字段。</li></ul></li></ul><ul id="9d192287-2a8b-4a54-bce1-6d6d1ceb8522" class="bulleted-list"><li style="list-style-type:disc"><strong>实现</strong>：<ul id="624f6126-8b82-4644-9857-a35d57a2bb95" class="bulleted-list"><li style="list-style-type:circle">利用预先定义的Schema映射规则或模型，识别查询中的关键词并将其与数据库中的相应字段进行匹配。</li></ul></li></ul><ul id="3f342167-6a9e-4b7a-a93f-930fa54e316b" class="bulleted-list"><li style="list-style-type:disc"><strong>示例</strong>：<ul id="8218a9fd-34fe-4f14-ab88-49f1651ab5ca" class="bulleted-list"><li style="list-style-type:circle">查询：&quot;访问次数最高的前三个部门&quot;</li></ul><ul id="d8bf6ff2-4b10-4ffe-bb1d-1ebade992ea9" class="bulleted-list"><li style="list-style-type:circle">映射：<code>访问次数 -&gt; access_count</code>, <code>部门 -&gt; department</code></li></ul></li></ul><h3 id="2005af77-1e71-45a6-b93a-f1720ff50c34" class="">2. Few-shot示例（提供样本参考）</h3><figure id="30020420-e1bf-43db-aaea-750ab7c196c0"><a href="https://www.promptingguide.ai/zh/techniques/fewshot" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">少样本提示 – Nextra</div><div class="bookmark-description">A Comprehensive Overview of Prompt Engineering</div></div><div class="bookmark-href"><img src="https://www.promptingguide.ai/144-favicon.svg" class="icon bookmark-icon"/>https://www.promptingguide.ai/zh/techniques/fewshot</div></div></a></figure><ul id="2332ca62-2027-49f8-b239-5688d861b350" class="bulleted-list"><li style="list-style-type:disc"><strong>步骤</strong>：<ul id="136140af-3544-4608-81d0-1875997f9786" class="bulleted-list"><li style="list-style-type:circle">提供若干示例问题及其对应的SQL查询，帮助模型理解查询的结构和意图。</li></ul></li></ul><ul id="e0f1f364-8827-430c-bc0d-95dadc74f1d4" class="bulleted-list"><li style="list-style-type:disc"><strong>实现</strong>：<ul id="11220b18-ecc5-4a9c-a8a9-358cc11870d4" class="bulleted-list"><li style="list-style-type:circle">通过示例展示如何将自然语言问题转换为S2SQL语句，模型在训练过程中学习转换规则。</li></ul></li></ul><ul id="670544b4-6cbe-43d1-8931-4d4483ef0306" class="bulleted-list"><li style="list-style-type:disc"><strong>示例：</strong><ul id="1003561d-fd27-45cb-8904-c5385cd6e424" class="bulleted-list"><li style="list-style-type:circle">示例1: “近7天播放超过一千万的歌曲有哪些？”<ul id="c28a2c33-5d59-46d5-a45e-ef1718000aa5" class="bulleted-list"><li style="list-style-type:square">SQL: <code>SELECT song_name FROM songs WHERE play_count &gt; 10000000 AND date &gt;= &#x27;2024-07-03&#x27;</code></li></ul></li></ul><ul id="14318271-c572-4349-b5a1-077f82acb1aa" class="bulleted-list"><li style="list-style-type:circle">示例2: “超音数近30天访问次数的平均数”<ul id="07aaa182-2c62-4530-aa53-034ee8c329d5" class="bulleted-list"><li style="list-style-type:square">SQL: <code>SELECT AVG(access_count) FROM access_data WHERE datediff(day, date, &#x27;2024-07-10&#x27;) &lt;= 30</code></li></ul></li></ul></li></ul><ul id="c77fc208-fbab-4b87-8285-3e75b3534aba" class="bulleted-list"><li style="list-style-type:disc"><strong>作用：</strong><ul id="88e36cf3-9ad8-4743-9fcb-5fc757c0b1d9" class="bulleted-list"><li style="list-style-type:circle">“标签空间和演示指定的输入文本的分布都很重要（无论标签是否对单个输入正确）”</li></ul><ul id="10acb2c2-9dc7-44ec-b049-edd4b746c520" class="bulleted-list"><li style="list-style-type:circle">使用的格式也对性能起着关键作用，即使只是使用随机标签，这也比没有标签好得多。</li></ul><ul id="c55ce6f2-0105-4b48-b98f-ba1cf01477ea" class="bulleted-list"><li style="list-style-type:circle">其他结果表明，从真实标签分布（而不是均匀分布）中选择随机标签也有帮助。</li></ul></li></ul><h3 id="2565efba-29a0-440f-b660-0235007fcbd7" class="">3. LLM解析S2SQL（利用大模型学习模仿能力识别意图构建初步查询）</h3><ul id="0b6827bd-13e1-4673-8ee1-80684a5eba2e" class="bulleted-list"><li style="list-style-type:disc"><strong>步骤</strong>：<ul id="94b2c88d-4005-4663-a4b1-6279f6484f52" class="bulleted-list"><li style="list-style-type:circle">使用大语言模型（LLM）根据Few-shot示例生成初步的S2SQL查询。</li></ul></li></ul><ul id="a493d7cd-6862-4911-bcf4-911ee1da6531" class="bulleted-list"><li style="list-style-type:disc"><strong>实现</strong>：<ul id="e8ed4451-2acb-4035-9685-822426799c3e" class="bulleted-list"><li style="list-style-type:circle">利用预训练的大语言模型（如GPT-3）根据用户查询和示例生成S2SQL。</li></ul></li></ul><ul id="0c7930a4-5e3f-407d-8dab-fb317794c545" class="bulleted-list"><li style="list-style-type:disc"><strong>示例</strong>：<ul id="bd1c34dd-23c3-4d4b-9a92-6f561f79498a" class="bulleted-list"><li style="list-style-type:circle">用户查询：&quot;访问次数最高的前三个部门&quot;</li></ul><ul id="6e580d97-187f-4aed-a061-0308f73db588" class="bulleted-list"><li style="list-style-type:circle">初步SQL：<code>SELECT department FROM access_data ORDER BY access_count DESC LIMIT 3</code></li></ul></li></ul><h3 id="97580423-bf3c-4d91-8a26-d13f83a32aac" class="">4. 修正S2SQL（规则修正查询逻辑结构）</h3><ul id="59c3c045-9906-45fa-8e14-cb00e025d350" class="bulleted-list"><li style="list-style-type:disc"><strong>步骤</strong>：<ul id="4c9c60be-4cc6-4f65-8ae7-0314be2836ff" class="bulleted-list"><li style="list-style-type:circle">对初步生成的S2SQL进行语法和逻辑上的校正，确保其能够正确执行。</li></ul></li></ul><ul id="7b9ae39d-3574-463b-b8da-b4cc56aabdf4" class="bulleted-list"><li style="list-style-type:disc"><strong>实现</strong>：<ul id="17906ab7-9b7c-419c-b916-325e24910df7" class="bulleted-list"><li style="list-style-type:circle">利用规则或另一个模型对生成的SQL进行验证和校正，确保SQL语句逻辑正确。</li></ul></li></ul><ul id="66717b2c-caa4-44c6-b73b-f199e9d68a9d" class="bulleted-list"><li style="list-style-type:disc"><strong>示例</strong>：<ul id="3d041604-8067-4d7c-b474-2053ea29f078" class="bulleted-list"><li style="list-style-type:circle">修正后的SQL：<code>SELECT department, SUM(access_count) FROM access_data GROUP BY department ORDER BY SUM(access_count) DESC LIMIT 3</code></li></ul></li></ul><h3 id="8bf465d5-c417-48b0-818c-9ff15324cd3c" class="">5. 最终执行SQL（转换可执行SQL）</h3><ul id="4006b072-e600-4dcf-aaa3-a621b1bf4b01" class="bulleted-list"><li style="list-style-type:disc"><strong>步骤</strong>：<ul id="983c0931-50b4-48ba-890b-123602e71c79" class="bulleted-list"><li style="list-style-type:circle">使用headless转换S2SQL为可执行SQL，执行修正后的SQL查询，并返回结果。</li></ul></li></ul><ul id="0d3cc81e-d025-4e64-82fd-4e9238485112" class="bulleted-list"><li style="list-style-type:disc"><strong>实现</strong>：<ul id="a2f03712-7364-4120-8e30-90d7b9e22245" class="bulleted-list"><li style="list-style-type:circle">使用数据库连接执行校正后的SQL查询，并获取结果，结果通过前端展示给用户。</li></ul></li></ul><ul id="1ae9337d-47ff-45f7-b355-bc512ced77cd" class="bulleted-list"><li style="list-style-type:disc"><strong>示例</strong>：<ul id="8d9d36f7-57c8-4c40-ac3b-f3562f26608a" class="bulleted-list"><li style="list-style-type:circle">最终SQL：<code>WITH temp_table AS (SELECT department, access_count FROM access_data WHERE date = &#x27;2024-07-10&#x27;) SELECT department, SUM(access_count) FROM temp_table GROUP BY department ORDER BY SUM(access_count) DESC LIMIT 3</code></li></ul></li></ul></div></p><h2 id="2dc5f2f8-76d1-4474-8c5b-7dee03145e30" class="">4.2 运行日志相关</h2><h3 id="0da7edc5-f25d-4afd-a17e-ac1343bfab82" class="">标准日志参考</h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="2535e044-a9e2-4506-9fd7-900593cef5e0" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">14:25:10 [http-nio-9080-exec-7] INFO  c.t.s.h.s.f.s.i.RetrieveServiceImpl 307 - searchMetricAndDimension searchResults:[SearchResult(recommend=超音速对比所有部门得访问人数, subRecommend=访问人数, modelName=超音数数据集, modelId=1, schemaElementType=METRIC, isComplete=false), SearchResult(recommend=超音速对比所有部门得访问时长, subRecommend=访问时长, modelName=超音数数据集, modelId=1, schemaElementType=METRIC, isComplete=false), SearchResult(recommend=超音速对比所有部门得访问次数, subRecommend=访问次数, modelName=超音数数据集, modelId=1, schemaElementType=METRIC, isComplete=false), SearchResult(recommend=超音速对比所有部门得访问用户数, subRecommend=访问用户数, modelName=超音数数据集, modelId=1, schemaElementType=METRIC, isComplete=false)]
14:25:11 [http-nio-9080-exec-6] INFO  c.t.s.h.s.f.s.i.RetrieveServiceImpl 307 - searchMetricAndDimension searchResults:[SearchResult(recommend=超音速对比所有部门得访问次数, subRecommend=访问次数, modelName=超音数数据集, modelId=1, schemaElementType=METRIC, isComplete=false), SearchResult(recommend=超音速对比所有部门得人均访问次数, subRecommend=人均访问次数, modelName=超音数数据集, modelId=1, schemaElementType=METRIC, isComplete=false)]
14:25:15 [http-nio-9080-exec-4] INFO  c.t.s.h.s.f.s.i.RetrieveServiceImpl 307 - searchMetricAndDimension searchResults:[SearchResult(recommend=超音速对所有部门得访问次数, subRecommend=访问次数, modelName=超音数数据集, modelId=1, schemaElementType=METRIC, isComplete=false), SearchResult(recommend=超音速对所有部门得人均访问次数, subRecommend=人均访问次数, modelName=超音数数据集, modelId=1, schemaElementType=METRIC, isComplete=false)]
14:25:15 [http-nio-9080-exec-5] INFO  c.t.s.h.s.f.s.i.RetrieveServiceImpl 307 - searchMetricAndDimension searchResults:[SearchResult(recommend=超音速所有部门得访问次数, subRecommend=访问次数, modelName=超音数数据集, modelId=1, schemaElementType=METRIC, isComplete=false), SearchResult(recommend=超音速所有部门得人均访问次数, subRecommend=人均访问次数, modelName=超音数数据集, modelId=1, schemaElementType=METRIC, isComplete=false)]
14:25:18 [http-nio-9080-exec-2] INFO  c.t.s.h.s.f.s.i.RetrieveServiceImpl 307 - searchMetricAndDimension searchResults:[SearchResult(recommend=超音速所有部门的访问次数, subRecommend=访问次数, modelName=超音数数据集, modelId=1, schemaElementType=METRIC, isComplete=false), SearchResult(recommend=超音速所有部门的人均访问次数, subRecommend=人均访问次数, modelName=超音数数据集, modelId=1, schemaElementType=METRIC, isComplete=false)]
14:25:20 [http-nio-9080-exec-3] INFO  c.t.s.h.s.f.s.i.RetrieveServiceImpl 307 - searchMetricAndDimension searchResults:[SearchResult(recommend=对比超音速所有部门的访问次数, subRecommend=访问次数, modelName=超音数数据集, modelId=1, schemaElementType=METRIC, isComplete=false), SearchResult(recommend=对比超音速所有部门的人均访问次数, subRecommend=人均访问次数, modelName=超音数数据集, modelId=1, schemaElementType=METRIC, isComplete=false)]
14:25:21 [http-nio-9080-exec-9] INFO  c.t.s.h.chat.parser.llm.LLMSqlParser 38 - try generating query statement for dataSetId:1
14:25:21 [http-nio-9080-exec-9] INFO  c.t.s.h.chat.parser.llm.LLMSqlParser 58 - currentRetryRound:1, start runText2SQL
14:25:24 [http-nio-9080-exec-9] INFO  c.t.s.h.c.t.DefaultSemanticTranslator 78 - parse dataSetQuery [DataSetQueryParam(sql=SELECT department, SUM(pv) FROM t_1 WHERE sys_imp_date = &#x27;2024-08-05&#x27; GROUP BY department, tables=[MetricTable(alias=t_1, metrics=[pv], dimensions=[sys_imp_date, department], where=null, aggOption=OUTER)], supportWith=true, withAlias=true)] 
14:25:24 [http-nio-9080-exec-9] INFO  c.t.s.h.c.t.DefaultSemanticTranslator 125 - parse metricQuery [MetricQueryParam(metrics=[pv], dimensions=[sys_imp_date, department], where=null, limit=null, order=null, nativeQuery=true)] isAgg [OUTER]
14:25:24 [http-nio-9080-exec-9] INFO  c.t.s.h.c.t.c.s.node.DataSourceNode 204 - dataSourceMeasures [{user_department=0, s2_pv_uv_statis=1, s2_stay_time_statis=0}]
14:25:24 [http-nio-9080-exec-9] INFO  c.t.s.h.c.t.c.sql.render.JoinRender 110 - tableView (SELECT `user_name`, `department` AS `department` FROM (SELECT `user_name`, `department` FROM `s2_user_department`) AS `user_department`) AS `src00_user_department_19d9`
14:25:24 [http-nio-9080-exec-9] INFO  c.t.s.h.c.t.c.sql.render.JoinRender 110 - tableView (SELECT `pv` AS `s2_pv_uv_statis_pv`, `imp_date` AS `sys_imp_date`, `user_name`, `imp_date` AS `imp_date` FROM (SELECT `imp_date`, `user_name`, `page`, 1 AS `pv`, `user_name` AS `user_id` FROM `s2_pv_uv_statis`) AS `s2_pv_uv_statis`) AS `src00_s2_pv_uv_statis_541d`
14:25:24 [http-nio-9080-exec-9] INFO  c.t.s.h.c.t.DefaultSemanticTranslator 78 - parse dataSetQuery [DataSetQueryParam(sql=SELECT sys_imp_date, department, SUM(pv) AS pv FROM t_1 WHERE sys_imp_date &gt;= &#x27;2024-07-06&#x27; AND sys_imp_date &lt;= &#x27;2024-08-04&#x27; GROUP BY sys_imp_date, department LIMIT 365, tables=[MetricTable(alias=t_1, metrics=[pv], dimensions=[sys_imp_date, department], where=null, aggOption=OUTER)], supportWith=true, withAlias=true)] 
14:25:24 [http-nio-9080-exec-9] INFO  c.t.s.h.c.t.DefaultSemanticTranslator 125 - parse metricQuery [MetricQueryParam(metrics=[pv], dimensions=[sys_imp_date, department], where=null, limit=null, order=null, nativeQuery=true)] isAgg [OUTER]
14:25:24 [http-nio-9080-exec-9] INFO  c.t.s.h.c.t.c.s.node.DataSourceNode 204 - dataSourceMeasures [{user_department=0, s2_pv_uv_statis=1, s2_stay_time_statis=0}]
14:25:24 [http-nio-9080-exec-9] INFO  c.t.s.h.c.t.c.sql.render.JoinRender 110 - tableView (SELECT `user_name`, `department` AS `department` FROM (SELECT `user_name`, `department` FROM `s2_user_department`) AS `user_department`) AS `src00_user_department_9445`
14:25:24 [http-nio-9080-exec-9] INFO  c.t.s.h.c.t.c.sql.render.JoinRender 110 - tableView (SELECT `pv` AS `s2_pv_uv_statis_pv`, `imp_date` AS `sys_imp_date`, `user_name`, `imp_date` AS `imp_date` FROM (SELECT `imp_date`, `user_name`, `page`, 1 AS `pv`, `user_name` AS `user_id` FROM `s2_pv_uv_statis`) AS `s2_pv_uv_statis`) AS `src00_s2_pv_uv_statis_864f`
14:25:24 [http-nio-9080-exec-9] INFO  c.t.s.h.c.t.DefaultSemanticTranslator 78 - parse dataSetQuery [DataSetQueryParam(sql=SELECT sys_imp_date, SUM(pv) AS pv FROM t_1 WHERE sys_imp_date &gt;= &#x27;2024-07-06&#x27; AND sys_imp_date &lt;= &#x27;2024-08-04&#x27; GROUP BY sys_imp_date LIMIT 365, tables=[MetricTable(alias=t_1, metrics=[pv], dimensions=[sys_imp_date], where=null, aggOption=OUTER)], supportWith=true, withAlias=true)] 
14:25:24 [http-nio-9080-exec-9] INFO  c.t.s.h.c.t.DefaultSemanticTranslator 125 - parse metricQuery [MetricQueryParam(metrics=[pv], dimensions=[sys_imp_date], where=null, limit=null, order=null, nativeQuery=true)] isAgg [OUTER]
14:25:24 [http-nio-9080-exec-9] INFO  c.t.s.h.c.t.c.s.node.DataSourceNode 204 - dataSourceMeasures [{user_department=0, s2_pv_uv_statis=1, s2_stay_time_statis=0}]
14:25:24 [http-nio-9080-exec-10] INFO  c.t.s.h.s.f.s.i.S2SemanticLayerService 106 - [queryReq:QuerySqlReq(sql=SELECT 部门, SUM(访问次数) FROM 超音数数据集 WHERE 数据日期 = &#x27;2024-08-05&#x27; GROUP BY 部门, limit=1000)]
14:25:24 [http-nio-9080-exec-10] INFO  c.t.s.h.core.cache.DefaultQueryCache 21 - query from cache, key:supersonic:dev:0:-1:1b3447fa75077e32c5e80f48133ba16d
14:25:24 [http-nio-9080-exec-10] INFO  c.t.s.h.core.executor.JdbcExecutor 41 - executing SQL: with t_1 as (SELECT `t3`.`sys_imp_date`, `t2`.`department`, `t3`.`s2_pv_uv_statis_pv` AS `pv` FROM (SELECT `user_name`, `department` FROM s2_user_department) AS `t2` LEFT JOIN (SELECT 1 AS `s2_pv_uv_statis_pv`, `imp_date` AS `sys_imp_date`, `user_name`, `imp_date` FROM s2_pv_uv_statis) AS `t3` ON `t2`.`user_name` = `t3`.`user_name`) SELECT department, SUM(pv) FROM t_1 WHERE sys_imp_date = &#x27;2024-08-05&#x27; GROUP BY department limit 1000
</code></pre><h3 id="cac4d0e4-5bea-469f-9e94-9be22b8eb127" class="">完整版日志分析</h3><figure id="7d7737e9-e8b7-4047-b258-5e42c3fadcbc" class="link-to-page"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/%E5%AE%8C%E6%95%B4%E8%AF%A6%E7%BB%86%E6%97%A5%E5%BF%97%207d7737e9e8b74047b2585e42c3fadcbc.html">完整详细日志</a></figure><h3 id="91daa91a-30be-4fca-81fc-e60d1724f404" class="">整理版日志分析</h3><figure id="1f2a4b7e-2465-427c-8d52-ed4b8a3fdba3" class="link-to-page"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/%E6%95%B4%E7%90%86%E7%89%88%E6%97%A5%E5%BF%97%201f2a4b7e2465427c8d52ed4b8a3fdba3.html">整理版日志</a></figure><h2 id="696bcf62-c203-42ef-984a-1e4f93d4ef3b" class="">4.3 数据处理流程分析</h2><p id="4df4e653-9701-48ae-91a8-0849e6c3f7c0" class="">仅含主干分析，描述主要的数据处理流程，涉及的模块和类，以及数据如何在各个流程中传递和转换。</p><p id="19be985e-e5dc-425a-abf0-1cd913549f13" class="">详细分析见上述《完整版日志分析》以及《整理版日志分析》。</p><h3 id="8fd357e2-429d-4bf7-a500-5cae87362a0d" class="">输入搜索</h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="e0cf24d3-a01c-4d64-9762-7034ed3f7b71" class="code"><code class="language-CSS" style="white-space:pre-wrap;word-break:break-all">输入：

“超音速对比所有人访问次数”


输出：

searchResults:[SearchResult(recommend=超音速对比所有人访问人数, subRecommend=访问人数, modelName=超音数数据集, modelId=1, schemaElementType=METRIC, isComplete=false), SearchResult(recommend=超音速对比所有人访问时长, subRecommend=访问时长, modelName=超音数数据集, modelId=1, schemaElementType=METRIC, isComplete=false), SearchResult(recommend=超音速对比所有人访问次数, subRecommend=访问次数, modelName=超音数数据集, modelId=1, schemaElementType=METRIC, isComplete=false), SearchResult(recommend=超音速对比所有人访问用户数, subRecommend=访问用户数, modelName=超音数数据集, modelId=1, schemaElementType=METRIC, isComplete=false)]

possibleDataSets:[1],natureToNameMap:{_1_3_metric=访问人数, _1_2_metric=访问时长, _1_1_metric=访问次数}</code></pre><figure id="9e35186b-c1ca-4ab8-a75e-1b213d333926" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/image%204.png"><img style="width:624px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/image%204.png"/></a></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="6db756d5-33f0-4c10-a3d6-c15d2c32cb44" class="code"><code class="language-CSS" style="white-space:pre-wrap;word-break:break-all">14:56:57 [http-nio-9080-exec-10] DEBUG c.t.s.h.s.f.s.i.RetrieveServiceImpl 103 - searchTextEntry:MatchText(regText=超音速对比所有, detectSegment=人)=[HanlpMapResult(natures=[_1_4_metric], offset=0, similarity=0.0)],queryReq:QueryReq(queryText=超音速对比所有人, chatId=1, dataSetIds=[], user=User(id=6, name=admin, displayName=admin, email=null, isAdmin=1), queryFilters=null, saveAnswer=true, text2SQLType=RULE_AND_LLM, mapModeEnum=STRICT, mapInfo=com.tencent.supersonic.headless.api.pojo.SchemaMapInfo@2b14a3bd, queryDataType=ALL, llmConfig=LLMConfig(provider=OPEN_AI, baseUrl=https://api.openai.com/v1, apiKey=kGA4i6jY7QqG5xH+S0N++SzVWVKyAHesOq7NpoFVI7pgU14eb1AM296OFiLJTNtDVfpWDpfu7o4vDG2C2yWiSA==, modelName=gpt-3.5-turbo, temperature=0.0, timeOut=60), exemplars=[])
14:56:57 [http-nio-9080-exec-10] DEBUG c.t.s.h.s.f.s.i.RetrieveServiceImpl 140 - possibleDataSets:[],dataSetInfoStat:DataSetInfoStat(dataSetCount=0, metricDataSetCount=0, dimensionDataSetCount=0, dimensionValueDataSetCount=0),contextModel:1
14:56:57 [http-nio-9080-exec-10] DEBUG c.t.s.h.s.f.s.i.RetrieveServiceImpl 276 - searchMetricAndDimension searchTextEntry:MatchText(regText=超音速对比所有, detectSegment=人)=[HanlpMapResult(natures=[_1_4_metric], offset=0, similarity=0.0)]
14:56:57 [http-nio-9080-exec-10] DEBUG c.t.s.h.s.f.s.i.RetrieveServiceImpl 304 - parseResult:HanlpMapResult(natures=[_1_4_metric], offset=0, similarity=0.0),dimensionMetricClassIds:[ModelWithSemanticType(model=1, schemaElementType=METRIC)],possibleDataSets:[1]
14:56:57 [http-nio-9080-exec-10] INFO  c.t.s.h.s.f.s.i.RetrieveServiceImpl 307 - searchMetricAndDimension searchResults:[SearchResult(recommend=超音速对比所有人均访问次数, subRecommend=人均访问次数, modelName=超音数数据集, modelId=1, schemaElementType=METRIC, isComplete=false)]
14:56:57 [http-nio-9080-exec-10] DEBUG c.t.s.h.s.f.s.i.RetrieveServiceImpl 117 - possibleDataSets:[1],natureToNameMap:{_1_4_metric=人均访问次数}

14:56:59 [http-nio-9080-exec-3] DEBUG c.t.s.h.s.f.s.i.RetrieveServiceImpl 103 - searchTextEntry:MatchText(regText=超音速对比所有人, detectSegment=访问)=[HanlpMapResult(natures=[_1_3_metric], offset=0, similarity=0.0), HanlpMapResult(natures=[_1_2_metric], offset=0, similarity=0.0), HanlpMapResult(natures=[_1_1_metric], offset=0, similarity=0.0), HanlpMapResult(natures=[_1_3_metric], offset=0, similarity=0.0)],queryReq:QueryReq(queryText=超音速对比所有人访问, chatId=1, dataSetIds=[], user=User(id=6, name=admin, displayName=admin, email=null, isAdmin=1), queryFilters=null, saveAnswer=true, text2SQLType=RULE_AND_LLM, mapModeEnum=STRICT, mapInfo=com.tencent.supersonic.headless.api.pojo.SchemaMapInfo@36caf6e9, queryDataType=ALL, llmConfig=LLMConfig(provider=OPEN_AI, baseUrl=https://api.openai.com/v1, apiKey=kGA4i6jY7QqG5xH+S0N++SzVWVKyAHesOq7NpoFVI7pgU14eb1AM296OFiLJTNtDVfpWDpfu7o4vDG2C2yWiSA==, modelName=gpt-3.5-turbo, temperature=0.0, timeOut=60), exemplars=[])
14:56:59 [http-nio-9080-exec-3] DEBUG c.t.s.h.s.f.s.i.RetrieveServiceImpl 140 - possibleDataSets:[],dataSetInfoStat:DataSetInfoStat(dataSetCount=0, metricDataSetCount=0, dimensionDataSetCount=0, dimensionValueDataSetCount=0),contextModel:1
14:56:59 [http-nio-9080-exec-3] DEBUG c.t.s.h.s.f.s.i.RetrieveServiceImpl 276 - searchMetricAndDimension searchTextEntry:MatchText(regText=超音速对比所有人, detectSegment=访问)=[HanlpMapResult(natures=[_1_3_metric], offset=0, similarity=0.0), HanlpMapResult(natures=[_1_2_metric], offset=0, similarity=0.0), HanlpMapResult(natures=[_1_1_metric], offset=0, similarity=0.0), HanlpMapResult(natures=[_1_3_metric], offset=0, similarity=0.0)]
14:56:59 [http-nio-9080-exec-3] DEBUG c.t.s.h.s.f.s.i.RetrieveServiceImpl 304 - parseResult:HanlpMapResult(natures=[_1_3_metric], offset=0, similarity=0.0),dimensionMetricClassIds:[ModelWithSemanticType(model=1, schemaElementType=METRIC)],possibleDataSets:[1]
14:56:59 [http-nio-9080-exec-3] DEBUG c.t.s.h.s.f.s.i.RetrieveServiceImpl 304 - parseResult:HanlpMapResult(natures=[_1_2_metric], offset=0, similarity=0.0),dimensionMetricClassIds:[ModelWithSemanticType(model=1, schemaElementType=METRIC)],possibleDataSets:[1]
14:56:59 [http-nio-9080-exec-3] DEBUG c.t.s.h.s.f.s.i.RetrieveServiceImpl 304 - parseResult:HanlpMapResult(natures=[_1_1_metric], offset=0, similarity=0.0),dimensionMetricClassIds:[ModelWithSemanticType(model=1, schemaElementType=METRIC)],possibleDataSets:[1]
14:56:59 [http-nio-9080-exec-3] DEBUG c.t.s.h.s.f.s.i.RetrieveServiceImpl 304 - parseResult:HanlpMapResult(natures=[_1_3_metric], offset=0, similarity=0.0),dimensionMetricClassIds:[ModelWithSemanticType(model=1, schemaElementType=METRIC)],possibleDataSets:[1]
14:56:59 [http-nio-9080-exec-3] INFO  c.t.s.h.s.f.s.i.RetrieveServiceImpl 307 - searchMetricAndDimension searchResults:[SearchResult(recommend=超音速对比所有人访问人数, subRecommend=访问人数, modelName=超音数数据集, modelId=1, schemaElementType=METRIC, isComplete=false), SearchResult(recommend=超音速对比所有人访问时长, subRecommend=访问时长, modelName=超音数数据集, modelId=1, schemaElementType=METRIC, isComplete=false), SearchResult(recommend=超音速对比所有人访问次数, subRecommend=访问次数, modelName=超音数数据集, modelId=1, schemaElementType=METRIC, isComplete=false), SearchResult(recommend=超音速对比所有人访问用户数, subRecommend=访问用户数, modelName=超音数数据集, modelId=1, schemaElementType=METRIC, isComplete=false)]
14:56:59 [http-nio-9080-exec-3] DEBUG c.t.s.h.s.f.s.i.RetrieveServiceImpl 117 - possibleDataSets:[1],natureToNameMap:{_1_3_metric=访问人数, _1_2_metric=访问时长, _1_1_metric=访问次数}
</code></pre><p id="57ea5cbc-1171-4803-b7cd-d25a4ab39275" class="">对于输入语句进行实时分割，然后进行关键词（数据集、表、指标）查询匹配，给出实时推荐</p><figure id="e2beb119-ba38-4969-8912-622e75c8a5bd" class="link-to-page"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/RetrieveServiceImpl%20e2beb119ba3849698912622e75c8a5bd.html">RetrieveServiceImpl</a></figure><p id="f0e8e63f-4b14-49f8-85d5-4847c63ba215" class="">
</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="d2d89ed2-ed41-4cdb-bd96-ebf4f23bc75d" class="code"><code class="language-JSON" style="white-space:pre-wrap;word-break:break-all">14:57:00 [scheduling-1] DEBUG c.t.s.h.s.task.DictionaryReloadTask 39 - reloadKnowledge start
14:57:00 [scheduling-1] DEBUG c.t.s.h.s.w.s.impl.DictWordService 69 - nature type:DIMENSION , nature size:15
14:57:00 [scheduling-1] DEBUG c.t.s.h.s.w.s.impl.DictWordService 69 - nature type:METRIC , nature size:18
14:57:00 [scheduling-1] DEBUG c.t.s.h.s.w.s.impl.DictWordService 69 - nature type:ENTITY , nature size:4
14:57:00 [scheduling-1] DEBUG c.t.s.h.s.w.s.impl.DictWordService 69 - nature type:VALUE , nature size:0
14:57:00 [scheduling-1] DEBUG c.t.s.h.s.w.s.impl.DictWordService 69 - nature type:TERM , nature size:6
14:57:00 [scheduling-1] DEBUG c.t.s.h.s.w.s.impl.DictWordService 44 - Dictionary hasn&#x27;t been reloaded.
14:57:00 [scheduling-1] DEBUG c.t.s.h.s.task.DictionaryReloadTask 45 - reloadKnowledge end
</code></pre><figure id="72f9854b-1a46-46b3-ad3d-4f933c641c18" class="link-to-page"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/DictWordService%2072f9854b1a4646b3ad3d4f933c641c18.html">DictWordService </a></figure><p id="a1311db1-2b06-46a8-b555-d58de3fe5272" class="">统计不同类别的词性数量，包括维度（DIMENSION，数量为15）、度量（METRIC，数量为18）、实体（ENTITY，数量为4）、值（VALUE，数量为0）、术语（TERM，数量为6），检查知识库更新</p><p id="653abe49-5bb4-44e9-9418-b3bd30fc34dc" class="">
</p><p id="97a7cd15-3533-44a2-bfcb-61c59c0935d1" class="">
</p><h3 id="3b2dd876-84bc-4ba8-aca9-ede6ad287d26" class="">生成优化</h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1c4c47d7-cfc7-428b-85d2-c26a7f57756c" class="code"><code class="language-CSS" style="white-space:pre-wrap;word-break:break-all">输入：

“超音速对比所有人访问次数”


输出：

SELECT SUM(访问次数) FROM 超音数数据集

SELECT SUM(访问次数) FROM 超音数数据集 WHERE (数据日期 &gt;= &#x27;2024-07-31&#x27; AND 数据日期 &lt;= &#x27;2024-08-06&#x27;)

SELECT SUM(pv) FROM t_1 WHERE (sys_imp_date &gt;= &#x27;2024-07-31&#x27; AND sys_imp_date &lt;= &#x27;2024-08-06&#x27;) -&gt; SELECT SUM(pv) FROM t_1 WHERE (sys_imp_date &gt;= &#x27;2024-07-31&#x27; AND sys_imp_date &lt;= &#x27;2024-08-06&#x27;)

with t_1 as (SELECT `imp_date` AS `sys_imp_date`, SUM(1) AS `pv` FROM s2_pv_uv_statis GROUP BY `imp_date`, `imp_date`) SELECT SUM(pv) FROM t_1 WHERE (sys_imp_date &gt;= &#x27;2024-07-31&#x27; AND sys_imp_date &lt;= &#x27;2024-08-06&#x27;) limit 1000</code></pre><figure id="af7f9c1c-bd05-42e5-b64c-0a0058e14724" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/image%205.png"><img style="width:720px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/image%205.png"/></a></figure><ol type="1" id="73f50c7b-9337-453b-baf9-d0ac33362146" class="numbered-list" start="1"><li><mark class="highlight-default"><a href="https://www.notion.so/WorkflowServiceImpl-java-ceb9292ac776466687031e5ab13643c1?pvs=21">WorkflowServiceImpl</a></mark><mark class="highlight-default"> 调启总服务（开始执行下面步骤）</mark><figure id="2ea443d9-c4a7-4616-b776-2a5d8fd82300" class="link-to-page"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/WorkflowServiceImpl%20java%202ea443d9c4a74616b7762a5d8fd82300.html">WorkflowServiceImpl.java </a></figure></li></ol><ol type="1" id="3e673fc2-a705-4bc6-a9ae-f467e7724208" class="numbered-list" start="2"><li><code>performMapping</code>调用<code>schemaMappers</code>元素匹配</li></ol><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="5ceaa8d3-1bd6-4955-a54a-ee08e280cbf8" class="code"><code class="language-JSON" style="white-space:pre-wrap;word-break:break-all">14:57:04 [http-nio-9080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping 522 - Mapped to com.tencent.supersonic.chat.server.rest.ChatQueryController#parse(ChatParseReq, HttpServletRequest, HttpServletResponse)
14:57:04 [http-nio-9080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor 91 - Read &quot;application/json;charset=UTF-8&quot; to [ChatParseReq(queryText=超音速对比所有人访问次数, chatId=1, agentId=1, topN=10, user=null, queryFilters=null, sav (truncated)...]
14:57:04 [http-nio-9080-exec-2] DEBUG c.t.s.h.c.mapper.BaseMatchStrategy 150 - word:访问次数,nature:_1_1_metric,frequency:100000
14:57:04 [http-nio-9080-exec-2] DEBUG c.t.s.h.c.mapper.BaseMatchStrategy 43 - terms:[S2Term(word=访问次数, nature=_1_1_metric, offset=8, frequency=100000)],,detectDataSetIds:[]
14:57:06 [http-nio-9080-exec-2] DEBUG c.t.s.h.chat.mapper.BaseMapper 44 - after KeywordMapper,cost:772,mapInfo:{1=[SchemaElementMatch(element=SchemaElement(dataSet=1, dataSetName=超音数数据集, model=2, id=1, name=访问次数, bizName=pv, useCnt=0, type=METRIC, alias=[], schemaValueMaps=null, relatedSchemaElements=[RelatedSchemaElement(dimensionId=1, isNecessary=false), RelatedSchemaElement(dimensionId=2, isNecessary=false)], defaultAgg=SUM, dataFormatType=null, order=0.0, isTag=0, description=一段时间内用户的访问次数), similarity=1.0, detectWord=访问次数, word=访问次数, frequency=100000, isInherited=false), SchemaElementMatch(element=SchemaElement(dataSet=1, dataSetName=超音数数据集, model=2, id=4, name=人均访问次数, bizName=pv_avg, useCnt=0, type=METRIC, alias=[平均访问次数], schemaValueMaps=null, relatedSchemaElements=[RelatedSchemaElement(dimensionId=1, isNecessary=false)], defaultAgg=, dataFormatType=null, order=0.0, isTag=0, description=每个用户平均访问的次数), similarity=0.9971581297489837, detectWord=人访问次数, word=人均访问次数, frequency=100000, isInherited=false), SchemaElementMatch(element=SchemaElement(dataSet=1, dataSetName=超音数数据集, model=2, id=3, name=访问用户数, bizName=uv, useCnt=0, type=METRIC, alias=[UV, 访问人数], schemaValueMaps=null, relatedSchemaElements=[RelatedSchemaElement(dimensionId=1, isNecessary=false)], defaultAgg=count, dataFormatType=null, order=0.0, isTag=0, description=访问的用户个数), similarity=0.9953412336995052, detectWord=访问次数, word=访问用户数, frequency=100000, isInherited=false)]}
14:57:06 [http-nio-9080-exec-2] DEBUG c.t.s.h.chat.mapper.BaseMapper 33 - before QueryFilterMapper,mapInfo:{1=[SchemaElementMatch(element=SchemaElement(dataSet=1, dataSetName=超音数数据集, model=2, id=1, name=访问次数, bizName=pv, useCnt=0, type=METRIC, alias=[], schemaValueMaps=null, relatedSchemaElements=[RelatedSchemaElement(dimensionId=1, isNecessary=false), RelatedSchemaElement(dimensionId=2, isNecessary=false)], defaultAgg=SUM, dataFormatType=null, order=0.0, isTag=0, description=一段时间内用户的访问次数), similarity=1.0, detectWord=访问次数, word=访问次数, frequency=100000, isInherited=false), SchemaElementMatch(element=SchemaElement(dataSet=1, dataSetName=超音数数据集, model=2, id=4, name=人均访问次数, bizName=pv_avg, useCnt=0, type=METRIC, alias=[平均访问次数], schemaValueMaps=null, relatedSchemaElements=[RelatedSchemaElement(dimensionId=1, isNecessary=false)], defaultAgg=, dataFormatType=null, order=0.0, isTag=0, description=每个用户平均访问的次数), similarity=0.9971581297489837, detectWord=人访问次数, word=人均访问次数, frequency=100000, isInherited=false), SchemaElementMatch(element=SchemaElement(dataSet=1, dataSetName=超音数数据集, model=2, id=3, name=访问用户数, bizName=uv, useCnt=0, type=METRIC, alias=[UV, 访问人数], schemaValueMaps=null, relatedSchemaElements=[RelatedSchemaElement(dimensionId=1, isNecessary=false)], defaultAgg=count, dataFormatType=null, order=0.0, isTag=0, description=访问的用户个数), similarity=0.9953412336995052, detectWord=访问次数, word=访问用户数, frequency=100000, isInherited=false)]}
14:57:06 [http-nio-9080-exec-2] DEBUG c.t.s.h.chat.mapper.BaseMapper 44 - after QueryFilterMapper,cost:0,mapInfo:{1=[SchemaElementMatch(element=SchemaElement(dataSet=1, dataSetName=超音数数据集, model=2, id=1, name=访问次数, bizName=pv, useCnt=0, type=METRIC, alias=[], schemaValueMaps=null, relatedSchemaElements=[RelatedSchemaElement(dimensionId=1, isNecessary=false), RelatedSchemaElement(dimensionId=2, isNecessary=false)], defaultAgg=SUM, dataFormatType=null, order=0.0, isTag=0, description=一段时间内用户的访问次数), similarity=1.0, detectWord=访问次数, word=访问次数, frequency=100000, isInherited=false), SchemaElementMatch(element=SchemaElement(dataSet=1, dataSetName=超音数数据集, model=2, id=4, name=人均访问次数, bizName=pv_avg, useCnt=0, type=METRIC, alias=[平均访问次数], schemaValueMaps=null, relatedSchemaElements=[RelatedSchemaElement(dimensionId=1, isNecessary=false)], defaultAgg=, dataFormatType=null, order=0.0, isTag=0, description=每个用户平均访问的次数), similarity=0.9971581297489837, detectWord=人访问次数, word=人均访问次数, frequency=100000, isInherited=false), SchemaElementMatch(element=SchemaElement(dataSet=1, dataSetName=超音数数据集, model=2, id=3, name=访问用户数, bizName=uv, useCnt=0, type=METRIC, alias=[UV, 访问人数], schemaValueMaps=null, relatedSchemaElements=[RelatedSchemaElement(dimensionId=1, isNecessary=false)], defaultAgg=count, dataFormatType=null, order=0.0, isTag=0, description=访问的用户个数), similarity=0.9953412336995052, detectWord=访问次数, word=访问用户数, frequency=100000, isInherited=false)]}
14:57:06 [http-nio-9080-exec-2] DEBUG c.t.s.h.chat.mapper.BaseMapper 33 - before EntityMapper,mapInfo:{1=[SchemaElementMatch(element=SchemaElement(dataSet=1, dataSetName=超音数数据集, model=2, id=1, name=访问次数, bizName=pv, useCnt=0, type=METRIC, alias=[], schemaValueMaps=null, relatedSchemaElements=[RelatedSchemaElement(dimensionId=1, isNecessary=false), RelatedSchemaElement(dimensionId=2, isNecessary=false)], defaultAgg=SUM, dataFormatType=null, order=0.0, isTag=0, description=一段时间内用户的访问次数), similarity=1.0, detectWord=访问次数, word=访问次数, frequency=100000, isInherited=false), SchemaElementMatch(element=SchemaElement(dataSet=1, dataSetName=超音数数据集, model=2, id=4, name=人均访问次数, bizName=pv_avg, useCnt=0, type=METRIC, alias=[平均访问次数], schemaValueMaps=null, relatedSchemaElements=[RelatedSchemaElement(dimensionId=1, isNecessary=false)], defaultAgg=, dataFormatType=null, order=0.0, isTag=0, description=每个用户平均访问的次数), similarity=0.9971581297489837, detectWord=人访问次数, word=人均访问次数, frequency=100000, isInherited=false), SchemaElementMatch(element=SchemaElement(dataSet=1, dataSetName=超音数数据集, model=2, id=3, name=访问用户数, bizName=uv, useCnt=0, type=METRIC, alias=[UV, 访问人数], schemaValueMaps=null, relatedSchemaElements=[RelatedSchemaElement(dimensionId=1, isNecessary=false)], defaultAgg=count, dataFormatType=null, order=0.0, isTag=0, description=访问的用户个数), similarity=0.9953412336995052, detectWord=访问次数, word=访问用户数, frequency=100000, isInherited=false)]}
14:57:06 [http-nio-9080-exec-2] DEBUG c.t.s.h.chat.mapper.BaseMapper 44 - after EntityMapper,cost:0,mapInfo:{1=[SchemaElementMatch(element=SchemaElement(dataSet=1, dataSetName=超音数数据集, model=2, id=1, name=访问次数, bizName=pv, useCnt=0, type=METRIC, alias=[], schemaValueMaps=null, relatedSchemaElements=[RelatedSchemaElement(dimensionId=1, isNecessary=false), RelatedSchemaElement(dimensionId=2, isNecessary=false)], defaultAgg=SUM, dataFormatType=null, order=0.0, isTag=0, description=一段时间内用户的访问次数), similarity=1.0, detectWord=访问次数, word=访问次数, frequency=100000, isInherited=false), SchemaElementMatch(element=SchemaElement(dataSet=1, dataSetName=超音数数据集, model=2, id=4, name=人均访问次数, bizName=pv_avg, useCnt=0, type=METRIC, alias=[平均访问次数], schemaValueMaps=null, relatedSchemaElements=[RelatedSchemaElement(dimensionId=1, isNecessary=false)], defaultAgg=, dataFormatType=null, order=0.0, isTag=0, description=每个用户平均访问的次数), similarity=0.9971581297489837, detectWord=人访问次数, word=人均访问次数, frequency=100000, isInherited=false), SchemaElementMatch(element=SchemaElement(dataSet=1, dataSetName=超音数数据集, model=2, id=3, name=访问用户数, bizName=uv, useCnt=0, type=METRIC, alias=[UV, 访问人数], schemaValueMaps=null, relatedSchemaElements=[RelatedSchemaElement(dimensionId=1, isNecessary=false)], defaultAgg=count, dataFormatType=null, order=0.0, isTag=0, description=访问的用户个数), similarity=0.9953412336995052, detectWord=访问次数, word=访问用户数, frequency=100000, isInherited=false)]}
</code></pre><p id="71c5d903-46c7-476d-be6c-1460a769f320" class="">请求查询schema对应，匹配相关信息，便于后续查询时候调节指标生成（对knowledge base进行查询）</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="f76e40ba-7f28-4798-a820-ca7f4f09bc87" class="code"><code class="language-Dart" style="white-space:pre-wrap;word-break:break-all">mapInfo:{1=[SchemaElementMatch(element=SchemaElement(dataSet=1, dataSetName=超音数数据集, model=2, id=1, name=访问次数, bizName=pv, useCnt=0, type=METRIC, alias=[], schemaValueMaps=null, relatedSchemaElements=[RelatedSchemaElement(dimensionId=1, isNecessary=false), RelatedSchemaElement(dimensionId=2, isNecessary=false)], defaultAgg=SUM, dataFormatType=null, order=0.0, isTag=0, description=一段时间内用户的访问次数), similarity=1.0, detectWord=访问次数, word=访问次数, frequency=100000, isInherited=false), SchemaElementMatch(element=SchemaElement(dataSet=1, dataSetName=超音数数据集, model=2, id=4, name=人均访问次数, bizName=pv_avg, useCnt=0, type=METRIC, alias=[平均访问次数], schemaValueMaps=null, relatedSchemaElements=[RelatedSchemaElement(dimensionId=1, isNecessary=false)], defaultAgg=, dataFormatType=null, order=0.0, isTag=0, description=每个用户平均访问的次数), similarity=0.9971581297489837, detectWord=人访问次数, word=人均访问次数, frequency=100000, isInherited=false), SchemaElementMatch(element=SchemaElement(dataSet=1, dataSetName=超音数数据集, model=2, id=3, name=访问用户数, bizName=uv, useCnt=0, type=METRIC, alias=[UV, 访问人数], schemaValueMaps=null, relatedSchemaElements=[RelatedSchemaElement(dimensionId=1, isNecessary=false)], defaultAgg=count, dataFormatType=null, order=0.0, isTag=0, description=访问的用户个数), similarity=0.9953412336995052, detectWord=访问次数, word=访问用户数, frequency=100000, isInherited=false)]}</code></pre><ol type="1" id="e82335b1-3c24-4749-9fe6-e15e53d62f08" class="numbered-list" start="3"><li><code>performParsing</code>调用<code>SemanticParser</code>解析指令生成请求构造SQL（67行log输出）<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="8e28b4b0-3e17-49f8-8b50-ac05ebad8cea" class="code"><code class="language-Dart" style="white-space:pre-wrap;word-break:break-all">14:57:06 [http-nio-9080-exec-2] DEBUG c.t.s.h.s.w.s.i.WorkflowServiceImpl 67 - RuleSqlParser result:{&quot;queryText&quot;:&quot;超音速对比所有人访问次数&quot;,&quot;chatId&quot;:1,&quot;dataSetIds&quot;:[],&quot;modelIdToDataSetIds&quot;:{&quot;1&quot;:[1],&quot;2&quot;:[1],&quot;3&quot;:[1],&quot;4&quot;:[2]},&quot;user&quot;:{&quot;id&quot;:6,&quot;name&quot;:&quot;admin&quot;,&quot;displayName&quot;:&quot;admin&quot;,&quot;email&quot;:&quot;null&quot;,&quot;isAdmin&quot;:1,&quot;superAdmin&quot;:true},&quot;saveAnswer&quot;:true,&quot;text2SQLType&quot;:&quot;RULE_AND_LLM&quot;,&quot;candidateQueries&quot;:[{&quot;parseInfo&quot;:{&quot;queryMode&quot;:&quot;METRIC_GROUPBY&quot;,&quot;dataSet&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;id&quot;:1,&quot;name&quot;:&quot;超音数数据集&quot;,&quot;bizName&quot;:&quot;s2&quot;,&quot;type&quot;:&quot;DATASET&quot;,&quot;order&quot;:0.0,&quot;isTag&quot;:0},&quot;metrics&quot;:[{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:1,&quot;name&quot;:&quot;访问次数&quot;,&quot;bizName&quot;:&quot;pv&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false},{&quot;dimensionId&quot;:2,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;SUM&quot;,&quot;order&quot;:0.0,&quot;isTag&quot;:0,&quot;description&quot;:&quot;一段时间内用户的访问次数&quot;},{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:4,&quot;name&quot;:&quot;人均访问次数&quot;,&quot;bizName&quot;:&quot;pv_avg&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[&quot;平均访问次数&quot;],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;&quot;,&quot;order&quot;:0.002841870251016343,&quot;isTag&quot;:0,&quot;description&quot;:&quot;每个用户平均访问的次数&quot;},{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:3,&quot;name&quot;:&quot;访问用户数&quot;,&quot;bizName&quot;:&quot;uv&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[&quot;UV&quot;,&quot;访问人数&quot;],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;count&quot;,&quot;order&quot;:0.004658766300494777,&quot;isTag&quot;:0,&quot;description&quot;:&quot;访问的用户个数&quot;}],&quot;dimensions&quot;:[{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:1,&quot;id&quot;:1,&quot;name&quot;:&quot;部门&quot;,&quot;bizName&quot;:&quot;department&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;DIMENSION&quot;,&quot;alias&quot;:[],&quot;schemaValueMaps&quot;:[],&quot;order&quot;:0.0,&quot;isTag&quot;:1,&quot;description&quot;:&quot;&quot;}],&quot;aggType&quot;:&quot;NONE&quot;,&quot;filterType&quot;:&quot;AND&quot;,&quot;dimensionFilters&quot;:[],&quot;metricFilters&quot;:[],&quot;orders&quot;:[],&quot;dateInfo&quot;:{&quot;dateMode&quot;:&quot;RECENT&quot;,&quot;startDate&quot;:&quot;2024-06-08&quot;,&quot;endDate&quot;:&quot;2024-07-07&quot;,&quot;dateList&quot;:[&quot;2024-06-08&quot;,&quot;2024-06-09&quot;,&quot;2024-06-10&quot;,&quot;2024-06-11&quot;,&quot;2024-06-12&quot;,&quot;2024-06-13&quot;,&quot;2024-06-14&quot;,&quot;2024-06-15&quot;,&quot;2024-06-16&quot;,&quot;2024-06-17&quot;,&quot;2024-06-18&quot;,&quot;2024-06-19&quot;,&quot;2024-06-20&quot;,&quot;2024-06-21&quot;,&quot;2024-06-22&quot;,&quot;2024-06-23&quot;,&quot;2024-06-24&quot;,&quot;2024-06-25&quot;,&quot;2024-06-26&quot;,&quot;2024-06-27&quot;,&quot;2024-06-28&quot;,&quot;2024-06-29&quot;,&quot;2024-06-30&quot;,&quot;2024-07-01&quot;,&quot;2024-07-02&quot;,&quot;2024-07-03&quot;,&quot;2024-07-04&quot;,&quot;2024-07-05&quot;,&quot;2024-07-06&quot;,&quot;2024-07-07&quot;],&quot;unit&quot;:30,&quot;period&quot;:&quot;DAY&quot;,&quot;detectWord&quot;:&quot;近30天&quot;,&quot;groupByDate&quot;:false,&quot;inherited&quot;:true,&quot;groupByTimeDimension&quot;:&quot;sys_imp_date&quot;},&quot;limit&quot;:365,&quot;score&quot;:6.0,&quot;elementMatches&quot;:[{&quot;element&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:1,&quot;name&quot;:&quot;访问次数&quot;,&quot;bizName&quot;:&quot;pv&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false},{&quot;dimensionId&quot;:2,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;SUM&quot;,&quot;order&quot;:0.0,&quot;isTag&quot;:0,&quot;description&quot;:&quot;一段时间内用户的访问次数&quot;},&quot;similarity&quot;:1.0,&quot;detectWord&quot;:&quot;访问次数&quot;,&quot;word&quot;:&quot;访问次数&quot;,&quot;frequency&quot;:100000,&quot;inherited&quot;:false},{&quot;element&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:4,&quot;name&quot;:&quot;人均访问次数&quot;,&quot;bizName&quot;:&quot;pv_avg&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[&quot;平均访问次数&quot;],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;&quot;,&quot;order&quot;:0.002841870251016343,&quot;isTag&quot;:0,&quot;description&quot;:&quot;每个用户平均访问的次数&quot;},&quot;similarity&quot;:0.9971581297489837,&quot;detectWord&quot;:&quot;人访问次数&quot;,&quot;word&quot;:&quot;人均访问次数&quot;,&quot;frequency&quot;:100000,&quot;inherited&quot;:false},{&quot;element&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:3,&quot;name&quot;:&quot;访问用户数&quot;,&quot;bizName&quot;:&quot;uv&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[&quot;UV&quot;,&quot;访问人数&quot;],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;count&quot;,&quot;order&quot;:0.004658766300494777,&quot;isTag&quot;:0,&quot;description&quot;:&quot;访问的用户个数&quot;},&quot;similarity&quot;:0.9953412336995052,&quot;detectWord&quot;:&quot;访问次数&quot;,&quot;word&quot;:&quot;访问用户数&quot;,&quot;frequency&quot;:100000,&quot;inherited&quot;:false},{&quot;element&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:1,&quot;id&quot;:1,&quot;name&quot;:&quot;部门&quot;,&quot;bizName&quot;:&quot;department&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;DIMENSION&quot;,&quot;alias&quot;:[],&quot;schemaValueMaps&quot;:[],&quot;order&quot;:0.0,&quot;isTag&quot;:1,&quot;description&quot;:&quot;&quot;},&quot;similarity&quot;:1.0,&quot;detectWord&quot;:&quot;部门&quot;,&quot;word&quot;:&quot;部门&quot;,&quot;frequency&quot;:100000,&quot;inherited&quot;:true}],&quot;properties&quot;:{},&quot;sqlInfo&quot;:{},&quot;sqlEvaluation&quot;:{},&quot;queryType&quot;:&quot;ID&quot;,&quot;dataSetId&quot;:1},&quot;queryMode&quot;:&quot;METRIC_GROUPBY&quot;},{&quot;parseInfo&quot;:{&quot;queryMode&quot;:&quot;METRIC_MODEL&quot;,&quot;dataSet&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;id&quot;:1,&quot;name&quot;:&quot;超音数数据集&quot;,&quot;bizName&quot;:&quot;s2&quot;,&quot;type&quot;:&quot;DATASET&quot;,&quot;order&quot;:0.0,&quot;isTag&quot;:0},&quot;metrics&quot;:[{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:1,&quot;name&quot;:&quot;访问次数&quot;,&quot;bizName&quot;:&quot;pv&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false},{&quot;dimensionId&quot;:2,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;SUM&quot;,&quot;order&quot;:0.0,&quot;isTag&quot;:0,&quot;description&quot;:&quot;一段时间内用户的访问次数&quot;},{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:4,&quot;name&quot;:&quot;人均访问次数&quot;,&quot;bizName&quot;:&quot;pv_avg&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[&quot;平均访问次数&quot;],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;&quot;,&quot;order&quot;:0.002841870251016343,&quot;isTag&quot;:0,&quot;description&quot;:&quot;每个用户平均访问的次数&quot;},{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:3,&quot;name&quot;:&quot;访问用户数&quot;,&quot;bizName&quot;:&quot;uv&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[&quot;UV&quot;,&quot;访问人数&quot;],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;count&quot;,&quot;order&quot;:0.004658766300494777,&quot;isTag&quot;:0,&quot;description&quot;:&quot;访问的用户个数&quot;}],&quot;dimensions&quot;:[],&quot;aggType&quot;:&quot;NONE&quot;,&quot;filterType&quot;:&quot;AND&quot;,&quot;dimensionFilters&quot;:[],&quot;metricFilters&quot;:[],&quot;orders&quot;:[],&quot;dateInfo&quot;:{&quot;dateMode&quot;:&quot;RECENT&quot;,&quot;startDate&quot;:&quot;2024-06-08&quot;,&quot;endDate&quot;:&quot;2024-07-07&quot;,&quot;dateList&quot;:[&quot;2024-06-08&quot;,&quot;2024-06-09&quot;,&quot;2024-06-10&quot;,&quot;2024-06-11&quot;,&quot;2024-06-12&quot;,&quot;2024-06-13&quot;,&quot;2024-06-14&quot;,&quot;2024-06-15&quot;,&quot;2024-06-16&quot;,&quot;2024-06-17&quot;,&quot;2024-06-18&quot;,&quot;2024-06-19&quot;,&quot;2024-06-20&quot;,&quot;2024-06-21&quot;,&quot;2024-06-22&quot;,&quot;2024-06-23&quot;,&quot;2024-06-24&quot;,&quot;2024-06-25&quot;,&quot;2024-06-26&quot;,&quot;2024-06-27&quot;,&quot;2024-06-28&quot;,&quot;2024-06-29&quot;,&quot;2024-06-30&quot;,&quot;2024-07-01&quot;,&quot;2024-07-02&quot;,&quot;2024-07-03&quot;,&quot;2024-07-04&quot;,&quot;2024-07-05&quot;,&quot;2024-07-06&quot;,&quot;2024-07-07&quot;],&quot;unit&quot;:30,&quot;period&quot;:&quot;DAY&quot;,&quot;detectWord&quot;:&quot;近30天&quot;,&quot;groupByDate&quot;:false,&quot;inherited&quot;:true,&quot;groupByTimeDimension&quot;:&quot;sys_imp_date&quot;},&quot;limit&quot;:365,&quot;score&quot;:4.0,&quot;elementMatches&quot;:[{&quot;element&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:1,&quot;name&quot;:&quot;访问次数&quot;,&quot;bizName&quot;:&quot;pv&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false},{&quot;dimensionId&quot;:2,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;SUM&quot;,&quot;order&quot;:0.0,&quot;isTag&quot;:0,&quot;description&quot;:&quot;一段时间内用户的访问次数&quot;},&quot;similarity&quot;:1.0,&quot;detectWord&quot;:&quot;访问次数&quot;,&quot;word&quot;:&quot;访问次数&quot;,&quot;frequency&quot;:100000,&quot;inherited&quot;:false},{&quot;element&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:4,&quot;name&quot;:&quot;人均访问次数&quot;,&quot;bizName&quot;:&quot;pv_avg&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[&quot;平均访问次数&quot;],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;&quot;,&quot;order&quot;:0.002841870251016343,&quot;isTag&quot;:0,&quot;description&quot;:&quot;每个用户平均访问的次数&quot;},&quot;similarity&quot;:0.9971581297489837,&quot;detectWord&quot;:&quot;人访问次数&quot;,&quot;word&quot;:&quot;人均访问次数&quot;,&quot;frequency&quot;:100000,&quot;inherited&quot;:false},{&quot;element&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:3,&quot;name&quot;:&quot;访问用户数&quot;,&quot;bizName&quot;:&quot;uv&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[&quot;UV&quot;,&quot;访问人数&quot;],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;count&quot;,&quot;order&quot;:0.004658766300494777,&quot;isTag&quot;:0,&quot;description&quot;:&quot;访问的用户个数&quot;},&quot;similarity&quot;:0.9953412336995052,&quot;detectWord&quot;:&quot;访问次数&quot;,&quot;word&quot;:&quot;访问用户数&quot;,&quot;frequency&quot;:100000,&quot;inherited&quot;:false}],&quot;properties&quot;:{},&quot;sqlInfo&quot;:{},&quot;sqlEvaluation&quot;:{},&quot;queryType&quot;:&quot;ID&quot;,&quot;dataSetId&quot;:1},&quot;queryMode&quot;:&quot;METRIC_MODEL&quot;}],&quot;mapInfo&quot;:{&quot;dataSetElementMatches&quot;:{&quot;1&quot;:[{&quot;element&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:1,&quot;name&quot;:&quot;访问次数&quot;,&quot;bizName&quot;:&quot;pv&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false},{&quot;dimensionId&quot;:2,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;SUM&quot;,&quot;order&quot;:0.0,&quot;isTag&quot;:0,&quot;description&quot;:&quot;一段时间内用户的访问次数&quot;},&quot;similarity&quot;:1.0,&quot;detectWord&quot;:&quot;访问次数&quot;,&quot;word&quot;:&quot;访问次数&quot;,&quot;frequency&quot;:100000,&quot;inherited&quot;:false},{&quot;element&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:4,&quot;name&quot;:&quot;人均访问次数&quot;,&quot;bizName&quot;:&quot;pv_avg&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[&quot;平均访问次数&quot;],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;&quot;,&quot;order&quot;:0.002841870251016343,&quot;isTag&quot;:0,&quot;description&quot;:&quot;每个用户平均访问的次数&quot;},&quot;similarity&quot;:0.9971581297489837,&quot;detectWord&quot;:&quot;人访问次数&quot;,&quot;word&quot;:&quot;人均访问次数&quot;,&quot;frequency&quot;:100000,&quot;inherited&quot;:false},{&quot;element&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:3,&quot;name&quot;:&quot;访问用户数&quot;,&quot;bizName&quot;:&quot;uv&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[&quot;UV&quot;,&quot;访问人数&quot;],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;count&quot;,&quot;order&quot;:0.004658766300494777,&quot;isTag&quot;:0,&quot;description&quot;:&quot;访问的用户个数&quot;},&quot;similarity&quot;:0.9953412336995052,&quot;detectWord&quot;:&quot;访问次数&quot;,&quot;word&quot;:&quot;访问用户数&quot;,&quot;frequency&quot;:100000,&quot;inherited&quot;:false},{&quot;element&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:1,&quot;id&quot;:1,&quot;name&quot;:&quot;部门&quot;,&quot;bizName&quot;:&quot;department&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;DIMENSION&quot;,&quot;alias&quot;:[],&quot;schemaValueMaps&quot;:[],&quot;order&quot;:0.0,&quot;isTag&quot;:1,&quot;description&quot;:&quot;&quot;},&quot;similarity&quot;:1.0,&quot;detectWord&quot;:&quot;部门&quot;,&quot;word&quot;:&quot;部门&quot;,&quot;frequency&quot;:100000,&quot;inherited&quot;:true}]},&quot;matchedDataSetInfos&quot;:[1]},&quot;mapModeEnum&quot;:&quot;STRICT&quot;,&quot;queryDataType&quot;:&quot;ALL&quot;,&quot;llmConfig&quot;:{&quot;provider&quot;:&quot;OPEN_AI&quot;,&quot;baseUrl&quot;:&quot;https://api.openai.com/v1&quot;,&quot;apiKey&quot;:&quot;kGA4i6jY7QqG5xH+S0N++SzVWVKyAHesOq7NpoFVI7pgU14eb1AM296OFiLJTNtDVfpWDpfu7o4vDG2C2yWiSA==&quot;,&quot;modelName&quot;:&quot;gpt-3.5-turbo&quot;,&quot;temperature&quot;:0.0,&quot;timeOut&quot;:60},&quot;exemplars&quot;:[]}
14:57:07 [http-nio-9080-exec-2] INFO  c.t.s.h.chat.parser.llm.LLMSqlParser 58 - currentRetryRound:1, start runText2SQL

//以下全部为输出
14:57:19 [http-nio-9080-exec-2] DEBUG c.t.s.h.s.w.s.i.WorkflowServiceImpl 67 - LLMSqlParser result:{&quot;queryText&quot;:&quot;超音速对比所有人访问次数&quot;,&quot;chatId&quot;:1,&quot;dataSetIds&quot;:[],&quot;modelIdToDataSetIds&quot;:{&quot;1&quot;:[1],&quot;2&quot;:[1],&quot;3&quot;:[1],&quot;4&quot;:[2]},&quot;user&quot;:{&quot;id&quot;:6,&quot;name&quot;:&quot;admin&quot;,&quot;displayName&quot;:&quot;admin&quot;,&quot;email&quot;:&quot;null&quot;,&quot;isAdmin&quot;:1,&quot;superAdmin&quot;:true},&quot;saveAnswer&quot;:true,&quot;text2SQLType&quot;:&quot;RULE_AND_LLM&quot;,&quot;candidateQueries&quot;:[{&quot;parseInfo&quot;:{&quot;queryMode&quot;:&quot;LLM_S2SQL&quot;,&quot;dataSet&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;id&quot;:1,&quot;name&quot;:&quot;超音数数据集&quot;,&quot;bizName&quot;:&quot;s2&quot;,&quot;type&quot;:&quot;DATASET&quot;,&quot;order&quot;:0.0,&quot;isTag&quot;:0},&quot;metrics&quot;:[],&quot;dimensions&quot;:[],&quot;aggType&quot;:&quot;NONE&quot;,&quot;filterType&quot;:&quot;AND&quot;,&quot;dimensionFilters&quot;:[],&quot;metricFilters&quot;:[],&quot;orders&quot;:[],&quot;score&quot;:24.0,&quot;elementMatches&quot;:[{&quot;element&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:1,&quot;name&quot;:&quot;访问次数&quot;,&quot;bizName&quot;:&quot;pv&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false},{&quot;dimensionId&quot;:2,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;SUM&quot;,&quot;order&quot;:0.0,&quot;isTag&quot;:0,&quot;description&quot;:&quot;一段时间内用户的访问次数&quot;},&quot;similarity&quot;:1.0,&quot;detectWord&quot;:&quot;访问次数&quot;,&quot;word&quot;:&quot;访问次数&quot;,&quot;frequency&quot;:100000,&quot;inherited&quot;:false},{&quot;element&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:4,&quot;name&quot;:&quot;人均访问次数&quot;,&quot;bizName&quot;:&quot;pv_avg&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[&quot;平均访问次数&quot;],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;&quot;,&quot;order&quot;:0.002841870251016343,&quot;isTag&quot;:0,&quot;description&quot;:&quot;每个用户平均访问的次数&quot;},&quot;similarity&quot;:0.9971581297489837,&quot;detectWord&quot;:&quot;人访问次数&quot;,&quot;word&quot;:&quot;人均访问次数&quot;,&quot;frequency&quot;:100000,&quot;inherited&quot;:false},{&quot;element&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:3,&quot;name&quot;:&quot;访问用户数&quot;,&quot;bizName&quot;:&quot;uv&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[&quot;UV&quot;,&quot;访问人数&quot;],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;count&quot;,&quot;order&quot;:0.004658766300494777,&quot;isTag&quot;:0,&quot;description&quot;:&quot;访问的用户个数&quot;},&quot;similarity&quot;:0.9953412336995052,&quot;detectWord&quot;:&quot;访问次数&quot;,&quot;word&quot;:&quot;访问用户数&quot;,&quot;frequency&quot;:100000,&quot;inherited&quot;:false},{&quot;element&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:1,&quot;id&quot;:1,&quot;name&quot;:&quot;部门&quot;,&quot;bizName&quot;:&quot;department&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;DIMENSION&quot;,&quot;alias&quot;:[],&quot;schemaValueMaps&quot;:[],&quot;order&quot;:0.0,&quot;isTag&quot;:1,&quot;description&quot;:&quot;&quot;},&quot;similarity&quot;:1.0,&quot;detectWord&quot;:&quot;部门&quot;,&quot;word&quot;:&quot;部门&quot;,&quot;frequency&quot;:100000,&quot;inherited&quot;:true}],&quot;properties&quot;:{&quot;type&quot;:&quot;internal&quot;,&quot;CONTEXT&quot;:{&quot;dataSetId&quot;:1,&quot;llmReq&quot;:{&quot;queryText&quot;:&quot;超音速对比所有人访问次数&quot;,&quot;filterCondition&quot;:{},&quot;schema&quot;:{&quot;domainName&quot;:&quot;超音数数据集&quot;,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;dataSetId&quot;:1,&quot;fieldNameList&quot;:[&quot;访问用户数&quot;,&quot;用户&quot;,&quot;部门&quot;,&quot;访问次数&quot;,&quot;人均访问次数&quot;,&quot;停留时长&quot;,&quot;页面&quot;,&quot;数据日期&quot;],&quot;metrics&quot;:[{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:1,&quot;name&quot;:&quot;访问次数&quot;,&quot;bizName&quot;:&quot;pv&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false},{&quot;dimensionId&quot;:2,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;SUM&quot;,&quot;order&quot;:0.0,&quot;isTag&quot;:0,&quot;description&quot;:&quot;一段时间内用户的访问次数&quot;},{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:4,&quot;name&quot;:&quot;人均访问次数&quot;,&quot;bizName&quot;:&quot;pv_avg&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[&quot;平均访问次数&quot;],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;&quot;,&quot;order&quot;:0.002841870251016343,&quot;isTag&quot;:0,&quot;description&quot;:&quot;每个用户平均访问的次数&quot;},{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:3,&quot;name&quot;:&quot;访问用户数&quot;,&quot;bizName&quot;:&quot;uv&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[&quot;UV&quot;,&quot;访问人数&quot;],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;count&quot;,&quot;order&quot;:0.004658766300494777,&quot;isTag&quot;:0,&quot;description&quot;:&quot;访问的用户个数&quot;}],&quot;dimensions&quot;:[{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:1,&quot;id&quot;:1,&quot;name&quot;:&quot;部门&quot;,&quot;bizName&quot;:&quot;department&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;DIMENSION&quot;,&quot;alias&quot;:[],&quot;schemaValueMaps&quot;:[],&quot;order&quot;:0.0,&quot;isTag&quot;:1,&quot;description&quot;:&quot;&quot;}],&quot;terms&quot;:[]},&quot;linking&quot;:[],&quot;currentDate&quot;:&quot;2024-08-07&quot;,&quot;priorExts&quot;:&quot;&quot;,&quot;sqlGenType&quot;:&quot;1_pass_self_consistency&quot;,&quot;llmConfig&quot;:{&quot;provider&quot;:&quot;OPEN_AI&quot;,&quot;baseUrl&quot;:&quot;https://api.openai.com/v1&quot;,&quot;apiKey&quot;:&quot;kGA4i6jY7QqG5xH+S0N++SzVWVKyAHesOq7NpoFVI7pgU14eb1AM296OFiLJTNtDVfpWDpfu7o4vDG2C2yWiSA==&quot;,&quot;modelName&quot;:&quot;gpt-3.5-turbo&quot;,&quot;temperature&quot;:0.0,&quot;timeOut&quot;:60},&quot;exemplars&quot;:[]},&quot;llmResp&quot;:{&quot;query&quot;:&quot;超音速对比所有人访问次数&quot;,&quot;modelName&quot;:&quot;超音数数据集&quot;,&quot;dbSchema&quot;:&quot;Table: 超音数数据集, Metrics: [访问次数 COMMENT &#x27;一段时间内用户的访问次数&#x27; AGGREGATE &#x27;SUM&#x27;,人均访问次数 COMMENT &#x27;每个用户平均访问的次数&#x27;,访问用户数 COMMENT &#x27;访问的用户个数&#x27; AGGREGATE &#x27;COUNT&#x27;,], Dimensions: [部门,]&quot;,&quot;sqlOutput&quot;:&quot;SELECT SUM(访问次数) FROM 超音数数据集&quot;,&quot;sqlRespMap&quot;:{&quot;SELECT SUM(访问次数) FROM 超音数数据集&quot;:{&quot;sqlWeight&quot;:1.0,&quot;fewShots&quot;:[{&quot;question&quot;:&quot;今年以来发行的歌曲中，有哪些在近7天播放超过一千万的 (补充信息:。当前的日期是2023-08-12) &quot;,&quot;dbSchema&quot;:&quot;Table: 歌曲库, Columns = [\&quot;发行日期\&quot;, \&quot;歌曲语言\&quot;, \&quot;歌曲来源\&quot;, \&quot;歌曲流派\&quot;, \&quot;歌曲名\&quot;, \&quot;歌曲版本\&quot;, \&quot;歌曲类型\&quot;, \&quot;发行时间\&quot;, \&quot;数据日期\&quot;]&quot;,&quot;sql&quot;:&quot;SELECT 歌曲名 FROM 歌曲库 WHERE datediff(&#x27;year&#x27;, 发行日期, &#x27;2023-08-12&#x27;) &lt;= 0 AND datediff(&#x27;day&#x27;, 数据日期, &#x27;2023-08-12&#x27;) &lt;= 7 AND 结算播放量 &gt; 10000000&quot;},{&quot;question&quot;:&quot;超音数近半年每个月的平均访问次数 (补充信息:。当前的日期是2023-09-04) &quot;,&quot;dbSchema&quot;:&quot;Table: 超音数产品, Columns = [\&quot;用户名\&quot;, \&quot;部门\&quot;, \&quot;模块\&quot;, \&quot;访问时长\&quot;, \&quot;访问次数\&quot;, \&quot;访问人数\&quot;, \&quot;数据日期\&quot;]&quot;,&quot;sql&quot;:&quot;SELECT MONTH(数据日期), AVG(访问次数) FROM 超音数产品 WHERE datediff(&#x27;year&#x27;, 数据日期, &#x27;2023-09-04&#x27;) &lt;= 0.5 GROUP BY MONTH(数据日期)&quot;},{&quot;question&quot;:&quot;我想要近半年签约的播放量前十的歌手有哪些 (补充信息:。当前的日期是2023-09-11) &quot;,&quot;dbSchema&quot;:&quot;Table: 艺人库, Columns = [\&quot;播放量层级\&quot;, \&quot;播放量单调性\&quot;, \&quot;播放量方差\&quot;, \&quot;播放量突增类型\&quot;, \&quot;播放量集中度\&quot;, \&quot;歌手名\&quot;, \&quot;歌手等级\&quot;, \&quot;歌手类型\&quot;, \&quot;歌手来源\&quot;, \&quot;签约日期\&quot;, \&quot;MPPM潮流人等级\&quot;, \&quot;结算播放量\&quot;, \&quot;运营播放量\&quot;, \&quot;历史累计结算播放量\&quot;, \&quot;有播放量歌曲数\&quot;, \&quot;历史累计运营播放量\&quot;, \&quot;付费用户结算播放量\&quot;, \&quot;结算播放量占比\&quot;, \&quot;运营播放份额\&quot;, \&quot;免费用户结算播放占比\&quot;, \&quot;完播量\&quot;, \&quot;数据日期\&quot;]&quot;,&quot;sql&quot;:&quot;SELECT 歌手名 FROM 艺人库 WHERE datediff(&#x27;year&#x27;, 签约日期, &#x27;2023-09-11&#x27;) &lt;= 0.5 ORDER BY 结算播放量 DESC LIMIT 10&quot;},{&quot;question&quot;:&quot;播放量大于1万的歌曲有多少 (补充信息:。当前的日期是2023-07-31) &quot;,&quot;dbSchema&quot;:&quot;Table: 歌曲库, Columns = [\&quot;歌曲名\&quot;, \&quot;歌曲版本\&quot;, \&quot;歌曲类型\&quot;, \&quot;MPPM歌曲ID\&quot;, \&quot;是否严选窄口径歌曲\&quot;, \&quot;是否严选宽口径歌曲\&quot;, \&quot;是否潮流人歌曲\&quot;, \&quot;超声波歌曲ID\&quot;, \&quot;C音歌曲ID\&quot;, \&quot;C音歌曲MID\&quot;, \&quot;结算播放量\&quot;, \&quot;运营播放量\&quot;, \&quot;分享量\&quot;, \&quot;收藏量\&quot;, \&quot;运营搜播量\&quot;, \&quot;结算搜播量\&quot;, \&quot;拉新用户数\&quot;, \&quot;拉活用户数\&quot;, \&quot;分享率\&quot;, \&quot;结算播放份额\&quot;, \&quot;数据日期\&quot;]&quot;,&quot;sql&quot;:&quot;SELECT 歌曲名 FROM 歌曲库 WHERE 结算播放量 &gt; 10000&quot;},{&quot;question&quot;:&quot;超音数访问次数大于1k的部门是哪些 (补充信息:。当前的日期是2023-09-14) &quot;,&quot;dbSchema&quot;:&quot;Table: 超音数产品, Columns = [\&quot;部门\&quot;, \&quot;模块\&quot;, \&quot;用户名\&quot;, \&quot;访问次数\&quot;, \&quot;访问人数\&quot;, \&quot;访问时长\&quot;, \&quot;数据日期\&quot;]&quot;,&quot;sql&quot;:&quot;SELECT 部门 FROM 超音数产品 WHERE 访问次数 &gt; 1000&quot;}]}}},&quot;linkingValues&quot;:[]}},&quot;sqlInfo&quot;:{&quot;s2SQL&quot;:&quot;SELECT SUM(访问次数) FROM 超音数数据集&quot;},&quot;sqlEvaluation&quot;:{},&quot;queryType&quot;:&quot;ID&quot;,&quot;dataSetId&quot;:1},&quot;queryMode&quot;:&quot;LLM_S2SQL&quot;},{&quot;parseInfo&quot;:{&quot;queryMode&quot;:&quot;METRIC_GROUPBY&quot;,&quot;dataSet&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;id&quot;:1,&quot;name&quot;:&quot;超音数数据集&quot;,&quot;bizName&quot;:&quot;s2&quot;,&quot;type&quot;:&quot;DATASET&quot;,&quot;order&quot;:0.0,&quot;isTag&quot;:0},&quot;metrics&quot;:[{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:1,&quot;name&quot;:&quot;访问次数&quot;,&quot;bizName&quot;:&quot;pv&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false},{&quot;dimensionId&quot;:2,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;SUM&quot;,&quot;order&quot;:0.0,&quot;isTag&quot;:0,&quot;description&quot;:&quot;一段时间内用户的访问次数&quot;},{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:4,&quot;name&quot;:&quot;人均访问次数&quot;,&quot;bizName&quot;:&quot;pv_avg&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[&quot;平均访问次数&quot;],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;&quot;,&quot;order&quot;:0.002841870251016343,&quot;isTag&quot;:0,&quot;description&quot;:&quot;每个用户平均访问的次数&quot;},{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:3,&quot;name&quot;:&quot;访问用户数&quot;,&quot;bizName&quot;:&quot;uv&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[&quot;UV&quot;,&quot;访问人数&quot;],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;count&quot;,&quot;order&quot;:0.004658766300494777,&quot;isTag&quot;:0,&quot;description&quot;:&quot;访问的用户个数&quot;}],&quot;dimensions&quot;:[{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:1,&quot;id&quot;:1,&quot;name&quot;:&quot;部门&quot;,&quot;bizName&quot;:&quot;department&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;DIMENSION&quot;,&quot;alias&quot;:[],&quot;schemaValueMaps&quot;:[],&quot;order&quot;:0.0,&quot;isTag&quot;:1,&quot;description&quot;:&quot;&quot;}],&quot;aggType&quot;:&quot;NONE&quot;,&quot;filterType&quot;:&quot;AND&quot;,&quot;dimensionFilters&quot;:[],&quot;metricFilters&quot;:[],&quot;orders&quot;:[],&quot;dateInfo&quot;:{&quot;dateMode&quot;:&quot;RECENT&quot;,&quot;startDate&quot;:&quot;2024-06-08&quot;,&quot;endDate&quot;:&quot;2024-07-07&quot;,&quot;dateList&quot;:[&quot;2024-06-08&quot;,&quot;2024-06-09&quot;,&quot;2024-06-10&quot;,&quot;2024-06-11&quot;,&quot;2024-06-12&quot;,&quot;2024-06-13&quot;,&quot;2024-06-14&quot;,&quot;2024-06-15&quot;,&quot;2024-06-16&quot;,&quot;2024-06-17&quot;,&quot;2024-06-18&quot;,&quot;2024-06-19&quot;,&quot;2024-06-20&quot;,&quot;2024-06-21&quot;,&quot;2024-06-22&quot;,&quot;2024-06-23&quot;,&quot;2024-06-24&quot;,&quot;2024-06-25&quot;,&quot;2024-06-26&quot;,&quot;2024-06-27&quot;,&quot;2024-06-28&quot;,&quot;2024-06-29&quot;,&quot;2024-06-30&quot;,&quot;2024-07-01&quot;,&quot;2024-07-02&quot;,&quot;2024-07-03&quot;,&quot;2024-07-04&quot;,&quot;2024-07-05&quot;,&quot;2024-07-06&quot;,&quot;2024-07-07&quot;],&quot;unit&quot;:30,&quot;period&quot;:&quot;DAY&quot;,&quot;detectWord&quot;:&quot;近30天&quot;,&quot;groupByDate&quot;:false,&quot;inherited&quot;:true,&quot;groupByTimeDimension&quot;:&quot;sys_imp_date&quot;},&quot;limit&quot;:365,&quot;score&quot;:6.0,&quot;elementMatches&quot;:[{&quot;element&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:1,&quot;name&quot;:&quot;访问次数&quot;,&quot;bizName&quot;:&quot;pv&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false},{&quot;dimensionId&quot;:2,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;SUM&quot;,&quot;order&quot;:0.0,&quot;isTag&quot;:0,&quot;description&quot;:&quot;一段时间内用户的访问次数&quot;},&quot;similarity&quot;:1.0,&quot;detectWord&quot;:&quot;访问次数&quot;,&quot;word&quot;:&quot;访问次数&quot;,&quot;frequency&quot;:100000,&quot;inherited&quot;:false},{&quot;element&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:4,&quot;name&quot;:&quot;人均访问次数&quot;,&quot;bizName&quot;:&quot;pv_avg&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[&quot;平均访问次数&quot;],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;&quot;,&quot;order&quot;:0.002841870251016343,&quot;isTag&quot;:0,&quot;description&quot;:&quot;每个用户平均访问的次数&quot;},&quot;similarity&quot;:0.9971581297489837,&quot;detectWord&quot;:&quot;人访问次数&quot;,&quot;word&quot;:&quot;人均访问次数&quot;,&quot;frequency&quot;:100000,&quot;inherited&quot;:false},{&quot;element&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:3,&quot;name&quot;:&quot;访问用户数&quot;,&quot;bizName&quot;:&quot;uv&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[&quot;UV&quot;,&quot;访问人数&quot;],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;count&quot;,&quot;order&quot;:0.004658766300494777,&quot;isTag&quot;:0,&quot;description&quot;:&quot;访问的用户个数&quot;},&quot;similarity&quot;:0.9953412336995052,&quot;detectWord&quot;:&quot;访问次数&quot;,&quot;word&quot;:&quot;访问用户数&quot;,&quot;frequency&quot;:100000,&quot;inherited&quot;:false},{&quot;element&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:1,&quot;id&quot;:1,&quot;name&quot;:&quot;部门&quot;,&quot;bizName&quot;:&quot;department&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;DIMENSION&quot;,&quot;alias&quot;:[],&quot;schemaValueMaps&quot;:[],&quot;order&quot;:0.0,&quot;isTag&quot;:1,&quot;description&quot;:&quot;&quot;},&quot;similarity&quot;:1.0,&quot;detectWord&quot;:&quot;部门&quot;,&quot;word&quot;:&quot;部门&quot;,&quot;frequency&quot;:100000,&quot;inherited&quot;:true}],&quot;properties&quot;:{},&quot;sqlInfo&quot;:{},&quot;sqlEvaluation&quot;:{},&quot;queryType&quot;:&quot;ID&quot;,&quot;dataSetId&quot;:1},&quot;queryMode&quot;:&quot;METRIC_GROUPBY&quot;},{&quot;parseInfo&quot;:{&quot;queryMode&quot;:&quot;METRIC_MODEL&quot;,&quot;dataSet&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;id&quot;:1,&quot;name&quot;:&quot;超音数数据集&quot;,&quot;bizName&quot;:&quot;s2&quot;,&quot;type&quot;:&quot;DATASET&quot;,&quot;order&quot;:0.0,&quot;isTag&quot;:0},&quot;metrics&quot;:[{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:1,&quot;name&quot;:&quot;访问次数&quot;,&quot;bizName&quot;:&quot;pv&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false},{&quot;dimensionId&quot;:2,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;SUM&quot;,&quot;order&quot;:0.0,&quot;isTag&quot;:0,&quot;description&quot;:&quot;一段时间内用户的访问次数&quot;},{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:4,&quot;name&quot;:&quot;人均访问次数&quot;,&quot;bizName&quot;:&quot;pv_avg&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[&quot;平均访问次数&quot;],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;&quot;,&quot;order&quot;:0.002841870251016343,&quot;isTag&quot;:0,&quot;description&quot;:&quot;每个用户平均访问的次数&quot;},{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:3,&quot;name&quot;:&quot;访问用户数&quot;,&quot;bizName&quot;:&quot;uv&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[&quot;UV&quot;,&quot;访问人数&quot;],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;count&quot;,&quot;order&quot;:0.004658766300494777,&quot;isTag&quot;:0,&quot;description&quot;:&quot;访问的用户个数&quot;}],&quot;dimensions&quot;:[],&quot;aggType&quot;:&quot;NONE&quot;,&quot;filterType&quot;:&quot;AND&quot;,&quot;dimensionFilters&quot;:[],&quot;metricFilters&quot;:[],&quot;orders&quot;:[],&quot;dateInfo&quot;:{&quot;dateMode&quot;:&quot;RECENT&quot;,&quot;startDate&quot;:&quot;2024-06-08&quot;,&quot;endDate&quot;:&quot;2024-07-07&quot;,&quot;dateList&quot;:[&quot;2024-06-08&quot;,&quot;2024-06-09&quot;,&quot;2024-06-10&quot;,&quot;2024-06-11&quot;,&quot;2024-06-12&quot;,&quot;2024-06-13&quot;,&quot;2024-06-14&quot;,&quot;2024-06-15&quot;,&quot;2024-06-16&quot;,&quot;2024-06-17&quot;,&quot;2024-06-18&quot;,&quot;2024-06-19&quot;,&quot;2024-06-20&quot;,&quot;2024-06-21&quot;,&quot;2024-06-22&quot;,&quot;2024-06-23&quot;,&quot;2024-06-24&quot;,&quot;2024-06-25&quot;,&quot;2024-06-26&quot;,&quot;2024-06-27&quot;,&quot;2024-06-28&quot;,&quot;2024-06-29&quot;,&quot;2024-06-30&quot;,&quot;2024-07-01&quot;,&quot;2024-07-02&quot;,&quot;2024-07-03&quot;,&quot;2024-07-04&quot;,&quot;2024-07-05&quot;,&quot;2024-07-06&quot;,&quot;2024-07-07&quot;],&quot;unit&quot;:30,&quot;period&quot;:&quot;DAY&quot;,&quot;detectWord&quot;:&quot;近30天&quot;,&quot;groupByDate&quot;:false,&quot;inherited&quot;:true,&quot;groupByTimeDimension&quot;:&quot;sys_imp_date&quot;},&quot;limit&quot;:365,&quot;score&quot;:4.0,&quot;elementMatches&quot;:[{&quot;element&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:1,&quot;name&quot;:&quot;访问次数&quot;,&quot;bizName&quot;:&quot;pv&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false},{&quot;dimensionId&quot;:2,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;SUM&quot;,&quot;order&quot;:0.0,&quot;isTag&quot;:0,&quot;description&quot;:&quot;一段时间内用户的访问次数&quot;},&quot;similarity&quot;:1.0,&quot;detectWord&quot;:&quot;访问次数&quot;,&quot;word&quot;:&quot;访问次数&quot;,&quot;frequency&quot;:100000,&quot;inherited&quot;:false},{&quot;element&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:4,&quot;name&quot;:&quot;人均访问次数&quot;,&quot;bizName&quot;:&quot;pv_avg&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[&quot;平均访问次数&quot;],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;&quot;,&quot;order&quot;:0.002841870251016343,&quot;isTag&quot;:0,&quot;description&quot;:&quot;每个用户平均访问的次数&quot;},&quot;similarity&quot;:0.9971581297489837,&quot;detectWord&quot;:&quot;人访问次数&quot;,&quot;word&quot;:&quot;人均访问次数&quot;,&quot;frequency&quot;:100000,&quot;inherited&quot;:false},{&quot;element&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:3,&quot;name&quot;:&quot;访问用户数&quot;,&quot;bizName&quot;:&quot;uv&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[&quot;UV&quot;,&quot;访问人数&quot;],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;count&quot;,&quot;order&quot;:0.004658766300494777,&quot;isTag&quot;:0,&quot;description&quot;:&quot;访问的用户个数&quot;},&quot;similarity&quot;:0.9953412336995052,&quot;detectWord&quot;:&quot;访问次数&quot;,&quot;word&quot;:&quot;访问用户数&quot;,&quot;frequency&quot;:100000,&quot;inherited&quot;:false}],&quot;properties&quot;:{},&quot;sqlInfo&quot;:{},&quot;sqlEvaluation&quot;:{},&quot;queryType&quot;:&quot;ID&quot;,&quot;dataSetId&quot;:1},&quot;queryMode&quot;:&quot;METRIC_MODEL&quot;}],&quot;mapInfo&quot;:{&quot;dataSetElementMatches&quot;:{&quot;1&quot;:[{&quot;element&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:1,&quot;name&quot;:&quot;访问次数&quot;,&quot;bizName&quot;:&quot;pv&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false},{&quot;dimensionId&quot;:2,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;SUM&quot;,&quot;order&quot;:0.0,&quot;isTag&quot;:0,&quot;description&quot;:&quot;一段时间内用户的访问次数&quot;},&quot;similarity&quot;:1.0,&quot;detectWord&quot;:&quot;访问次数&quot;,&quot;word&quot;:&quot;访问次数&quot;,&quot;frequency&quot;:100000,&quot;inherited&quot;:false},{&quot;element&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:4,&quot;name&quot;:&quot;人均访问次数&quot;,&quot;bizName&quot;:&quot;pv_avg&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[&quot;平均访问次数&quot;],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;&quot;,&quot;order&quot;:0.002841870251016343,&quot;isTag&quot;:0,&quot;description&quot;:&quot;每个用户平均访问的次数&quot;},&quot;similarity&quot;:0.9971581297489837,&quot;detectWord&quot;:&quot;人访问次数&quot;,&quot;word&quot;:&quot;人均访问次数&quot;,&quot;frequency&quot;:100000,&quot;inherited&quot;:false},{&quot;element&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:3,&quot;name&quot;:&quot;访问用户数&quot;,&quot;bizName&quot;:&quot;uv&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[&quot;UV&quot;,&quot;访问人数&quot;],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;count&quot;,&quot;order&quot;:0.004658766300494777,&quot;isTag&quot;:0,&quot;description&quot;:&quot;访问的用户个数&quot;},&quot;similarity&quot;:0.9953412336995052,&quot;detectWord&quot;:&quot;访问次数&quot;,&quot;word&quot;:&quot;访问用户数&quot;,&quot;frequency&quot;:100000,&quot;inherited&quot;:false},{&quot;element&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:1,&quot;id&quot;:1,&quot;name&quot;:&quot;部门&quot;,&quot;bizName&quot;:&quot;department&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;DIMENSION&quot;,&quot;alias&quot;:[],&quot;schemaValueMaps&quot;:[],&quot;order&quot;:0.0,&quot;isTag&quot;:1,&quot;description&quot;:&quot;&quot;},&quot;similarity&quot;:1.0,&quot;detectWord&quot;:&quot;部门&quot;,&quot;word&quot;:&quot;部门&quot;,&quot;frequency&quot;:100000,&quot;inherited&quot;:true}]},&quot;matchedDataSetInfos&quot;:[1]},&quot;mapModeEnum&quot;:&quot;STRICT&quot;,&quot;queryDataType&quot;:&quot;ALL&quot;,&quot;llmConfig&quot;:{&quot;provider&quot;:&quot;OPEN_AI&quot;,&quot;baseUrl&quot;:&quot;https://api.openai.com/v1&quot;,&quot;apiKey&quot;:&quot;kGA4i6jY7QqG5xH+S0N++SzVWVKyAHesOq7NpoFVI7pgU14eb1AM296OFiLJTNtDVfpWDpfu7o4vDG2C2yWiSA==&quot;,&quot;modelName&quot;:&quot;gpt-3.5-turbo&quot;,&quot;temperature&quot;:0.0,&quot;timeOut&quot;:60},&quot;exemplars&quot;:[]}
14:57:19 [http-nio-9080-exec-2] DEBUG c.t.s.h.s.w.s.i.WorkflowServiceImpl 67 - QueryTypeParser result:{&quot;queryText&quot;:&quot;超音速对比所有人访问次数&quot;,&quot;chatId&quot;:1,&quot;dataSetIds&quot;:[],&quot;modelIdToDataSetIds&quot;:{&quot;1&quot;:[1],&quot;2&quot;:[1],&quot;3&quot;:[1],&quot;4&quot;:[2]},&quot;user&quot;:{&quot;id&quot;:6,&quot;name&quot;:&quot;admin&quot;,&quot;displayName&quot;:&quot;admin&quot;,&quot;email&quot;:&quot;null&quot;,&quot;isAdmin&quot;:1,&quot;superAdmin&quot;:true},&quot;saveAnswer&quot;:true,&quot;text2SQLType&quot;:&quot;RULE_AND_LLM&quot;,&quot;candidateQueries&quot;:[{&quot;parseInfo&quot;:{&quot;queryMode&quot;:&quot;LLM_S2SQL&quot;,&quot;dataSet&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;id&quot;:1,&quot;name&quot;:&quot;超音数数据集&quot;,&quot;bizName&quot;:&quot;s2&quot;,&quot;type&quot;:&quot;DATASET&quot;,&quot;order&quot;:0.0,&quot;isTag&quot;:0},&quot;metrics&quot;:[],&quot;dimensions&quot;:[],&quot;aggType&quot;:&quot;NONE&quot;,&quot;filterType&quot;:&quot;AND&quot;,&quot;dimensionFilters&quot;:[],&quot;metricFilters&quot;:[],&quot;orders&quot;:[],&quot;score&quot;:24.0,&quot;elementMatches&quot;:[{&quot;element&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:1,&quot;name&quot;:&quot;访问次数&quot;,&quot;bizName&quot;:&quot;pv&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false},{&quot;dimensionId&quot;:2,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;SUM&quot;,&quot;order&quot;:0.0,&quot;isTag&quot;:0,&quot;description&quot;:&quot;一段时间内用户的访问次数&quot;},&quot;similarity&quot;:1.0,&quot;detectWord&quot;:&quot;访问次数&quot;,&quot;word&quot;:&quot;访问次数&quot;,&quot;frequency&quot;:100000,&quot;inherited&quot;:false},{&quot;element&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:4,&quot;name&quot;:&quot;人均访问次数&quot;,&quot;bizName&quot;:&quot;pv_avg&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[&quot;平均访问次数&quot;],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;&quot;,&quot;order&quot;:0.002841870251016343,&quot;isTag&quot;:0,&quot;description&quot;:&quot;每个用户平均访问的次数&quot;},&quot;similarity&quot;:0.9971581297489837,&quot;detectWord&quot;:&quot;人访问次数&quot;,&quot;word&quot;:&quot;人均访问次数&quot;,&quot;frequency&quot;:100000,&quot;inherited&quot;:false},{&quot;element&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:3,&quot;name&quot;:&quot;访问用户数&quot;,&quot;bizName&quot;:&quot;uv&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[&quot;UV&quot;,&quot;访问人数&quot;],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;count&quot;,&quot;order&quot;:0.004658766300494777,&quot;isTag&quot;:0,&quot;description&quot;:&quot;访问的用户个数&quot;},&quot;similarity&quot;:0.9953412336995052,&quot;detectWord&quot;:&quot;访问次数&quot;,&quot;word&quot;:&quot;访问用户数&quot;,&quot;frequency&quot;:100000,&quot;inherited&quot;:false},{&quot;element&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:1,&quot;id&quot;:1,&quot;name&quot;:&quot;部门&quot;,&quot;bizName&quot;:&quot;department&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;DIMENSION&quot;,&quot;alias&quot;:[],&quot;schemaValueMaps&quot;:[],&quot;order&quot;:0.0,&quot;isTag&quot;:1,&quot;description&quot;:&quot;&quot;},&quot;similarity&quot;:1.0,&quot;detectWord&quot;:&quot;部门&quot;,&quot;word&quot;:&quot;部门&quot;,&quot;frequency&quot;:100000,&quot;inherited&quot;:true}],&quot;properties&quot;:{&quot;type&quot;:&quot;internal&quot;,&quot;CONTEXT&quot;:{&quot;dataSetId&quot;:1,&quot;llmReq&quot;:{&quot;queryText&quot;:&quot;超音速对比所有人访问次数&quot;,&quot;filterCondition&quot;:{},&quot;schema&quot;:{&quot;domainName&quot;:&quot;超音数数据集&quot;,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;dataSetId&quot;:1,&quot;fieldNameList&quot;:[&quot;访问用户数&quot;,&quot;用户&quot;,&quot;部门&quot;,&quot;访问次数&quot;,&quot;人均访问次数&quot;,&quot;停留时长&quot;,&quot;页面&quot;,&quot;数据日期&quot;],&quot;metrics&quot;:[{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:1,&quot;name&quot;:&quot;访问次数&quot;,&quot;bizName&quot;:&quot;pv&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false},{&quot;dimensionId&quot;:2,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;SUM&quot;,&quot;order&quot;:0.0,&quot;isTag&quot;:0,&quot;description&quot;:&quot;一段时间内用户的访问次数&quot;},{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:4,&quot;name&quot;:&quot;人均访问次数&quot;,&quot;bizName&quot;:&quot;pv_avg&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[&quot;平均访问次数&quot;],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;&quot;,&quot;order&quot;:0.002841870251016343,&quot;isTag&quot;:0,&quot;description&quot;:&quot;每个用户平均访问的次数&quot;},{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:3,&quot;name&quot;:&quot;访问用户数&quot;,&quot;bizName&quot;:&quot;uv&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[&quot;UV&quot;,&quot;访问人数&quot;],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;count&quot;,&quot;order&quot;:0.004658766300494777,&quot;isTag&quot;:0,&quot;description&quot;:&quot;访问的用户个数&quot;}],&quot;dimensions&quot;:[{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:1,&quot;id&quot;:1,&quot;name&quot;:&quot;部门&quot;,&quot;bizName&quot;:&quot;department&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;DIMENSION&quot;,&quot;alias&quot;:[],&quot;schemaValueMaps&quot;:[],&quot;order&quot;:0.0,&quot;isTag&quot;:1,&quot;description&quot;:&quot;&quot;}],&quot;terms&quot;:[]},&quot;linking&quot;:[],&quot;currentDate&quot;:&quot;2024-08-07&quot;,&quot;priorExts&quot;:&quot;&quot;,&quot;sqlGenType&quot;:&quot;1_pass_self_consistency&quot;,&quot;llmConfig&quot;:{&quot;provider&quot;:&quot;OPEN_AI&quot;,&quot;baseUrl&quot;:&quot;https://api.openai.com/v1&quot;,&quot;apiKey&quot;:&quot;kGA4i6jY7QqG5xH+S0N++SzVWVKyAHesOq7NpoFVI7pgU14eb1AM296OFiLJTNtDVfpWDpfu7o4vDG2C2yWiSA==&quot;,&quot;modelName&quot;:&quot;gpt-3.5-turbo&quot;,&quot;temperature&quot;:0.0,&quot;timeOut&quot;:60},&quot;exemplars&quot;:[]},&quot;llmResp&quot;:{&quot;query&quot;:&quot;超音速对比所有人访问次数&quot;,&quot;modelName&quot;:&quot;超音数数据集&quot;,&quot;dbSchema&quot;:&quot;Table: 超音数数据集, Metrics: [访问次数 COMMENT &#x27;一段时间内用户的访问次数&#x27; AGGREGATE &#x27;SUM&#x27;,人均访问次数 COMMENT &#x27;每个用户平均访问的次数&#x27;,访问用户数 COMMENT &#x27;访问的用户个数&#x27; AGGREGATE &#x27;COUNT&#x27;,], Dimensions: [部门,]&quot;,&quot;sqlOutput&quot;:&quot;SELECT SUM(访问次数) FROM 超音数数据集&quot;,&quot;sqlRespMap&quot;:{&quot;SELECT SUM(访问次数) FROM 超音数数据集&quot;:{&quot;sqlWeight&quot;:1.0,&quot;fewShots&quot;:[{&quot;question&quot;:&quot;今年以来发行的歌曲中，有哪些在近7天播放超过一千万的 (补充信息:。当前的日期是2023-08-12) &quot;,&quot;dbSchema&quot;:&quot;Table: 歌曲库, Columns = [\&quot;发行日期\&quot;, \&quot;歌曲语言\&quot;, \&quot;歌曲来源\&quot;, \&quot;歌曲流派\&quot;, \&quot;歌曲名\&quot;, \&quot;歌曲版本\&quot;, \&quot;歌曲类型\&quot;, \&quot;发行时间\&quot;, \&quot;数据日期\&quot;]&quot;,&quot;sql&quot;:&quot;SELECT 歌曲名 FROM 歌曲库 WHERE datediff(&#x27;year&#x27;, 发行日期, &#x27;2023-08-12&#x27;) &lt;= 0 AND datediff(&#x27;day&#x27;, 数据日期, &#x27;2023-08-12&#x27;) &lt;= 7 AND 结算播放量 &gt; 10000000&quot;},{&quot;question&quot;:&quot;超音数近半年每个月的平均访问次数 (补充信息:。当前的日期是2023-09-04) &quot;,&quot;dbSchema&quot;:&quot;Table: 超音数产品, Columns = [\&quot;用户名\&quot;, \&quot;部门\&quot;, \&quot;模块\&quot;, \&quot;访问时长\&quot;, \&quot;访问次数\&quot;, \&quot;访问人数\&quot;, \&quot;数据日期\&quot;]&quot;,&quot;sql&quot;:&quot;SELECT MONTH(数据日期), AVG(访问次数) FROM 超音数产品 WHERE datediff(&#x27;year&#x27;, 数据日期, &#x27;2023-09-04&#x27;) &lt;= 0.5 GROUP BY MONTH(数据日期)&quot;},{&quot;question&quot;:&quot;我想要近半年签约的播放量前十的歌手有哪些 (补充信息:。当前的日期是2023-09-11) &quot;,&quot;dbSchema&quot;:&quot;Table: 艺人库, Columns = [\&quot;播放量层级\&quot;, \&quot;播放量单调性\&quot;, \&quot;播放量方差\&quot;, \&quot;播放量突增类型\&quot;, \&quot;播放量集中度\&quot;, \&quot;歌手名\&quot;, \&quot;歌手等级\&quot;, \&quot;歌手类型\&quot;, \&quot;歌手来源\&quot;, \&quot;签约日期\&quot;, \&quot;MPPM潮流人等级\&quot;, \&quot;结算播放量\&quot;, \&quot;运营播放量\&quot;, \&quot;历史累计结算播放量\&quot;, \&quot;有播放量歌曲数\&quot;, \&quot;历史累计运营播放量\&quot;, \&quot;付费用户结算播放量\&quot;, \&quot;结算播放量占比\&quot;, \&quot;运营播放份额\&quot;, \&quot;免费用户结算播放占比\&quot;, \&quot;完播量\&quot;, \&quot;数据日期\&quot;]&quot;,&quot;sql&quot;:&quot;SELECT 歌手名 FROM 艺人库 WHERE datediff(&#x27;year&#x27;, 签约日期, &#x27;2023-09-11&#x27;) &lt;= 0.5 ORDER BY 结算播放量 DESC LIMIT 10&quot;},{&quot;question&quot;:&quot;播放量大于1万的歌曲有多少 (补充信息:。当前的日期是2023-07-31) &quot;,&quot;dbSchema&quot;:&quot;Table: 歌曲库, Columns = [\&quot;歌曲名\&quot;, \&quot;歌曲版本\&quot;, \&quot;歌曲类型\&quot;, \&quot;MPPM歌曲ID\&quot;, \&quot;是否严选窄口径歌曲\&quot;, \&quot;是否严选宽口径歌曲\&quot;, \&quot;是否潮流人歌曲\&quot;, \&quot;超声波歌曲ID\&quot;, \&quot;C音歌曲ID\&quot;, \&quot;C音歌曲MID\&quot;, \&quot;结算播放量\&quot;, \&quot;运营播放量\&quot;, \&quot;分享量\&quot;, \&quot;收藏量\&quot;, \&quot;运营搜播量\&quot;, \&quot;结算搜播量\&quot;, \&quot;拉新用户数\&quot;, \&quot;拉活用户数\&quot;, \&quot;分享率\&quot;, \&quot;结算播放份额\&quot;, \&quot;数据日期\&quot;]&quot;,&quot;sql&quot;:&quot;SELECT 歌曲名 FROM 歌曲库 WHERE 结算播放量 &gt; 10000&quot;},{&quot;question&quot;:&quot;超音数访问次数大于1k的部门是哪些 (补充信息:。当前的日期是2023-09-14) &quot;,&quot;dbSchema&quot;:&quot;Table: 超音数产品, Columns = [\&quot;部门\&quot;, \&quot;模块\&quot;, \&quot;用户名\&quot;, \&quot;访问次数\&quot;, \&quot;访问人数\&quot;, \&quot;访问时长\&quot;, \&quot;数据日期\&quot;]&quot;,&quot;sql&quot;:&quot;SELECT 部门 FROM 超音数产品 WHERE 访问次数 &gt; 1000&quot;}]}}},&quot;linkingValues&quot;:[]}},&quot;sqlInfo&quot;:{&quot;s2SQL&quot;:&quot;SELECT SUM(访问次数) FROM 超音数数据集&quot;,&quot;correctS2SQL&quot;:&quot;SELECT SUM(访问次数) FROM 超音数数据集&quot;},&quot;sqlEvaluation&quot;:{},&quot;queryType&quot;:&quot;METRIC&quot;,&quot;dataSetId&quot;:1},&quot;queryMode&quot;:&quot;LLM_S2SQL&quot;},{&quot;parseInfo&quot;:{&quot;queryMode&quot;:&quot;METRIC_GROUPBY&quot;,&quot;dataSet&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;id&quot;:1,&quot;name&quot;:&quot;超音数数据集&quot;,&quot;bizName&quot;:&quot;s2&quot;,&quot;type&quot;:&quot;DATASET&quot;,&quot;order&quot;:0.0,&quot;isTag&quot;:0},&quot;metrics&quot;:[{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:1,&quot;name&quot;:&quot;访问次数&quot;,&quot;bizName&quot;:&quot;pv&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false},{&quot;dimensionId&quot;:2,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;SUM&quot;,&quot;order&quot;:0.0,&quot;isTag&quot;:0,&quot;description&quot;:&quot;一段时间内用户的访问次数&quot;},{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:4,&quot;name&quot;:&quot;人均访问次数&quot;,&quot;bizName&quot;:&quot;pv_avg&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[&quot;平均访问次数&quot;],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;&quot;,&quot;order&quot;:0.002841870251016343,&quot;isTag&quot;:0,&quot;description&quot;:&quot;每个用户平均访问的次数&quot;},{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:3,&quot;name&quot;:&quot;访问用户数&quot;,&quot;bizName&quot;:&quot;uv&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[&quot;UV&quot;,&quot;访问人数&quot;],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;count&quot;,&quot;order&quot;:0.004658766300494777,&quot;isTag&quot;:0,&quot;description&quot;:&quot;访问的用户个数&quot;}],&quot;dimensions&quot;:[{&quot;bizName&quot;:&quot;sys_imp_date&quot;,&quot;order&quot;:0.0,&quot;isTag&quot;:0},{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:1,&quot;id&quot;:1,&quot;name&quot;:&quot;部门&quot;,&quot;bizName&quot;:&quot;department&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;DIMENSION&quot;,&quot;alias&quot;:[],&quot;schemaValueMaps&quot;:[],&quot;order&quot;:0.0,&quot;isTag&quot;:1,&quot;description&quot;:&quot;&quot;}],&quot;aggType&quot;:&quot;NONE&quot;,&quot;filterType&quot;:&quot;AND&quot;,&quot;dimensionFilters&quot;:[],&quot;metricFilters&quot;:[],&quot;orders&quot;:[],&quot;dateInfo&quot;:{&quot;dateMode&quot;:&quot;RECENT&quot;,&quot;startDate&quot;:&quot;2024-06-08&quot;,&quot;endDate&quot;:&quot;2024-07-07&quot;,&quot;dateList&quot;:[&quot;2024-06-08&quot;,&quot;2024-06-09&quot;,&quot;2024-06-10&quot;,&quot;2024-06-11&quot;,&quot;2024-06-12&quot;,&quot;2024-06-13&quot;,&quot;2024-06-14&quot;,&quot;2024-06-15&quot;,&quot;2024-06-16&quot;,&quot;2024-06-17&quot;,&quot;2024-06-18&quot;,&quot;2024-06-19&quot;,&quot;2024-06-20&quot;,&quot;2024-06-21&quot;,&quot;2024-06-22&quot;,&quot;2024-06-23&quot;,&quot;2024-06-24&quot;,&quot;2024-06-25&quot;,&quot;2024-06-26&quot;,&quot;2024-06-27&quot;,&quot;2024-06-28&quot;,&quot;2024-06-29&quot;,&quot;2024-06-30&quot;,&quot;2024-07-01&quot;,&quot;2024-07-02&quot;,&quot;2024-07-03&quot;,&quot;2024-07-04&quot;,&quot;2024-07-05&quot;,&quot;2024-07-06&quot;,&quot;2024-07-07&quot;],&quot;unit&quot;:30,&quot;period&quot;:&quot;DAY&quot;,&quot;detectWord&quot;:&quot;近30天&quot;,&quot;groupByDate&quot;:false,&quot;inherited&quot;:true,&quot;groupByTimeDimension&quot;:&quot;sys_imp_date&quot;},&quot;limit&quot;:365,&quot;score&quot;:6.0,&quot;elementMatches&quot;:[{&quot;element&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:1,&quot;name&quot;:&quot;访问次数&quot;,&quot;bizName&quot;:&quot;pv&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false},{&quot;dimensionId&quot;:2,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;SUM&quot;,&quot;order&quot;:0.0,&quot;isTag&quot;:0,&quot;description&quot;:&quot;一段时间内用户的访问次数&quot;},&quot;similarity&quot;:1.0,&quot;detectWord&quot;:&quot;访问次数&quot;,&quot;word&quot;:&quot;访问次数&quot;,&quot;frequency&quot;:100000,&quot;inherited&quot;:false},{&quot;element&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:4,&quot;name&quot;:&quot;人均访问次数&quot;,&quot;bizName&quot;:&quot;pv_avg&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[&quot;平均访问次数&quot;],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;&quot;,&quot;order&quot;:0.002841870251016343,&quot;isTag&quot;:0,&quot;description&quot;:&quot;每个用户平均访问的次数&quot;},&quot;similarity&quot;:0.9971581297489837,&quot;detectWord&quot;:&quot;人访问次数&quot;,&quot;word&quot;:&quot;人均访问次数&quot;,&quot;frequency&quot;:100000,&quot;inherited&quot;:false},{&quot;element&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:3,&quot;name&quot;:&quot;访问用户数&quot;,&quot;bizName&quot;:&quot;uv&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[&quot;UV&quot;,&quot;访问人数&quot;],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;count&quot;,&quot;order&quot;:0.004658766300494777,&quot;isTag&quot;:0,&quot;description&quot;:&quot;访问的用户个数&quot;},&quot;similarity&quot;:0.9953412336995052,&quot;detectWord&quot;:&quot;访问次数&quot;,&quot;word&quot;:&quot;访问用户数&quot;,&quot;frequency&quot;:100000,&quot;inherited&quot;:false},{&quot;element&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:1,&quot;id&quot;:1,&quot;name&quot;:&quot;部门&quot;,&quot;bizName&quot;:&quot;department&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;DIMENSION&quot;,&quot;alias&quot;:[],&quot;schemaValueMaps&quot;:[],&quot;order&quot;:0.0,&quot;isTag&quot;:1,&quot;description&quot;:&quot;&quot;},&quot;similarity&quot;:1.0,&quot;detectWord&quot;:&quot;部门&quot;,&quot;word&quot;:&quot;部门&quot;,&quot;frequency&quot;:100000,&quot;inherited&quot;:true}],&quot;properties&quot;:{},&quot;sqlInfo&quot;:{&quot;s2SQL&quot;:&quot;SELECT sys_imp_date, 部门, SUM(访问次数) AS 访问次数 FROM 超音数数据集 WHERE sys_imp_date &gt;= &#x27;2024-07-08&#x27; AND sys_imp_date &lt;= &#x27;2024-08-06&#x27; GROUP BY sys_imp_date, 部门 LIMIT 365&quot;,&quot;correctS2SQL&quot;:&quot;SELECT sys_imp_date, 部门, SUM(访问次数) AS 访问次数 FROM 超音数数据集 WHERE sys_imp_date &gt;= &#x27;2024-07-08&#x27; AND sys_imp_date &lt;= &#x27;2024-08-06&#x27; GROUP BY sys_imp_date, 部门 LIMIT 365&quot;},&quot;sqlEvaluation&quot;:{},&quot;queryType&quot;:&quot;METRIC&quot;,&quot;dataSetId&quot;:1},&quot;queryMode&quot;:&quot;METRIC_GROUPBY&quot;},{&quot;parseInfo&quot;:{&quot;queryMode&quot;:&quot;METRIC_MODEL&quot;,&quot;dataSet&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;id&quot;:1,&quot;name&quot;:&quot;超音数数据集&quot;,&quot;bizName&quot;:&quot;s2&quot;,&quot;type&quot;:&quot;DATASET&quot;,&quot;order&quot;:0.0,&quot;isTag&quot;:0},&quot;metrics&quot;:[{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:1,&quot;name&quot;:&quot;访问次数&quot;,&quot;bizName&quot;:&quot;pv&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false},{&quot;dimensionId&quot;:2,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;SUM&quot;,&quot;order&quot;:0.0,&quot;isTag&quot;:0,&quot;description&quot;:&quot;一段时间内用户的访问次数&quot;},{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:4,&quot;name&quot;:&quot;人均访问次数&quot;,&quot;bizName&quot;:&quot;pv_avg&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[&quot;平均访问次数&quot;],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;&quot;,&quot;order&quot;:0.002841870251016343,&quot;isTag&quot;:0,&quot;description&quot;:&quot;每个用户平均访问的次数&quot;},{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:3,&quot;name&quot;:&quot;访问用户数&quot;,&quot;bizName&quot;:&quot;uv&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[&quot;UV&quot;,&quot;访问人数&quot;],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;count&quot;,&quot;order&quot;:0.004658766300494777,&quot;isTag&quot;:0,&quot;description&quot;:&quot;访问的用户个数&quot;}],&quot;dimensions&quot;:[{&quot;bizName&quot;:&quot;sys_imp_date&quot;,&quot;order&quot;:0.0,&quot;isTag&quot;:0}],&quot;aggType&quot;:&quot;NONE&quot;,&quot;filterType&quot;:&quot;AND&quot;,&quot;dimensionFilters&quot;:[],&quot;metricFilters&quot;:[],&quot;orders&quot;:[],&quot;dateInfo&quot;:{&quot;dateMode&quot;:&quot;RECENT&quot;,&quot;startDate&quot;:&quot;2024-06-08&quot;,&quot;endDate&quot;:&quot;2024-07-07&quot;,&quot;dateList&quot;:[&quot;2024-06-08&quot;,&quot;2024-06-09&quot;,&quot;2024-06-10&quot;,&quot;2024-06-11&quot;,&quot;2024-06-12&quot;,&quot;2024-06-13&quot;,&quot;2024-06-14&quot;,&quot;2024-06-15&quot;,&quot;2024-06-16&quot;,&quot;2024-06-17&quot;,&quot;2024-06-18&quot;,&quot;2024-06-19&quot;,&quot;2024-06-20&quot;,&quot;2024-06-21&quot;,&quot;2024-06-22&quot;,&quot;2024-06-23&quot;,&quot;2024-06-24&quot;,&quot;2024-06-25&quot;,&quot;2024-06-26&quot;,&quot;2024-06-27&quot;,&quot;2024-06-28&quot;,&quot;2024-06-29&quot;,&quot;2024-06-30&quot;,&quot;2024-07-01&quot;,&quot;2024-07-02&quot;,&quot;2024-07-03&quot;,&quot;2024-07-04&quot;,&quot;2024-07-05&quot;,&quot;2024-07-06&quot;,&quot;2024-07-07&quot;],&quot;unit&quot;:30,&quot;period&quot;:&quot;DAY&quot;,&quot;detectWord&quot;:&quot;近30天&quot;,&quot;groupByDate&quot;:false,&quot;inherited&quot;:true,&quot;groupByTimeDimension&quot;:&quot;sys_imp_date&quot;},&quot;limit&quot;:365,&quot;score&quot;:4.0,&quot;elementMatches&quot;:[{&quot;element&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:1,&quot;name&quot;:&quot;访问次数&quot;,&quot;bizName&quot;:&quot;pv&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false},{&quot;dimensionId&quot;:2,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;SUM&quot;,&quot;order&quot;:0.0,&quot;isTag&quot;:0,&quot;description&quot;:&quot;一段时间内用户的访问次数&quot;},&quot;similarity&quot;:1.0,&quot;detectWord&quot;:&quot;访问次数&quot;,&quot;word&quot;:&quot;访问次数&quot;,&quot;frequency&quot;:100000,&quot;inherited&quot;:false},{&quot;element&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:4,&quot;name&quot;:&quot;人均访问次数&quot;,&quot;bizName&quot;:&quot;pv_avg&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[&quot;平均访问次数&quot;],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;&quot;,&quot;order&quot;:0.002841870251016343,&quot;isTag&quot;:0,&quot;description&quot;:&quot;每个用户平均访问的次数&quot;},&quot;similarity&quot;:0.9971581297489837,&quot;detectWord&quot;:&quot;人访问次数&quot;,&quot;word&quot;:&quot;人均访问次数&quot;,&quot;frequency&quot;:100000,&quot;inherited&quot;:false},{&quot;element&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:3,&quot;name&quot;:&quot;访问用户数&quot;,&quot;bizName&quot;:&quot;uv&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[&quot;UV&quot;,&quot;访问人数&quot;],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;count&quot;,&quot;order&quot;:0.004658766300494777,&quot;isTag&quot;:0,&quot;description&quot;:&quot;访问的用户个数&quot;},&quot;similarity&quot;:0.9953412336995052,&quot;detectWord&quot;:&quot;访问次数&quot;,&quot;word&quot;:&quot;访问用户数&quot;,&quot;frequency&quot;:100000,&quot;inherited&quot;:false}],&quot;properties&quot;:{},&quot;sqlInfo&quot;:{&quot;s2SQL&quot;:&quot;SELECT sys_imp_date, SUM(访问次数) AS 访问次数 FROM 超音数数据集 WHERE sys_imp_date &gt;= &#x27;2024-07-08&#x27; AND sys_imp_date &lt;= &#x27;2024-08-06&#x27; GROUP BY sys_imp_date LIMIT 365&quot;,&quot;correctS2SQL&quot;:&quot;SELECT sys_imp_date, SUM(访问次数) AS 访问次数 FROM 超音数数据集 WHERE sys_imp_date &gt;= &#x27;2024-07-08&#x27; AND sys_imp_date &lt;= &#x27;2024-08-06&#x27; GROUP BY sys_imp_date LIMIT 365&quot;},&quot;sqlEvaluation&quot;:{},&quot;queryType&quot;:&quot;METRIC&quot;,&quot;dataSetId&quot;:1},&quot;queryMode&quot;:&quot;METRIC_MODEL&quot;}],&quot;mapInfo&quot;:{&quot;dataSetElementMatches&quot;:{&quot;1&quot;:[{&quot;element&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:1,&quot;name&quot;:&quot;访问次数&quot;,&quot;bizName&quot;:&quot;pv&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false},{&quot;dimensionId&quot;:2,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;SUM&quot;,&quot;order&quot;:0.0,&quot;isTag&quot;:0,&quot;description&quot;:&quot;一段时间内用户的访问次数&quot;},&quot;similarity&quot;:1.0,&quot;detectWord&quot;:&quot;访问次数&quot;,&quot;word&quot;:&quot;访问次数&quot;,&quot;frequency&quot;:100000,&quot;inherited&quot;:false},{&quot;element&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:4,&quot;name&quot;:&quot;人均访问次数&quot;,&quot;bizName&quot;:&quot;pv_avg&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[&quot;平均访问次数&quot;],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;&quot;,&quot;order&quot;:0.002841870251016343,&quot;isTag&quot;:0,&quot;description&quot;:&quot;每个用户平均访问的次数&quot;},&quot;similarity&quot;:0.9971581297489837,&quot;detectWord&quot;:&quot;人访问次数&quot;,&quot;word&quot;:&quot;人均访问次数&quot;,&quot;frequency&quot;:100000,&quot;inherited&quot;:false},{&quot;element&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:2,&quot;id&quot;:3,&quot;name&quot;:&quot;访问用户数&quot;,&quot;bizName&quot;:&quot;uv&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;METRIC&quot;,&quot;alias&quot;:[&quot;UV&quot;,&quot;访问人数&quot;],&quot;relatedSchemaElements&quot;:[{&quot;dimensionId&quot;:1,&quot;necessary&quot;:false}],&quot;defaultAgg&quot;:&quot;count&quot;,&quot;order&quot;:0.004658766300494777,&quot;isTag&quot;:0,&quot;description&quot;:&quot;访问的用户个数&quot;},&quot;similarity&quot;:0.9953412336995052,&quot;detectWord&quot;:&quot;访问次数&quot;,&quot;word&quot;:&quot;访问用户数&quot;,&quot;frequency&quot;:100000,&quot;inherited&quot;:false},{&quot;element&quot;:{&quot;dataSet&quot;:1,&quot;dataSetName&quot;:&quot;超音数数据集&quot;,&quot;model&quot;:1,&quot;id&quot;:1,&quot;name&quot;:&quot;部门&quot;,&quot;bizName&quot;:&quot;department&quot;,&quot;useCnt&quot;:0,&quot;type&quot;:&quot;DIMENSION&quot;,&quot;alias&quot;:[],&quot;schemaValueMaps&quot;:[],&quot;order&quot;:0.0,&quot;isTag&quot;:1,&quot;description&quot;:&quot;&quot;},&quot;similarity&quot;:1.0,&quot;detectWord&quot;:&quot;部门&quot;,&quot;word&quot;:&quot;部门&quot;,&quot;frequency&quot;:100000,&quot;inherited&quot;:true}]},&quot;matchedDataSetInfos&quot;:[1]},&quot;mapModeEnum&quot;:&quot;STRICT&quot;,&quot;queryDataType&quot;:&quot;ALL&quot;,&quot;llmConfig&quot;:{&quot;provider&quot;:&quot;OPEN_AI&quot;,&quot;baseUrl&quot;:&quot;https://api.openai.com/v1&quot;,&quot;apiKey&quot;:&quot;kGA4i6jY7QqG5xH+S0N++SzVWVKyAHesOq7NpoFVI7pgU14eb1AM296OFiLJTNtDVfpWDpfu7o4vDG2C2yWiSA==&quot;,&quot;modelName&quot;:&quot;gpt-3.5-turbo&quot;,&quot;temperature&quot;:0.0,&quot;timeOut&quot;:60},&quot;exemplars&quot;:[]}</code></pre><figure id="7e5d1fd0-81ad-45dd-b285-84192f1e36e9" class="link-to-page"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/LMSqlParser%20+%20QueryTypeParser%207e5d1fd081ad45ddb28584192f1e36e9.html">LMSqlParser + QueryTypeParser</a></figure><p id="d6f62152-9c5f-4922-8628-373fcdcf7bbd" class="">使用大模型生成S2SQL，并进行投票选出可信度最高回答作为结果，同时传递给大模型聊天解析的相关信息。</p></li></ol><figure id="06d66372-8602-4cd9-a83a-f68ab621422f" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/image%206.png"><img style="width:624px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/image%206.png"/></a></figure><ol type="1" id="e88755c4-1687-482a-a92a-487eef7479de" class="numbered-list" start="4"><li><code>performCorrecting</code>调用<code>SemanticCorrector</code> 校正SQL</li></ol><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="ec7a6c36-1ae0-4f7d-b7b2-d2487708a399" class="code"><code class="language-JSON" style="white-space:pre-wrap;word-break:break-all">14:57:19 [http-nio-9080-exec-2] DEBUG c.t.s.h.c.c.BaseSemanticCorrector 35 - sqlCorrection:SchemaCorrector sql:SqlInfo(s2SQL=SELECT SUM(访问次数) FROM 超音数数据集, correctS2SQL=SELECT SUM(访问次数) FROM 超音数数据集, querySQL=null, sourceId=null)
14:57:19 [http-nio-9080-exec-2] DEBUG c.t.s.h.c.c.BaseSemanticCorrector 35 - sqlCorrection:TimeCorrector sql:SqlInfo(s2SQL=SELECT SUM(访问次数) FROM 超音数数据集, correctS2SQL=SELECT SUM(访问次数) FROM 超音数数据集 WHERE (数据日期 &gt;= &#x27;2024-07-31&#x27; AND 数据日期 &lt;= &#x27;2024-08-06&#x27;), querySQL=null, sourceId=null)
14:57:19 [http-nio-9080-exec-2] DEBUG c.t.s.h.c.c.BaseSemanticCorrector 35 - sqlCorrection:SelectCorrector sql:SqlInfo(s2SQL=SELECT SUM(访问次数) FROM 超音数数据集, correctS2SQL=SELECT SUM(访问次数) FROM 超音数数据集 WHERE (数据日期 &gt;= &#x27;2024-07-31&#x27; AND 数据日期 &lt;= &#x27;2024-08-06&#x27;), querySQL=null, sourceId=null)
14:57:19 [http-nio-9080-exec-2] DEBUG c.t.s.h.c.c.BaseSemanticCorrector 35 - sqlCorrection:WhereCorrector sql:SqlInfo(s2SQL=SELECT SUM(访问次数) FROM 超音数数据集, correctS2SQL=SELECT SUM(访问次数) FROM 超音数数据集 WHERE (数据日期 &gt;= &#x27;2024-07-31&#x27; AND 数据日期 &lt;= &#x27;2024-08-06&#x27;), querySQL=null, sourceId=null)
14:57:19 [http-nio-9080-exec-2] DEBUG c.t.s.h.c.c.BaseSemanticCorrector 35 - sqlCorrection:GroupByCorrector sql:SqlInfo(s2SQL=SELECT SUM(访问次数) FROM 超音数数据集, correctS2SQL=SELECT SUM(访问次数) FROM 超音数数据集 WHERE (数据日期 &gt;= &#x27;2024-07-31&#x27; AND 数据日期 &lt;= &#x27;2024-08-06&#x27;), querySQL=null, sourceId=null)
14:57:19 [http-nio-9080-exec-2] DEBUG c.t.s.h.c.c.BaseSemanticCorrector 35 - sqlCorrection:AggCorrector sql:SqlInfo(s2SQL=SELECT SUM(访问次数) FROM 超音数数据集, correctS2SQL=SELECT SUM(访问次数) FROM 超音数数据集 WHERE (数据日期 &gt;= &#x27;2024-07-31&#x27; AND 数据日期 &lt;= &#x27;2024-08-06&#x27;), querySQL=null, sourceId=null)
14:57:19 [http-nio-9080-exec-2] DEBUG c.t.s.h.c.c.BaseSemanticCorrector 35 - sqlCorrection:HavingCorrector sql:SqlInfo(s2SQL=SELECT SUM(访问次数) FROM 超音数数据集, correctS2SQL=SELECT SUM(访问次数) FROM 超音数数据集 WHERE (数据日期 &gt;= &#x27;2024-07-31&#x27; AND 数据日期 &lt;= &#x27;2024-08-06&#x27;), querySQL=null, sourceId=null)
14:57:19 [http-nio-9080-exec-2] DEBUG c.t.s.h.c.c.BaseSemanticCorrector 35 - sqlCorrection:GrammarCorrector sql:SqlInfo(s2SQL=SELECT SUM(访问次数) FROM 超音数数据集, correctS2SQL=SELECT SUM(访问次数) FROM 超音数数据集 WHERE (数据日期 &gt;= &#x27;2024-07-31&#x27; AND 数据日期 &lt;= &#x27;2024-08-06&#x27;), querySQL=null, sourceId=null)</code></pre><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="86562d7c-b829-4831-a5aa-d4157eef20f0" class="code"><code class="language-Dart" style="white-space:pre-wrap;word-break:break-all">sql:SqlInfo(

s2SQL=SELECT SUM(访问次数) FROM 超音数数据集, 
correctS2SQL=SELECT SUM(访问次数) FROM 超音数数据集 WHERE (数据日期 &gt;= &#x27;2024-07-31&#x27; AND 数据日期 &lt;= &#x27;2024-08-06&#x27;), 

querySQL=null, sourceId=null)</code></pre><ol type="1" id="0a0d16a1-6d09-424e-bf1d-7916b114df97" class="numbered-list" start="5"><li><code>performProcessing</code>调用<code>ResultProcessor</code>将查询上下文和校正后的信息进行最终处理，生成 <code>ParseResp</code> 对象</li></ol><figure id="25c114eb-8d26-476e-b813-cee0856dcf2a" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/image%207.png"><img style="width:624px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/image%207.png"/></a></figure><figure id="4c8e2410-2f0c-4782-8239-e4d358b79e57" class="link-to-page"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/ParseInfoProcessor%20+SqlInfoProcessor%204c8e24102f0c47828239e4d358b79e57.html">ParseInfoProcessor +SqlInfoProcessor </a></figure><figure id="3bca859b-9850-45c8-85d0-18bd76368224" class="link-to-page"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/SchemaServiceImpl%203bca859b985045c885d018bd76368224.html">SchemaServiceImpl</a></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="528d3502-c64f-473a-ad7a-299da8f7ff91" class="code"><code class="language-JSON" style="white-space:pre-wrap;word-break:break-all">14:57:19 [http-nio-9080-exec-2] DEBUG c.t.s.h.s.w.s.impl.SchemaServiceImpl 451 - statInfos:[]
14:57:19 [http-nio-9080-exec-2] DEBUG c.t.s.h.s.w.s.impl.SchemaServiceImpl 273 - typeIdAndStatPair:{}

14:57:20 [http-nio-9080-exec-2] DEBUG c.t.s.h.s.utils.QueryReqConverter 173 - dataSetId:1,convert name to bizName before:SELECT SUM(访问次数) FROM 超音数数据集 WHERE (数据日期 &gt;= &#x27;2024-07-31&#x27; AND 数据日期 &lt;= &#x27;2024-08-06&#x27;)
14:57:20 [http-nio-9080-exec-2] DEBUG c.t.s.h.s.utils.QueryReqConverter 175 - dataSetId:1,convert name to bizName after:SELECT SUM(pv) FROM 超音数数据集 WHERE (sys_imp_date &gt;= &#x27;2024-07-31&#x27; AND sys_imp_date &lt;= &#x27;2024-08-06&#x27;)
14:57:20 [http-nio-9080-exec-2] DEBUG c.t.s.h.s.utils.QueryReqConverter 243 - correctTableName after:SELECT SUM(pv) FROM t_1 WHERE (sys_imp_date &gt;= &#x27;2024-07-31&#x27; AND sys_imp_date &lt;= &#x27;2024-08-06&#x27;)
14:57:20 [http-nio-9080-exec-2] DEBUG c.t.s.h.s.utils.QueryReqConverter 79 - replaceOrderAggSameAlias SELECT SUM(pv) FROM t_1 WHERE (sys_imp_date &gt;= &#x27;2024-07-31&#x27; AND sys_imp_date &lt;= &#x27;2024-08-06&#x27;) -&gt; SELECT SUM(pv) FROM t_1 WHERE (sys_imp_date &gt;= &#x27;2024-07-31&#x27; AND sys_imp_date &lt;= &#x27;2024-08-06&#x27;)
14:57:20 [http-nio-9080-exec-2] DEBUG c.t.s.h.s.utils.QueryReqConverter 125 - QueryReqConverter queryStructReq[{&quot;dataSetId&quot;:1&quot;modelIds&quot;:[],&quot;groups&quot;:[],&quot;aggregators&quot;:[{&quot;column&quot;:&quot;pv&quot;,&quot;func&quot;:UNKNOWN,&quot;nameCh&quot;:&quot;null&quot;,&quot;args&quot;:null,&quot;alias&quot;:null}],&quot;orders&quot;:[],&quot;dimensionFilters&quot;:[],&quot;metricFilters&quot;:[],&quot;params&quot;:[],&quot;dateInfo&quot;:{&quot;dateMode&quot;:BETWEEN,&quot;startDate&quot;:&quot;2024-08-06&quot;,&quot;endDate&quot;:&quot;2024-07-31&quot;,&quot;dateList&quot;:[],&quot;unit&quot;:1,&quot;period&quot;:&quot;DAY&quot;,&quot;text&quot;:&quot;null&quot;},&quot;limit&quot;:2000,&quot;cacheInfo&quot;:{&quot;cache&quot;:true}}]

14:57:20 [http-nio-9080-exec-2] DEBUG c.t.s.h.c.u.SysTimeDimensionBuilder 19 - addSysTimeDimension before:[Dim(name=部门, type=categorical, expr=null, dateFormat=yyyy-MM-dd, typeParams=null, isCreateDimension=1, bizName=department, description=null, isTag=0)], engineAdaptor:com.tencent.supersonic.headless.core.adaptor.db.MysqlAdaptor@486b5958
14:57:20 [http-nio-9080-exec-2] DEBUG c.t.s.h.c.u.SysTimeDimensionBuilder 19 - addSysTimeDimension before:[Dim(name=, type=time, expr=null, dateFormat=yyyy-MM-dd, typeParams=DimensionTimeTypeParams(isPrimary=true, timeGranularity=day), isCreateDimension=0, bizName=imp_date, description=null, isTag=0), Dim(name=, type=categorical, expr=page, dateFormat=yyyy-MM-dd, typeParams=null, isCreateDimension=0, bizName=page, description=null, isTag=0)], engineAdaptor:com.tencent.supersonic.headless.core.adaptor.db.MysqlAdaptor@486b5958
14:57:20 [http-nio-9080-exec-2] DEBUG c.t.s.h.c.u.SysTimeDimensionBuilder 29 - addSysTimeDimension after:[Dim(name=, type=time, expr=null, dateFormat=yyyy-MM-dd, typeParams=DimensionTimeTypeParams(isPrimary=true, timeGranularity=day), isCreateDimension=0, bizName=imp_date, description=null, isTag=0), Dim(name=, type=categorical, expr=page, dateFormat=yyyy-MM-dd, typeParams=null, isCreateDimension=0, bizName=page, description=null, isTag=0), Dim(name=null, type=time, expr=imp_date, dateFormat=yyyy-MM-dd, typeParams=DimensionTimeTypeParams(isPrimary=true, timeGranularity=day), isCreateDimension=0, bizName=sys_imp_date, description=null, isTag=0), Dim(name=null, type=time, expr=DATE_FORMAT(DATE_SUB(imp_date, INTERVAL (DAYOFWEEK(imp_date) - 2) DAY), &#x27;%Y-%m-%d&#x27;), dateFormat=yyyy-MM-dd, typeParams=DimensionTimeTypeParams(isPrimary=false, timeGranularity=week), isCreateDimension=0, bizName=sys_imp_week, description=null, isTag=0), Dim(name=null, type=time, expr=DATE_FORMAT(imp_date, &#x27;%Y-%m&#x27;) , dateFormat=yyyy-MM-dd, typeParams=DimensionTimeTypeParams(isPrimary=false, timeGranularity=month), isCreateDimension=0, bizName=sys_imp_month, description=null, isTag=0)], engineAdaptor:com.tencent.supersonic.headless.core.adaptor.db.MysqlAdaptor@486b5958
14:57:20 [http-nio-9080-exec-2] DEBUG c.t.s.h.c.u.SysTimeDimensionBuilder 19 - addSysTimeDimension before:[Dim(name=, type=time, expr=null, dateFormat=yyyy-MM-dd, typeParams=DimensionTimeTypeParams(isPrimary=true, timeGranularity=day), isCreateDimension=0, bizName=imp_date, description=null, isTag=0), Dim(name=页面, type=categorical, expr=page, dateFormat=yyyy-MM-dd, typeParams=null, isCreateDimension=1, bizName=page, description=null, isTag=0)], engineAdaptor:com.tencent.supersonic.headless.core.adaptor.db.MysqlAdaptor@486b5958
14:57:20 [http-nio-9080-exec-2] DEBUG c.t.s.h.c.u.SysTimeDimensionBuilder 29 - addSysTimeDimension after:[Dim(name=, type=time, expr=null, dateFormat=yyyy-MM-dd, typeParams=DimensionTimeTypeParams(isPrimary=true, timeGranularity=day), isCreateDimension=0, bizName=imp_date, description=null, isTag=0), Dim(name=页面, type=categorical, expr=page, dateFormat=yyyy-MM-dd, typeParams=null, isCreateDimension=1, bizName=page, description=null, isTag=0), Dim(name=null, type=time, expr=imp_date, dateFormat=yyyy-MM-dd, typeParams=DimensionTimeTypeParams(isPrimary=true, timeGranularity=day), isCreateDimension=0, bizName=sys_imp_date, description=null, isTag=0), Dim(name=null, type=time, expr=DATE_FORMAT(DATE_SUB(imp_date, INTERVAL (DAYOFWEEK(imp_date) - 2) DAY), &#x27;%Y-%m-%d&#x27;), dateFormat=yyyy-MM-dd, typeParams=DimensionTimeTypeParams(isPrimary=false, timeGranularity=week), isCreateDimension=0, bizName=sys_imp_week, description=null, isTag=0), Dim(name=null, type=time, expr=DATE_FORMAT(imp_date, &#x27;%Y-%m&#x27;) , dateFormat=yyyy-MM-dd, typeParams=DimensionTimeTypeParams(isPrimary=false, timeGranularity=month), isCreateDimension=0, bizName=sys_imp_month, description=null, isTag=0)], engineAdaptor:com.tencent.supersonic.headless.core.adaptor.db.MysqlAdaptor@486b5958

14:57:20 [http-nio-9080-exec-2] DEBUG c.t.s.h.c.t.DefaultSemanticTranslator 51 - SemanticConverter before [QueryParam(groups=[], aggregators=[{&quot;column&quot;:&quot;pv&quot;,&quot;func&quot;:UNKNOWN,&quot;nameCh&quot;:&quot;null&quot;,&quot;args&quot;:null,&quot;alias&quot;:null}], orders=[], dimensionFilters=[], metricFilters=[], dateInfo={&quot;dateMode&quot;:BETWEEN,&quot;startDate&quot;:&quot;2024-08-06&quot;,&quot;endDate&quot;:&quot;2024-07-31&quot;,&quot;dateList&quot;:[],&quot;unit&quot;:1,&quot;period&quot;:&quot;DAY&quot;,&quot;text&quot;:&quot;null&quot;}, limit=2000, queryType=METRIC, s2SQL=null, correctS2SQL=null, dataSetId=1, dataSetName=null, modelIds=[], params=[], metrics=[pv], dimensions=null, where=null, order=null, nativeQuery=false)]
14:57:20 [http-nio-9080-exec-2] DEBUG c.t.s.h.c.t.DefaultSemanticTranslator 54 - SemanticConverter accept [com.tencent.supersonic.headless.core.translator.converter.DefaultDimValueConverter]
14:57:20 [http-nio-9080-exec-2] DEBUG c.t.s.h.c.t.DefaultSemanticTranslator 54 - SemanticConverter accept [com.tencent.supersonic.headless.core.translator.converter.SqlVariableParseConverter]
14:57:20 [http-nio-9080-exec-2] DEBUG c.t.s.h.c.t.DefaultSemanticTranslator 58 - SemanticConverter after QueryParam(groups=[], aggregators=[{&quot;column&quot;:&quot;pv&quot;,&quot;func&quot;:UNKNOWN,&quot;nameCh&quot;:&quot;null&quot;,&quot;args&quot;:null,&quot;alias&quot;:null}], orders=[], dimensionFilters=[], metricFilters=[], dateInfo={&quot;dateMode&quot;:BETWEEN,&quot;startDate&quot;:&quot;2024-08-06&quot;,&quot;endDate&quot;:&quot;2024-07-31&quot;,&quot;dateList&quot;:[],&quot;unit&quot;:1,&quot;period&quot;:&quot;DAY&quot;,&quot;text&quot;:&quot;null&quot;}, limit=2000, queryType=METRIC, s2SQL=null, correctS2SQL=null, dataSetId=1, dataSetName=null, modelIds=[], params=[], metrics=[pv], dimensions=null, where=null, order=null, nativeQuery=false) DataSetQueryParam(sql=SELECT SUM(pv) FROM t_1 WHERE (sys_imp_date &gt;= &#x27;2024-07-31&#x27; AND sys_imp_date &lt;= &#x27;2024-08-06&#x27;), tables=[MetricTable(alias=t_1, metrics=[pv], dimensions=[sys_imp_date], where=null, aggOption=DEFAULT)], supportWith=true, withAlias=true) MetricQueryParam(metrics=null, dimensions=null, where=null, limit=null, order=null, nativeQuery=false)
14:57:20 [http-nio-9080-exec-2] INFO  c.t.s.h.c.t.DefaultSemanticTranslator 78 - parse dataSetQuery [DataSetQueryParam(sql=SELECT SUM(pv) FROM t_1 WHERE (sys_imp_date &gt;= &#x27;2024-07-31&#x27; AND sys_imp_date &lt;= &#x27;2024-08-06&#x27;), tables=[MetricTable(alias=t_1, metrics=[pv], dimensions=[sys_imp_date], where=null, aggOption=DEFAULT)], supportWith=true, withAlias=true)] 
14:57:20 [http-nio-9080-exec-2] INFO  c.t.s.h.c.t.DefaultSemanticTranslator 125 - parse metricQuery [MetricQueryParam(metrics=[pv], dimensions=[sys_imp_date], where=null, limit=null, order=null, nativeQuery=false)] isAgg [DEFAULT]</code></pre><p id="261f9560-a09c-40a1-acf9-8cdf54c35cdb" class="">开始转换字段，翻译映射，构造结构请求，实现translator框架前置部分</p><p id="49227dae-70d8-492c-b01b-8590cc980b71" class="">
</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="f729b98c-9757-4cce-9cb3-d55f75560138" class="code"><code class="language-JSON">14:57:20 [http-nio-9080-exec-2] INFO  c.t.s.h.c.t.c.s.node.DataSourceNode 204 - dataSourceMeasures [{user_department=0, s2_pv_uv_statis=1, s2_stay_time_statis=0}]
14:57:20 [http-nio-9080-exec-2] DEBUG c.t.s.h.c.t.c.s.node.DataSourceNode 229 - baseDataSource  match all </code></pre><figure id="954ee820-14a2-45c7-8842-42789df541c8" class="link-to-page"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/DataSourceNode%20954ee82014a245c7884242789df541c8.html">DataSourceNode</a></figure><p id="4b166b99-f59b-46da-8589-22af37a934a4" class="">最后检查所有映射关系资源是否真实存在，确保查询可靠</p><h3 id="6a57b1f7-8c7a-4568-b925-d7bc5db45859" class="">Apache Calcite优化</h3><p id="bbde7225-27eb-46bc-9c55-68be0b1a0fb5" class="">参考4.2 整理版日志文档中Apache Calcite部分，进行三轮优化过程，以及参考6 关键技术部分。</p><figure id="623f6c72-ba09-4a31-b12d-7a8e3aa23bdd" class="link-to-page"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Calcite%E7%9B%B8%E5%85%B3%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%20623f6c72ba094a31b12d7a8e3aa23bdd.html">Calcite相关日志分析</a></figure><h3 id="60da6df7-5290-4741-b070-14e99b9c01d7" class="">最终查询</h3><figure id="57dfe29e-f97a-4b1d-8268-d1be8bb8aefa" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/image%208.png"><img style="width:720px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/image%208.png"/></a></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="fdcd7550-2988-49cb-8abb-7da3b9317037" class="code"><code class="language-JSON" style="white-space:pre-wrap;word-break:break-all">14:57:22 [http-nio-9080-exec-6] INFO  c.t.s.h.core.executor.JdbcExecutor 41 - executing SQL: with t_1 as (SELECT `imp_date` AS `sys_imp_date`, SUM(1) AS `pv` FROM s2_pv_uv_statis GROUP BY `imp_date`, `imp_date`) SELECT SUM(pv) FROM t_1 WHERE (sys_imp_date &gt;= &#x27;2024-07-31&#x27; AND sys_imp_date &lt;= &#x27;2024-08-06&#x27;) limit 1000
14:57:22 [http-nio-9080-exec-6] ERROR c.alibaba.druid.filter.FilterManager 117 - load filter error, filter not found : &#x27;stat&#x27;
14:57:22 [http-nio-9080-exec-6] WARN  c.alibaba.druid.pool.DruidDataSource 1236 - removeAbandoned is true, not use in production.
14:57:22 [http-nio-9080-exec-6] INFO  c.alibaba.druid.pool.DruidDataSource 985 - {dataSource-2,1@数据实例} inited
14:57:22 [http-nio-9080-exec-6] DEBUG o.s.b.f.xml.XmlBeanDefinitionReader 393 - Loaded 11 bean definitions from class path resource [org/springframework/jdbc/support/sql-error-codes.xml]

14:57:22 [http-nio-9080-exec-6] DEBUG o.s.jdbc.core.JdbcTemplate 440 - Executing SQL query [with t_1 as (SELECT `imp_date` AS `sys_imp_date`, SUM(1) AS `pv`
FROM
s2_pv_uv_statis
GROUP BY `imp_date`, `imp_date`)
SELECT SUM(pv) FROM t_1 WHERE (sys_imp_date &gt;= &#x27;2024-07-31&#x27; AND sys_imp_date &lt;= &#x27;2024-08-06&#x27;) limit 1000]
14:57:22 [http-nio-9080-exec-6] DEBUG o.s.jdbc.datasource.DataSourceUtils 115 - Fetching JDBC Connection from DataSource</code></pre><figure id="2cd9b3d1-23e7-415f-a3f0-a6526464fe15" class="link-to-page"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/JdbcExecutor%202cd9b3d123e7415fa3f0a6526464fe15.html">JdbcExecutor</a></figure><p id="208ee425-80f0-4c9b-a900-10939ecf6927" class="">优化并执行SQL查询</p><h3 id="bf81528b-c540-4ca5-8a6c-e3033d9f8397" class="">缓存相关</h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="4fc5ccec-b386-4170-ade8-9c08d7ededfe" class="code"><code class="language-JSON" style="white-space:pre-wrap;word-break:break-all">14:57:22 [http-nio-9080-exec-6] INFO  c.t.s.h.core.cache.DefaultQueryCache 21 - query from cache, key:supersonic:dev:0:-1:f7b1b5e688abc7568ab130888606780a
14:57:22 [ForkJoinPool.commonPool-worker-20] DEBUG c.t.s.h.c.cache.CaffeineCacheManager 25 - [put caffeineCache] key:supersonic:dev:0:-1:f7b1b5e688abc7568ab130888606780a, value:SemanticQueryResp(columns=[QueryColumn(name=访问次数, type=DECIMAL, nameEn=SUM(pv), showType=NUMBER, authorized=true, dataFormatType=null, dataFormat=null, comment=null)], sql=with t_1 as (SELECT `imp_date` AS `sys_imp_date`, SUM(1) AS `pv`
FROM
s2_pv_uv_statis
GROUP BY `imp_date`, `imp_date`)
SELECT SUM(pv) FROM t_1 WHERE (sys_imp_date &gt;= &#x27;2024-07-31&#x27; AND sys_imp_date &lt;= &#x27;2024-08-06&#x27;) limit 1000, queryAuthorization=null, useCache=false)
14:57:22 [http-nio-9080-exec-6] DEBUG c.t.s.h.core.cache.DefaultQueryCache 36 - put to cache, key: supersonic:dev:0:-1:f7b1b5e688abc7568ab130888606780a</code></pre><p id="aed96ff2-77d0-48c0-a1b9-9fd7c42c92f8" class="">包括查询缓存，以及生成后存入缓存操作，具体剩余可参考4.2 整理版日志内容</p><h2 id="5d99acd2-4602-4b7c-b53a-4feb87b95ff7" class="">4.4  前后端交互（网络抓包）</h2><p id="c97db909-5ccb-458a-aa10-b9207bd2a884" class="">——示例 &quot;超音速所有部门访问次数” </p><figure id="9080687f-3951-4961-b04e-bc7843d7e320" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%202.png"><img style="width:576px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%202.png"/></a></figure><figure id="d405aeee-74aa-47f8-aa6c-848170f1cd46" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%203.png"><img style="width:528px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%203.png"/></a></figure><ol type="1" id="2f6278d6-ffa8-4dc5-88a5-5921b7275c43" class="numbered-list" start="1"><li>在用户输入对话的过程中，出现多达7个search网络请求：</li></ol><p id="8374b032-01e9-4abb-9bc9-3c37acf80b39" class="">根据官方手册判断，这是增强用户体验的一种联想功能。通过实时捕获用户输入并进行联想推荐，可以帮助用户更快找到他们需要的信息。这种机制会在用户每次输入时触发一个搜索请求，以便动态生成相关建议。</p><ul id="72f9a4d4-c883-4d79-aeed-380ae46bf9ce" class="bulleted-list"><li style="list-style-type:disc">实时联想原理：<ul id="75f5fb69-105d-4f5d-99e7-80e2217da557" class="bulleted-list"><li style="list-style-type:circle">先对文本进行分词</li></ul><ul id="06c79c8e-15c2-44e8-bcdb-b63d4d0683ca" class="bulleted-list"><li style="list-style-type:circle">然后再进行并行分段探测</li></ul><ul id="a46bb9bb-167a-4ecc-a41a-3a6c81c9d200" class="bulleted-list"><li style="list-style-type:circle">选取探测文本最长的、且有联想结果的那项进行返回</li></ul></li></ul><figure id="72d1b6d6-aaf0-456c-8305-7dfec08326ec" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%204.png"><img style="width:384px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%204.png"/></a></figure><figure id="ce55b5eb-813c-475c-a384-0372b2b392e1" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%205.png"><img style="width:661px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%205.png"/></a></figure><ol type="1" id="6df862c0-e58f-4d4a-ae9c-93794eda5197" class="numbered-list" start="2"><li>点击发送对话后，先出现parse请求：</li></ol><ul id="299b62f9-7af6-4700-a932-eb854e362257" class="bulleted-list"><li style="list-style-type:disc">解析步骤 (Parse Request):<ul id="9e1fd883-1993-47b6-88b5-0fc32ab3d3e5" class="bulleted-list"><li style="list-style-type:circle">用户查询文本被传递给大模型。</li></ul><ul id="f9b25cc6-0879-447c-938c-1ca98b7d2996" class="bulleted-list"><li style="list-style-type:circle">大模型解析查询文本并生成相应的SQL查询。</li></ul><ol type="1" id="1015292b-c1d8-43bf-9734-b2055129e132" class="numbered-list" start="1"><li>步骤 1：请求参数解析</li></ol><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="0067ecd7-2dfc-437e-9f83-bb127d8222e1" class="code"><code class="language-JSON" style="white-space:pre-wrap;word-break:break-all">{
    &quot;code&quot;: 200,
    &quot;msg&quot;: &quot;success&quot;,
    &quot;data&quot;: {
        &quot;chatId&quot;: 1,
        &quot;queryText&quot;: &quot;超音速所有部门访问次数&quot;,
        &quot;queryId&quot;: 55,
        &quot;state&quot;: &quot;COMPLETED&quot;,
        &quot;selectedParses&quot;: [...]
    }
}</code></pre><ul id="547fe662-4289-4f85-8e34-8cd63964503d" class="bulleted-list"><li style="list-style-type:circle"><strong>chatId</strong>: 当前会话的ID (1)。</li></ul><ul id="a696ab82-1681-4a29-95ef-59960f5fc0c2" class="bulleted-list"><li style="list-style-type:circle"><strong>queryText</strong>: 用户查询的文本 (&quot;超音速所有部门访问次数&quot;)。</li></ul><ul id="8abe90cb-12bb-4e8a-872f-2d1d5b529a0a" class="bulleted-list"><li style="list-style-type:circle"><strong>queryId</strong>: 当前查询的ID (55)。</li></ul><ul id="22aaa56e-204d-4914-93dc-696251aafd98" class="bulleted-list"><li style="list-style-type:circle"><strong>state</strong>: 解析状态 (&quot;COMPLETED&quot;)。</li></ul><ol type="1" id="2fc37746-c6cb-4f5e-97ef-fda18bc328fd" class="numbered-list" start="2"><li>步骤 2：大模型请求</li></ol><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1e2df15d-c88d-4ab6-8d28-941302e1a50a" class="code"><code class="language-JSON" style="white-space:pre-wrap;word-break:break-all">{
    &quot;llmReq&quot;: {
        &quot;queryText&quot;: &quot;超音速所有部门访问次数&quot;,
        &quot;schema&quot;: {
            &quot;domainName&quot;: &quot;超音数数据集&quot;,
            &quot;dataSetName&quot;: &quot;超音数数据集&quot;,
            &quot;fieldNameList&quot;: [...],
            &quot;metrics&quot;: [...],
            &quot;dimensions&quot;: [...]
        },
        &quot;llmConfig&quot;: {
            &quot;modelName&quot;: &quot;gpt-3.5-turbo&quot;,
            &quot;baseUrl&quot;: &quot;https://api.openai.com/v1&quot;,
            &quot;apiKey&quot;: &quot;...&quot;,
            &quot;provider&quot;: &quot;OPEN_AI&quot;,
            &quot;temperature&quot;: 0.0,
            &quot;timeOut&quot;: 60
        }
    }
}</code></pre><ul id="1815eecf-55c2-4138-ae84-a51f842ae108" class="bulleted-list"><li style="list-style-type:circle"><strong>queryText</strong>: 用户查询文本。</li></ul><ul id="b3f346df-f1b8-43d4-be54-c03e4cbe6ef0" class="bulleted-list"><li style="list-style-type:circle"><strong>schema</strong>: 数据集的结构信息。<ul id="a503b4e1-fc32-4bd0-a3da-769c544a1022" class="bulleted-list"><li style="list-style-type:square"><strong>domainName</strong>: 数据集域名 (&quot;超音数数据集&quot;)。</li></ul><ul id="0a6ea093-3f37-4b04-87a4-d1050c868487" class="bulleted-list"><li style="list-style-type:square"><strong>dataSetName</strong>: 数据集名称 (&quot;超音数数据集&quot;)。</li></ul><ul id="5647ed22-964d-49e7-956e-53b11917343d" class="bulleted-list"><li style="list-style-type:square"><strong>fieldNameList</strong>: 数据集字段列表。</li></ul><ul id="aedcc0c8-9246-4076-bb5f-6c14ec600d09" class="bulleted-list"><li style="list-style-type:square"><strong>metrics</strong>: 度量指标列表。</li></ul><ul id="c4c59473-e0fc-4613-8ee6-163acd0f429a" class="bulleted-list"><li style="list-style-type:square"><strong>dimensions</strong>: 维度列表。</li></ul></li></ul><ul id="1e8d1861-0091-40fe-ace3-ec1298244144" class="bulleted-list"><li style="list-style-type:circle"><strong>llmConfig</strong>: 大模型配置 (使用 GPT-3.5-turbo)。</li></ul><ol type="1" id="b8681475-a8c8-40dd-b1c5-1470480d78b0" class="numbered-list" start="3"><li> 步骤 3：大模型响应</li></ol><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="a93112cf-9f04-4337-9196-37130df65095" class="code"><code class="language-JSON" style="white-space:pre-wrap;word-break:break-all">{
    &quot;llmResp&quot;: {
        &quot;query&quot;: &quot;超音速所有部门访问次数&quot;,
        &quot;sqlOutput&quot;: &quot;SELECT 部门, SUM(访问次数) AS 超音速所有部门访问次数 FROM 超音数数据集 GROUP BY 部门&quot;
    }
}</code></pre><ul id="d7474353-de2c-4395-92e7-d0412c1c534b" class="bulleted-list"><li style="list-style-type:circle"><strong>query</strong>: 解析后的查询文本。</li></ul><ul id="5e89bdd9-3a61-416c-b720-74be601507ff" class="bulleted-list"><li style="list-style-type:circle"><strong>sqlOutput</strong>: 大模型生成的SQL查询：<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="edfdc6c1-290a-4a41-9b1e-ad839b106ca6" class="code"><code class="language-SQL" style="white-space:pre-wrap;word-break:break-all">SELECT 部门, SUM(访问次数) AS 超音速所有部门访问次数 FROM 超音数数据集 GROUP BY 部门</code></pre></li></ul><ul id="4ba265f8-4515-449f-8b9c-bfeba13f1f4f" class="bulleted-list"><li style="list-style-type:circle">解析参数说明：</li></ul><ol type="1" id="ebe28a0c-2af5-4a0c-b315-3d99063e1f7f" class="numbered-list" start="1"><li><strong>code</strong>: 表示请求的状态码，200表示成功。</li></ol><ol type="1" id="b84a9a6f-70cc-4e23-9d73-792ecb2068c5" class="numbered-list" start="2"><li><strong>msg</strong>: 请求的消息，通常是 &quot;success&quot; 表示成功。</li></ol><ol type="1" id="caeec036-6128-4b52-8e2c-0d9082b98827" class="numbered-list" start="3"><li><strong>data</strong>: 包含请求的详细数据。<ul id="d0e3a327-676d-45b5-b456-42dec7721c7b" class="bulleted-list"><li style="list-style-type:disc"><strong>chatId</strong>: 当前会话的ID。</li></ul><ul id="ee58498b-1e5c-425c-b4a7-b4a2732696f6" class="bulleted-list"><li style="list-style-type:disc"><strong>queryText</strong>: 用户输入的查询文本，如 &quot;超音速部门用书数量分布&quot;。</li></ul><ul id="f9e15e22-3bef-4c4d-b857-0350f4044843" class="bulleted-list"><li style="list-style-type:disc"><strong>queryId</strong>: 当前查询的唯一标识符。</li></ul><ul id="bbc0cc08-c223-4df5-adfc-2cc2d0e3c349" class="bulleted-list"><li style="list-style-type:disc"><strong>state</strong>: 当前解析的状态，这里是 &quot;COMPLETED&quot; 表示解析已完成。</li></ul><ul id="96e0047f-1723-44d0-bce8-04d3da7dc4a6" class="bulleted-list"><li style="list-style-type:disc"><strong>selectedParses</strong>: 包含大模型生成的多个解析结果。</li></ul></li></ol><ol type="1" id="8816b052-2f06-4c4a-9e45-95477f7e1353" class="numbered-list" start="4"><li><strong>llmReq</strong>: 向大模型发送的请求。</li></ol><ul id="e7c8fa7c-65a4-43aa-a688-3d96ac389d3c" class="bulleted-list"><li style="list-style-type:circle"><strong>queryText</strong>: 用户输入的查询文本。</li></ul><ul id="1b4b1dca-6e0c-4f9f-ace3-7163b0eee336" class="bulleted-list"><li style="list-style-type:circle"><strong>schema</strong>: 数据集的结构信息。<ul id="304d77c1-19d3-487a-a864-4bd2702bc7cf" class="bulleted-list"><li style="list-style-type:square"><strong>domainName</strong>: 数据集的域名。</li></ul><ul id="fb3d7dfd-be70-441e-80a3-7fbbf9c56c7a" class="bulleted-list"><li style="list-style-type:square"><strong>dataSetName</strong>: 数据集名称。</li></ul><ul id="cde67933-3ac6-409e-98f9-d3464a498b5f" class="bulleted-list"><li style="list-style-type:square"><strong>fieldNameList</strong>: 数据集中的字段列表。</li></ul><ul id="0424334c-0d8d-4738-ad35-86361eb11082" class="bulleted-list"><li style="list-style-type:square"><strong>metrics</strong>: 度量指标列表。</li></ul><ul id="0b23b33d-2390-4194-8052-6b9e0856d48d" class="bulleted-list"><li style="list-style-type:square"><strong>dimensions</strong>: 维度列表。</li></ul></li></ul><ul id="030cc34d-32b6-48a9-896f-99bd104d6ea9" class="bulleted-list"><li style="list-style-type:circle"><strong>llmConfig</strong>: 大模型的配置信息。<ul id="345fd4ee-1f88-4ce1-b12c-bcfee828b5c5" class="bulleted-list"><li style="list-style-type:square"><strong>modelName</strong>: 使用的模型名称，如 &quot;gpt-3.5-turbo&quot;。</li></ul><ul id="359ebcc3-4619-4301-8b60-b9fb20bd4837" class="bulleted-list"><li style="list-style-type:square"><strong>baseUrl</strong>: API 基础 URL。</li></ul><ul id="15ade584-4d9d-4ca9-86d1-a0537f344846" class="bulleted-list"><li style="list-style-type:square"><strong>apiKey</strong>: 用于身份验证的 API 密钥。</li></ul><ul id="1b0a5396-9127-4a3d-b63c-697347c8126f" class="bulleted-list"><li style="list-style-type:square"><strong>provider</strong>: 提供商名称。</li></ul><ul id="812c4f23-c2a5-4419-8af1-79794d92ec02" class="bulleted-list"><li style="list-style-type:square"><strong>temperature</strong>: 输出的随机性。</li></ul><ul id="1db11918-057d-47c5-b6aa-c1b7d7d0ff9f" class="bulleted-list"><li style="list-style-type:square"><strong>timeOut</strong>: 请求的超时时间。</li></ul></li></ul><ol type="1" id="d2c05d5d-46c7-4332-b931-cf82183d2ff6" class="numbered-list" start="5"><li><strong>llmResp</strong>: 大模型返回的响应。</li></ol><ul id="61e5e050-cac3-44f8-9d9c-899c2d4d507d" class="bulleted-list"><li style="list-style-type:circle"><strong>query</strong>: 大模型解析后的查询文本。</li></ul><ul id="a55db73d-2727-4573-9d7e-eb1801b070f7" class="bulleted-list"><li style="list-style-type:circle"><strong>modelName</strong>: 使用的模型名称。</li></ul><ul id="d772e8a7-6012-43bc-85bb-9c700f2fcf64" class="bulleted-list"><li style="list-style-type:circle"><strong>dbSchema</strong>: 数据库模式，包含表名、字段和注释信息。</li></ul><ul id="555d6438-498e-45bb-8a6a-9ec13ea760b6" class="bulleted-list"><li style="list-style-type:circle"><strong>sqlOutput</strong>: 大模型生成的 SQL 查询。</li></ul><ul id="03b3d441-70ed-4284-9daf-11a7fe3d7135" class="bulleted-list"><li style="list-style-type:circle"><strong>sqlRespMap</strong>: SQL 查询响应映射。</li></ul></li></ul><ol type="1" id="5b949ab3-dd44-435f-8615-d0299e3b9eb5" class="numbered-list" start="3"><li>随后出现execute请求：</li></ol><ul id="b0abc062-f392-460d-9ba2-1040a0ddc2c2" class="bulleted-list"><li style="list-style-type:disc">执行步骤 (Execute Request):<ul id="a1afafe9-6281-4a51-80ab-f38f047b2f15" class="bulleted-list"><li style="list-style-type:circle">生成的SQL查询在数据库中执行。</li></ul><ul id="6a3c4e2b-5c88-4e93-9e64-d47b4f24d12a" class="bulleted-list"><li style="list-style-type:circle">返回查询结果，包括列信息和状态。</li></ul><ol type="1" id="34be8df0-8754-4e12-919e-c3fe57976535" class="numbered-list" start="4"><li>步骤 4：执行SQL查询</li></ol><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="5752e0fe-e93d-403a-ab56-d5c75cae53f6" class="code"><code class="language-JSON" style="white-space:pre-wrap;word-break:break-all">{
    &quot;code&quot;: 200,
    &quot;msg&quot;: &quot;success&quot;,
    &quot;data&quot;: {
        &quot;querySql&quot;: &quot;with t_1 as (...) SELECT department, SUM(pv) FROM t_1 WHERE (sys_imp_date &gt;= &#x27;2024-07-04&#x27; AND sys_imp_date &lt;= &#x27;2024-07-10&#x27;) GROUP BY department limit 1000&quot;,
        &quot;queryState&quot;: &quot;SUCCESS&quot;,
        &quot;queryColumns&quot;: [...]
    }
}</code></pre><ul id="10b5af29-0705-4c89-be2e-2003257e31d9" class="bulleted-list"><li style="list-style-type:circle"><strong>querySql</strong>: 执行的SQL查询：<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="3c09ee36-4cac-4bed-a7c6-965398979631" class="code"><code class="language-SQL" style="white-space:pre-wrap;word-break:break-all">with t_1 as (
    SELECT `t3`.`sys_imp_date`, `t2`.`department`, `t3`.`s2_pv_uv_statis_pv` AS `pv`
    FROM
    (SELECT `user_name`, `department` FROM s2_user_department) AS `t2`
    LEFT JOIN (SELECT 1 AS `s2_pv_uv_statis_pv`, `imp_date` AS `sys_imp_date`, `user_name`, `imp_date` FROM s2_pv_uv_statis) AS `t3`
    ON `t2`.`user_name` = `t3`.`user_name`
)
SELECT department, SUM(pv)
FROM t_1
WHERE (sys_imp_date &gt;= &#x27;2024-07-04&#x27; AND sys_imp_date &lt;= &#x27;2024-07-10&#x27;)
GROUP BY department
limit 1000</code></pre></li></ul><ul id="27cce979-344b-43d1-87a8-e3d470d8606b" class="bulleted-list"><li style="list-style-type:circle"><strong>queryState</strong>: 查询状态 (&quot;SUCCESS&quot;)。</li></ul><ul id="1009fd40-7e91-4700-a38b-d740e1edaf27" class="bulleted-list"><li style="list-style-type:circle"><strong>queryColumns</strong>: 查询结果的列信息。</li></ul><h3 id="93a569bc-a3ce-40dc-9f4c-09e0c1e5c728" class="">执行参数说明：</h3><ol type="1" id="1ce9ef1d-a182-4c1c-a182-7338efc0fcbe" class="numbered-list" start="1"><li><strong>code</strong>: 请求状态码，200表示成功。</li></ol><ol type="1" id="c7efec8b-b359-457c-a50b-d13878f62bcd" class="numbered-list" start="2"><li><strong>msg</strong>: 请求消息，通常是 &quot;success&quot; 表示成功。</li></ol><ol type="1" id="9c906420-3235-4989-a4d3-2a98221a4976" class="numbered-list" start="3"><li><strong>data</strong>: 执行的详细数据。<ul id="4920233b-820c-466a-8b44-93f9ccd966e8" class="bulleted-list"><li style="list-style-type:disc"><strong>querySql</strong>: 要执行的 SQL 查询。</li></ul><ul id="4c6b83b1-62ab-4bc1-8ba7-58f71b3594bb" class="bulleted-list"><li style="list-style-type:disc"><strong>queryState</strong>: 查询状态，&quot;SUCCESS&quot; 表示成功。</li></ul><ul id="b81b256b-8f70-4dbd-af61-050278af8d04" class="bulleted-list"><li style="list-style-type:disc"><strong>queryColumns</strong>: 查询结果的列信息。<ul id="167a3e3a-63b7-4e8b-a6a1-1b93dc167e9e" class="bulleted-list"><li style="list-style-type:circle"><strong>name</strong>: 列名称，如 &quot;部门&quot;。</li></ul><ul id="d259cd85-acf6-4432-ada0-38d18125fb20" class="bulleted-list"><li style="list-style-type:circle"><strong>type</strong>: 列类型，如 &quot;VARCHAR&quot;。</li></ul><ul id="06679b21-0325-4468-8382-47207cb0678d" class="bulleted-list"><li style="list-style-type:circle"><strong>nameEn</strong>: 英文列名，如 &quot;department&quot;。</li></ul><ul id="5165ff9a-a65b-42d8-82d4-61eebadc4f39" class="bulleted-list"><li style="list-style-type:circle"><strong>showType</strong>: 显示类型，如 &quot;CATEGORY&quot;。</li></ul><ul id="8cbef785-f910-4a25-8485-73026bab77b7" class="bulleted-list"><li style="list-style-type:circle"><strong>authorized</strong>: 是否授权访问。</li></ul></li></ul><ul id="e51cee61-1b0e-4a7d-9f1b-4ae7a5ed9b21" class="bulleted-list"><li style="list-style-type:disc"><strong>chatContext</strong>: 当前会话的上下文信息。<ul id="2af08187-e7eb-4ba6-a789-79362c103205" class="bulleted-list"><li style="list-style-type:circle"><strong>id</strong>: 会话ID。</li></ul><ul id="e2811ca7-a6b0-4b33-8253-733dc099d339" class="bulleted-list"><li style="list-style-type:circle"><strong>queryMode</strong>: 查询模式，如 &quot;LLM_S2SQL&quot;。</li></ul><ul id="199f92fc-934b-4c5f-b1cf-486001b19e99" class="bulleted-list"><li style="list-style-type:circle"><strong>dataSet</strong>: 数据集信息。<ul id="730838af-d57f-4180-96b1-147d5ec01a49" class="bulleted-list"><li style="list-style-type:square"><strong>dataSet</strong>: 数据集ID。</li></ul><ul id="726679c7-407a-4196-b045-f5f0541318af" class="bulleted-list"><li style="list-style-type:square"><strong>dataSetName</strong>: 数据集名称，如 &quot;超音数数据集&quot;。</li></ul><ul id="c69de649-4c36-4fe3-9567-733e6cebdfd3" class="bulleted-list"><li style="list-style-type:square"><strong>bizName</strong>: 业务名称，如 &quot;s2&quot;。</li></ul><ul id="dd892f15-9cd9-4549-8754-73f96e96626a" class="bulleted-list"><li style="list-style-type:square"><strong>type</strong>: 数据集类型，如 &quot;DATASET&quot;。</li></ul></li></ul><ul id="67ebf229-6f87-4e6a-806c-a7b652baeac5" class="bulleted-list"><li style="list-style-type:circle"><strong>metrics</strong>: 度量指标列表。</li></ul><ul id="a1e3fd5a-dfe2-4889-9286-8970e62dd962" class="bulleted-list"><li style="list-style-type:circle"><strong>dimensions</strong>: 维度列表。<ul id="f78a5ac0-1d78-4639-853b-0a43e1727918" class="bulleted-list"><li style="list-style-type:square"><strong>dataSet</strong>: 数据集ID。</li></ul><ul id="4b77d7be-f290-4047-8132-5d044971c71b" class="bulleted-list"><li style="list-style-type:square"><strong>dataSetName</strong>: 数据集名称。</li></ul><ul id="22e2c0d1-3ec3-42a9-8e73-58e656961406" class="bulleted-list"><li style="list-style-type:square"><strong>model</strong>: 模型ID。</li></ul><ul id="4c064c18-b3b7-4ff5-91fe-823dea5e4fde" class="bulleted-list"><li style="list-style-type:square"><strong>id</strong>: 维度ID。</li></ul><ul id="a4e3007b-3a8b-45c6-b097-02fb2cea16b6" class="bulleted-list"><li style="list-style-type:square"><strong>name</strong>: 维度名称，如 &quot;部门&quot;。</li></ul><ul id="64a1f957-330b-4101-a59f-370d5a78f8bd" class="bulleted-list"><li style="list-style-type:square"><strong>bizName</strong>: 业务名称，如 &quot;department&quot;。</li></ul><ul id="349a079c-3521-476b-a678-cf7ba9a65f49" class="bulleted-list"><li style="list-style-type:square"><strong>isTag</strong>: 是否为标签维度。</li></ul></li></ul><ul id="8ea48362-2b65-4c22-9b66-6a1c47468e7c" class="bulleted-list"><li style="list-style-type:circle"><strong>dateInfo</strong>: 日期信息。<ul id="d90614ff-04f0-4d93-977f-3811b7a55e0d" class="bulleted-list"><li style="list-style-type:square"><strong>dateMode</strong>: 日期模式，如 &quot;BETWEEN&quot;。</li></ul><ul id="9763bafd-c467-4698-90f7-91daa18258ac" class="bulleted-list"><li style="list-style-type:square"><strong>startDate</strong>: 起始日期，如 &quot;2024-07-10&quot;。</li></ul><ul id="289dd230-6920-4c86-8e1b-c4cd1ef93a1f" class="bulleted-list"><li style="list-style-type:square"><strong>endDate</strong>: 结束日期，如 &quot;2024-07-10&quot;。</li></ul><ul id="67c59d90-78e9-4310-934d-5bc126c008d8" class="bulleted-list"><li style="list-style-type:square"><strong>groupByTimeDimension</strong>: 按时间维度分组的字段，如 &quot;sys_imp_date&quot;。</li></ul></li></ul></li></ul></li></ol></li></ul><ol type="1" id="030d63de-637c-4fbc-9b46-8a74d5801d46" class="numbered-list" start="4"><li>每轮查询请求结束后，一次getAll?agentId= 的查询，获取当前聊天信息</li></ol><ol type="1" id="35714e1d-5fac-4930-ae2d-3ac678bfd8ba" class="numbered-list" start="5"><li>如果更改查询参数，再点击重新检索，出现两个query请求：</li></ol><p id="97612d5f-1b92-464e-88bc-da00f20b9178" class="">根据之前用户对话调用LLM识别到的维度参数数据，经过调整参数生成并执行 SQL直接查询。</p><figure id="a247e90c-8895-43ef-83b6-aa42bfedd8f2" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%206.png"><img style="width:528px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%206.png"/></a></figure><figure id="70b056d8-2a45-437a-b614-4e1a309e91ae" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%207.png"><img style="width:240px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%207.png"/></a></figure><h3 id="bf1d0e52-542a-4c56-85de-4c87502d3d7a" class="">抓包内容分析</h3><p id="a2d86bd9-77b5-4633-9538-b00fd7823997" class="">结构化显示所有抓包内容，解析所有参数：</p><figure id="7ebd5fe0-38d5-4b1b-93f2-46bc3e2ceb60" class="link-to-page"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/%E7%BD%91%E7%BB%9C%E6%8A%93%E5%8C%85%E5%86%85%E5%AE%B9%E5%88%86%E6%9E%90%207ebd5fe038d54b1b93f246bc3e2ceb60.html">网络抓包内容分析</a></figure><h2 id="c941d9c3-1a9b-40d7-872e-6068ee9ff185" class="">4.5 LLM生成流程</h2><h3 id="db49a10b-8f12-4174-ab77-3f597436a78a" class="">总结构：</h3><p id="75d62dca-b057-4a17-9517-bf60d8831e98" class="">（<strong>提示词 + 少样本提示 + 用户问题增强 + 关键词映射）</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="e743830a-f07c-4ac0-96d2-8f04691144fa" class="code"><code class="language-Java">String promptStr = String.format(INSTRUCTION, exemplarsStr, questionAugmented, dataSemanticsStr);</code></pre><h3 id="9e7f9f0b-0bbe-484b-b131-98af9b68c156" class="">提示词：</h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="e8132df8-922b-4264-8fe4-8af06ca06872" class="code"><code class="language-Java">    private static final String INSTRUCTION = &quot;&quot;
            + &quot;#Role: You are a data analyst experienced in SQL languages.\n&quot;
            + &quot;#Task: You will be provided a natural language query asked by business users,&quot;
            + &quot;please convert it to a SQL query so that relevant answer could be returned to the user &quot;
            + &quot;by executing the SQL query against underlying database.\n&quot;
            + &quot;#Rules:&quot;
            + &quot;1.ALWAYS use `数据日期` as the date field.&quot;
            + &quot;2.ALWAYS use `datediff()` as the date function.&quot;
            + &quot;3.DO NOT specify date filter in the where clause if not explicitly mentioned in the query.&quot;
            + &quot;4.ONLY respond with the converted SQL statement.\n&quot;
            + &quot;#Exemplars:\n%s&quot;
            + &quot;#UserQuery: %s &quot;
            + &quot;#Schema: %s &quot;
            + &quot;#SQL: &quot;;</code></pre><p id="a3257c73-a96d-4653-abf3-d7b99e0b948b" class="">翻译：</p><p id="218b597d-1ab0-41f6-a1ad-97cea3668f7f" class="">+“#角色:你是一名有SQL语言经验的数据分析师。”<br/>+“#Task:您将获得由业务用户提出的自然语言查询，”<br/>+“请将其转换为SQL查询，以便将相关答案返回给用户”<br/></p><p id="1dd9d103-b1b6-4f5e-aded-df2570012a8a" class="">+“通过对底层数据库执行SQL查询。\n&quot;</p><p id="aed3a2d1-3df0-41cd-8e33-f790177d1633" class="">+“#规则:“</p><p id="b5c2e018-aadc-40d3-9d21-8e522d0ebeb5" class="">+“1。始终使用&#x27;数据日期&#x27;作为日期字段。&quot;<br/>+”2。总是使用&#x27; datediff() &#x27;作为日期函数。&quot;<br/>+”3。如果查询中没有明确提到，不要在where子句中指定日期过滤器。<br/>+”4。只响应转换后的SQL语句。\n&quot;<br/></p><h3 id="9c192e72-0a02-4320-9698-3ac1ca57c981" class="">少样本提示+自一致性投票：</h3><p id="dedc2d03-c92e-48a8-b2f3-34cb0a89b3d4" class=""><code>ResponseHelper.selfConsistencyVote</code> 方法负责处理自<a href="https://www.notion.so/cae82e2fe6a24c49931c385191cfbf66?pvs=21">一致投票。</a><br/>对于数据集，有特殊的已有构建问题和对应S2SQL语句。<br/></p><figure id="e97a3422-7491-4bfd-881a-cf82218f815a" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%208.png"><img style="width:624px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%208.png"/></a></figure><ol type="1" id="278f5e0e-baae-4331-9030-785965b5189f" class="numbered-list" start="1"><li>生成多个 Prompt（作为不同的样本以及提供不同思路）<p id="c2a86d04-8ef7-4fbe-87a2-ca6ad51f33cc" class="">首先，我们生成了多个 Prompt，每个 Prompt 包含了一组不同的 SQL 示例（few-shot exemplars）。目的是为模型提供参考。</p></li></ol><ol type="1" id="1832d3f1-1507-406b-92e3-a2ee560f90e9" class="numbered-list" start="2"><li>并行执行推理<p id="76ae6e28-73cd-4a5d-a727-879c8c98c96d" class="">并行地执行这些 Prompt，每个 Prompt 都会通过 ChatLanguageModel 生成一个 SQL 查询。</p></li></ol><ol type="1" id="f2097f0c-0f55-4d79-86b6-eee8fce71969" class="numbered-list" start="3"><li>汇总结果并进行投票<p id="d3f2f533-6ed2-4b1d-88fb-682ad0d18121" class="">将这些生成的 SQL 查询进行汇总，通过投票机制选出最合适 SQL 查询。通过<code>selfConsistencyVote</code> 方法对所有生成的 SQL 结果进行投票，选择得票最多的结果作为最终的 SQL 查询。</p></li></ol><ol type="1" id="87fc53ba-aeb2-4d99-b484-80549ba10948" class="numbered-list" start="4"><li>举例说明<p id="dcc87f57-9041-49b6-99bd-18b2c03a36e4" class="">假设我们有一个用户查询 “所有部门的访问次数”，我们会生成多个 Prompt，每个 Prompt 包含不同的 SQL 示例。然后，我们并行地将这些 Prompt 发送给模型进行 SQL 生成。最后，我们对所有生成的 SQL 进行投票，选择得票最多的 SQL 作为最终的 SQL 查询。</p><h3 id="5e23e133-c3bd-4854-8a2b-4d79a31b9350" class="">示例：</h3><ol type="1" id="1cbd683f-af42-4f49-bda9-73d8d5d2b6ca" class="numbered-list" start="1"><li>用户查询: “所有部门的访问次数”</li></ol><ol type="1" id="c5a0e9b5-1438-4928-83cf-761598f0bd7e" class="numbered-list" start="2"><li>生成的 Prompt 列表:<ul id="227973bb-e944-48ba-9b10-7727336723b4" class="bulleted-list"><li style="list-style-type:disc">Prompt 1: 包含 SQL 示例 A, B, C</li></ul><ul id="89c83c90-4607-4006-b0e6-aa0c34889109" class="bulleted-list"><li style="list-style-type:disc">Prompt 2: 包含 SQL 示例 D, E, F</li></ul><ul id="3466ea0e-9747-4c7b-95d3-2f6f54bcbf1c" class="bulleted-list"><li style="list-style-type:disc">...</li></ul></li></ol><ol type="1" id="9be4529c-ffe7-4bb1-afa8-d2e3d0efe7d5" class="numbered-list" start="3"><li>并行地将这些 Prompt 发送给模型:<ul id="8fac18f9-0661-4fbe-82dc-960e9fc0026f" class="bulleted-list"><li style="list-style-type:disc">模型返回 SQL 查询 1, 2, 3, ...</li></ul></li></ol><ol type="1" id="6511ab3c-2241-4a95-adfd-3934dddd96d2" class="numbered-list" start="4"><li>对所有生成的 SQL 进行投票:<ul id="1c7c8fb8-14b6-4f9f-a63f-c9edc296f197" class="bulleted-list"><li style="list-style-type:disc">SQL 查询 1 得到 3 票</li></ul><ul id="86309f8c-f309-4366-bd31-953a612401a8" class="bulleted-list"><li style="list-style-type:disc">SQL 查询 2 得到 2 票</li></ul><ul id="99e272ec-bfa5-4fd4-9539-70089973cc0c" class="bulleted-list"><li style="list-style-type:disc">SQL 查询 3 得到 5 票</li></ul></li></ol><ol type="1" id="dd34d29c-9b74-43ff-8a3f-6d99b20f5032" class="numbered-list" start="5"><li>选择得票最多的 SQL 查询 3 作为最终的 SQL 查询</li></ol></li></ol><h3 id="67219df9-fe50-4f15-b302-35ac8ae44e65" class="">用户问题增强：</h3><p id="32728eb5-a511-414b-b630-5597fcaddcea" class=""><code>promptHelper</code>类中得<code>buildAugmentedQuestion</code> 函数通过添加更多上下文信息（如链接值、当前日期、业务术语等）来增强用户的查询问题。有助于模型生成更准确的 SQL 查询，结合了多个辅助方法来构建最终的增强问题字符串。</p><ol type="1" id="52f90043-a4e4-4c09-892f-61ce7a49f4a4" class="numbered-list" start="1"><li>提取链接的值<p id="716fe0b1-7294-496f-878a-1064eea48ad6" class="">函数首先从 <code>LLMReq</code> 对象中提取 <code>linking</code> 值，这些值表示与查询相关的上下文信息。</p></li></ol><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="0f9e4478-d1a7-4bea-b493-b769ac4303b7" class="code"><code class="language-Java" style="white-space:pre-wrap;word-break:break-all">List&lt;LLMReq.ElementValue&gt; linkedValues = llmReq.getLinking();</code></pre><ol type="1" id="246b8c17-433c-4bd8-9e77-28244d465e31" class="numbered-list" start="2"><li>获取当前日期<p id="775161ea-d371-4e0f-af54-f847adb2ba37" class="">获取当前日期字符串以加入到增强的问题中。</p></li></ol><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="3c9ce03f-6d70-44cd-b1d9-aa6882f7b0cc" class="code"><code class="language-Java" style="white-space:pre-wrap;word-break:break-all">String currentDate = llmReq.getCurrentDate();</code></pre><ol type="1" id="246363cf-2751-4fc3-b2b3-84b374c5fcdf" class="numbered-list" start="3"><li>获取先前的扩展信息<p id="d378b619-43bd-4e1b-a598-c169886aa61c" class="">提取任何先前的扩展信息（<code>priorExts</code>），这通常是与当前查询相关的历史或附加信息。</p></li></ol><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="81a44bb3-cc87-4348-9a7e-c80dd72a9de2" class="code"><code class="language-Java" style="white-space:pre-wrap;word-break:break-all">String priorExts = llmReq.getPriorExts();</code></pre><ol type="1" id="0c1be132-f7d3-4b92-ac1a-70e51148ec3e" class="numbered-list" start="4"><li>构建链接值字符串<p id="6d410887-f5c1-4413-b5bf-1358525c5d82" class="">遍历 <code>linkedValues</code> 列表，并为每个值生成一个描述字符串。例如，如果 <code>linkedValues</code> 包含一个字段名为“部门”，字段值为“销售”的元素，它会生成“‘销售’是一个‘部门’”。</p></li></ol><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="0f8959cc-f6ff-4538-8de0-f418672581b5" class="code"><code class="language-Java" style="white-space:pre-wrap;word-break:break-all">List&lt;String&gt; priorLinkingList = new ArrayList&lt;&gt;();
for (LLMReq.ElementValue value : linkedValues) {
    String fieldName = value.getFieldName();
    String fieldValue = value.getFieldValue();
    priorLinkingList.add(&quot;‘&quot; + fieldValue + &quot;‘是一个‘&quot; + fieldName + &quot;‘&quot;);
}
String linkingListStr = String.join(&quot;，&quot;, priorLinkingList);</code></pre><ol type="1" id="10c47dca-102a-40ac-947b-d973a211c7a3" class="numbered-list" start="5"><li>生成当前日期字符串<p id="38c9266c-6251-4280-aacc-f3dc1427aad5" class="">生成表示当前日期的字符串。</p></li></ol><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="be36ebfc-e917-4f95-bfbc-eb4932be2b54" class="code"><code class="language-Java" style="white-space:pre-wrap;word-break:break-all">String currentDataStr = &quot;当前的日期是&quot; + currentDate;</code></pre><ol type="1" id="84a532bb-0580-41e7-9ec7-6ff48b6a8e95" class="numbered-list" start="6"><li>构建业务术语字符串<p id="49049c01-dbb9-4939-949b-fd65aee6dfd1" class="">调用 <code>buildTermStr</code> 函数以构建与查询相关的业务术语的字符串。</p></li></ol><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="6859f92e-9b97-4ebd-b715-fa0099e34ad7" class="code"><code class="language-Java" style="white-space:pre-wrap;word-break:break-all">String termStr = buildTermStr(llmReq);</code></pre><p id="8d5185cd-6dac-4d0e-ad83-2a99550b250f" class="">它遍历 <code>LLMReq</code> 对象中的术语列表，并为每个术语生成描述字符串。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="caa023f4-3ea5-408e-98e5-fee954c668ef" class="code"><code class="language-Java" style="white-space:pre-wrap;word-break:break-all">private String buildTermStr(LLMReq llmReq) {
    List&lt;LLMReq.Term&gt; terms = llmReq.getSchema().getTerms();
    StringBuilder termsDesc = new StringBuilder();
    if (!CollectionUtils.isEmpty(terms)) {
        termsDesc.append(&quot;相关业务术语：&quot;);
        for (int idx = 0; idx &lt; terms.size(); idx++) {
            LLMReq.Term term = terms.get(idx);
            String name = term.getName();
            String description = term.getDescription();
            List&lt;String&gt; alias = term.getAlias();
            String descPart = StringUtils.isBlank(description) ? &quot;&quot; : String.format(&quot;，它通常是指&lt;%s&gt;&quot;, description);
            String aliasPart = CollectionUtils.isEmpty(alias) ? &quot;&quot; : String.format(&quot;，类似的表达还有%s&quot;, alias);
            termsDesc.append(String.format(&quot;%d.&lt;%s&gt;是业务术语%s%s；&quot;, idx + 1, name, descPart, aliasPart));
        }
        if (termsDesc.length() &gt; 0) {
            termsDesc.setLength(termsDesc.length() - 1);
        }
    }

    return termsDesc.toString();
}</code></pre><ol type="1" id="5850d50f-4276-47d2-ac0a-31a4d486e48c" class="numbered-list" start="7"><li>拼接增强问题字符串<p id="959daf31-d783-4dae-aa03-42dbfa62e979" class="">将用户的原始查询问题与上述生成的字符串拼接在一起，形成一个增强版的问题字符串。</p></li></ol><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="23cb54d7-86eb-498f-94fb-c225396d8c83" class="code"><code class="language-Java" style="white-space:pre-wrap;word-break:break-all">return String.format(&quot;%s (补充信息:%s;%s;%s;%s)&quot;, llmReq.getQueryText(),
        linkingListStr, currentDataStr, termStr, priorExts);</code></pre><ol type="1" id="c2a96ff7-daef-4fde-80bc-a10398f57c4f" class="numbered-list" start="8"><li>示例</li></ol><p id="554772f3-742c-4d9f-ab00-e29bf98adb23" class="">完整示例：假设我们有以下 <code>LLMReq</code> 对象：</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="f5d0ecce-c0db-4174-afa4-2d97924b8f37" class="code"><code class="language-Java" style="white-space:pre-wrap;word-break:break-all">LLMReq llmReq = new LLMReq();
llmReq.setQueryText(&quot;所有部门的访问次数&quot;);
llmReq.setCurrentDate(&quot;2024-07-12&quot;);
llmReq.setPriorExts(&quot;过去一年的数据&quot;);
llmReq.setLinking(Arrays.asList(
    new LLMReq.ElementValue(&quot;部门&quot;, &quot;销售&quot;),
    new LLMReq.ElementValue(&quot;部门&quot;, &quot;市场&quot;)
));</code></pre><p id="0e5d6803-dafe-4fee-9c0c-5bd1c7a44a57" class="">执行 <code>buildAugmentedQuestion</code> 函数后，返回的增强问题字符串如下：</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="5361304b-c0d5-4039-a2a4-8c3648a5e212" class="code"><code class="language-PHP" style="white-space:pre-wrap;word-break:break-all">所有部门的访问次数 (补充信息:‘销售’是一个‘部门’，‘市场’是一个‘部门’；当前的日期是2024-07-12；相关业务术语：1.&lt;术语1&gt;是业务术语，类似的表达还有...；过去一年的数据)</code></pre><h3 id="b8964a53-b893-448a-8e48-444940b27fbd" class="">关键词映射：</h3><p id="a1863b98-ff26-4d45-be5f-2f4bbfed6674" class=""><code>buildSchemaStr</code> 函数的主要目的是生成一个字符串，该字符串描述了数据集的表结构，包括表名、指标（metrics）和维度（dimensions）通过遍历数据集的指标和维度列表，生成一个包含表名、指标和维度的描述字符串。这个字符串用于提供给LLM模型以增强生成SQL查询时的上下文信息。</p><ol type="1" id="2c00adfd-afd0-4f8d-bd24-b347837e1fad" class="numbered-list" start="1"><li>获取表名<p id="cbabac06-ab87-4a99-9761-b2c0d79a188e" class="">函数首先从 <code>LLMReq</code> 对象中获取数据集的名称。</p></li></ol><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="f5a1ccac-c808-45d5-8992-2978ab7168b9" class="code"><code class="language-Java" style="white-space:pre-wrap;word-break:break-all">String tableStr = llmReq.getSchema().getDataSetName();</code></pre><ol type="1" id="c77883d1-0e2c-4c6c-b1fe-b7f911049540" class="numbered-list" start="2"><li>构建指标字符串<p id="61cf369b-8559-46f2-aca7-6996fded1272" class="">通过遍历 <code>llmReq</code> 对象中的 <code>metrics</code> 列表，构建一个描述所有指标的字符串。对于每个指标，函数会添加其名称、描述和默认聚合函数（如果存在）。</p></li></ol><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="2baef35a-b4f4-46a3-9325-7256edd379bb" class="code"><code class="language-Java" style="white-space:pre-wrap;word-break:break-all">StringBuilder metricStr = new StringBuilder();

llmReq.getSchema().getMetrics().stream().forEach(
    metric -&gt; {
        metricStr.append(metric.getName());
        if (StringUtils.isNotEmpty(metric.getDescription())) {
            metricStr.append(&quot; COMMENT &#x27;&quot; + metric.getDescription() + &quot;&#x27;&quot;);
        }
        if (StringUtils.isNotEmpty(metric.getDefaultAgg())) {
            metricStr.append(&quot; AGGREGATE &#x27;&quot; + metric.getDefaultAgg().toUpperCase() + &quot;&#x27;&quot;);
        }
        metricStr.append(&quot;,&quot;);
    }
);</code></pre><ol type="1" id="a661c143-6d27-4a14-85ec-9cf9a4a9b93a" class="numbered-list" start="3"><li>构建维度字符串<p id="1ad27568-faa0-4739-a00e-c3d41e40feb7" class="">以类似的方式处理 <code>dimensions</code> 列表，构建一个描述所有维度的字符串。对于每个维度，函数会添加其名称和描述（如果存在）。</p></li></ol><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="e50abb6f-ba10-493a-a7cf-30801276e6e8" class="code"><code class="language-Java" style="white-space:pre-wrap;word-break:break-all">StringBuilder dimensionStr = new StringBuilder();

llmReq.getSchema().getDimensions().stream().forEach(
    dimension -&gt; {
        dimensionStr.append(dimension.getName());
        if (StringUtils.isNotEmpty(dimension.getDescription())) {
            dimensionStr.append(&quot; COMMENT &#x27;&quot; + dimension.getDescription() + &quot;&#x27;&quot;);
        }
        dimensionStr.append(&quot;,&quot;);
    }
);</code></pre><ol type="1" id="0c26ee0f-6cf9-49d2-b8d1-de537726dd4d" class="numbered-list" start="4"><li>格式化字符串<p id="7e8c14f7-3389-4aa4-b6e0-d2e57837be67" class="">函数使用字符串模板将表名、指标和维度字符串组合成一个完整的描述字符串。</p></li></ol><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="c8488fbf-13d8-4919-980a-7f8c620dcc69" class="code"><code class="language-Java" style="white-space:pre-wrap;word-break:break-all">String template = &quot;Table: %s, Metrics: [%s], Dimensions: [%s]&quot;;
return String.format(template, tableStr, metricStr, dimensionStr);</code></pre><ol type="1" id="35c4aa37-334b-46da-a5b0-fe5265a05af3" class="numbered-list" start="5"><li>示例</li></ol><p id="ae20b28b-59e7-44b2-8782-3bfc8262520e" class="">假设我们有以下 <code>LLMReq</code> 对象：</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="6301a2f7-6f46-4709-8fc2-bdba848b1631" class="code"><code class="language-Java" style="white-space:pre-wrap;word-break:break-all">LLMReq llmReq = new LLMReq();
llmReq.setSchema(new Schema());
llmReq.getSchema().setDataSetName(&quot;订单数据集&quot;);

Metric metric1 = new Metric();
metric1.setName(&quot;销售额&quot;);
metric1.setDescription(&quot;总销售额&quot;);
metric1.setDefaultAgg(&quot;SUM&quot;);

Metric metric2 = new Metric();
metric2.setName(&quot;订单数&quot;);
metric2.setDescription(&quot;总订单数&quot;);
metric2.setDefaultAgg(&quot;COUNT&quot;);

llmReq.getSchema().setMetrics(Arrays.asList(metric1, metric2));

Dimension dimension1 = new Dimension();
dimension1.setName(&quot;地区&quot;);
dimension1.setDescription(&quot;销售地区&quot;);

Dimension dimension2 = new Dimension();
dimension2.setName(&quot;销售日期&quot;);
dimension2.setDescription(&quot;订单销售日期&quot;);

llmReq.getSchema().setDimensions(Arrays.asList(dimension1, dimension2));</code></pre><p id="163c617e-f9a3-460b-a14a-269e74ca8efa" class="">执行 <code>buildSchemaStr</code> 函数后返回如下：</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="e55c4816-cab1-48ca-b9be-4d901e0c0fd3" class="code"><code class="language-CSS" style="white-space:pre-wrap;word-break:break-all">Table: 订单数据集, Metrics: [销售额 COMMENT &#x27;总销售额&#x27; AGGREGATE &#x27;SUM&#x27;,订单数 COMMENT &#x27;总订单数&#x27; AGGREGATE &#x27;COUNT&#x27;,], Dimensions: [地区 COMMENT &#x27;销售地区&#x27;,销售日期 COMMENT &#x27;订单销售日期&#x27;,]</code></pre><h3 id="b5e48ceb-deef-4487-9b61-a33dd08c28a3" class="">寻问框架生成代码：</h3><p id="ad83d31e-7348-476f-a64f-4d3e03450072" class="">为了构建最终的询问 <code>promptStr</code>，我们需要结合提供的 <code>INSTRUCTION</code> 模板、示例数据、增强的问题和数据模式。以下是具体步骤和生成的 <code>promptStr</code> 示例：<div class="indented"><h3 id="ad0c2e91-1067-4735-b4a9-f32f23addab9" class="">1. INSTRUCTION 模板</h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="c72b0809-fe33-4209-9dd6-943588160062" class="code"><code class="language-Java" style="white-space:pre-wrap;word-break:break-all">private static final String INSTRUCTION = &quot;&quot;
        + &quot;#Role: You are a data analyst experienced in SQL languages.\n&quot;
        + &quot;#Task: You will be provided a natural language query asked by business users,&quot;
        + &quot;please convert it to a SQL query so that relevant answer could be returned to the user &quot;
        + &quot;by executing the SQL query against underlying database.\n&quot;
        + &quot;#Rules:&quot;
        + &quot;1.ALWAYS use `数据日期` as the date field.&quot;
        + &quot;2.ALWAYS use `datediff()` as the date function.&quot;
        + &quot;3.DO NOT specify date filter in the where clause if not explicitly mentioned in the query.&quot;
        + &quot;4.ONLY respond with the converted SQL statement.\n&quot;
        + &quot;#Exemplars:\n%s&quot;
        + &quot;#UserQuery: %s &quot;
        + &quot;#Schema: %s &quot;
        + &quot;#SQL: &quot;;</code></pre><h3 id="4d371f15-fd44-490f-90cd-2059766a2c34" class="">2. 示例数据</h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="0ca932e6-ae48-4a23-adc0-babfa32b1702" class="code"><code class="language-Java" style="white-space:pre-wrap;word-break:break-all">String exemplarsStr =
        &quot;#UserQuery: 超音数访问次数大于1k的部门是哪些 (补充信息:。当前的日期是2023-09-14)\n#Schema: Table: 超音数产品, Metrics: [访问次数 AGGREGATE &#x27;SUM&#x27;], Dimensions: [部门]\n#SQL: SELECT 部门 FROM 超音数产品 WHERE 访问次数 &gt; 1000\n&quot; +
        &quot;#UserQuery: 超音数pv最高的用户有哪些 (补充信息:。当前的日期是2023-08-31)\n#Schema: Table: 超音数产品, Metrics: [访问次数 AGGREGATE &#x27;SUM&#x27;], Dimensions: [用户名]\n#SQL: SELECT 用户名 FROM 超音数产品 ORDER BY 访问次数 DESC LIMIT 1\n&quot; +
        &quot;#UserQuery: 超音数近半年哪个月的访问次数汇总最高 (补充信息:。当前的日期是2023-09-04)\n#Schema: Table: 超音数产品, Metrics: [访问次数 AGGREGATE &#x27;SUM&#x27;], Dimensions: [数据日期]\n#SQL: SELECT MONTH(数据日期), SUM(访问次数) FROM 超音数产品 WHERE datediff(&#x27;year&#x27;, 数据日期, &#x27;2023-09-04&#x27;) &lt;= 0.5 GROUP BY MONTH(数据日期) ORDER BY SUM(访问次数) DESC LIMIT 1\n&quot; +
        &quot;#UserQuery: 超音数近半年每个月的平均访问次数 (补充信息:。当前的日期是2023-09-04)\n#Schema: Table: 超音数产品, Metrics: [访问次数 AGGREGATE &#x27;AVG&#x27;], Dimensions: [数据日期]\n#SQL: SELECT MONTH(数据日期), AVG(访问次数) FROM 超音数产品 WHERE datediff(&#x27;year&#x27;, 数据日期, &#x27;2023-09-04&#x27;) &lt;= 0.5 GROUP BY MONTH(数据日期)\n&quot; +
        &quot;#UserQuery: 今年以来发行的歌曲中，有哪些在近7天播放超过一千万的 (补充信息:。当前的日期是2023-08-12)\n#Schema: Table: 歌曲库, Metrics: [结算播放量 AGGREGATE &#x27;SUM&#x27;], Dimensions: [发行日期, 数据日期]\n#SQL: SELECT 歌曲名 FROM 歌曲库 WHERE datediff(&#x27;year&#x27;, 发行日期, &#x27;2023-08-12&#x27;) &lt;= 0 AND datediff(&#x27;day&#x27;, 数据日期, &#x27;2023-08-12&#x27;) &lt;= 7 AND 结算播放量 &gt; 10000000\n&quot;;</code></pre><h3 id="8acf0d20-169e-4a65-881d-8ad01b1dfe6c" class="">3. 增强的问题</h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="e871a57e-1d5b-4efa-9f73-8dab70db9372" class="code"><code class="language-Java" style="white-space:pre-wrap;word-break:break-all">String questionAugmented = &quot;超音数所有部门访问次数 (补充信息:当前的日期是2023-09-14;)&quot;;</code></pre><h3 id="bd3f36c1-2d78-4e79-8284-f5a92f742c25" class="">4. 数据模式</h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="683dcdf6-c17c-4dda-b903-d1e48b3468fb" class="code"><code class="language-Java" style="white-space:pre-wrap;word-break:break-all">String dataSemanticsStr = &quot;Table: 超音数数据集, Metrics: [访问次数 AGGREGATE &#x27;SUM&#x27;], Dimensions: [部门]&quot;;</code></pre><h3 id="6da30a37-582b-4895-a339-088af34febdf" class="">5. 最终的 <code>promptStr</code></h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="437c0620-4cae-42ee-803e-79894fd6a376" class="code"><code class="language-Java" style="white-space:pre-wrap;word-break:break-all">String promptStr = String.format(INSTRUCTION, exemplarsStr, questionAugmented, dataSemanticsStr);</code></pre><h3 id="03fe63b6-42bf-42f8-9ef7-4e79b2f8862a" class="">完整的 <code>promptStr</code> 示例</h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="a03b2951-0c83-48f6-ba14-72a9e635656b" class="code"><code class="language-Java" style="white-space:pre-wrap;word-break:break-all">String promptStr = String.format(
    &quot;#Role: You are a data analyst experienced in SQL languages.\n&quot; +
    &quot;#Task: You will be provided a natural language query asked by business users, &quot; +
    &quot;please convert it to a SQL query so that relevant answer could be returned to the user &quot; +
    &quot;by executing the SQL query against underlying database.\n&quot; +
    &quot;#Rules:\n&quot; +
    &quot;1.ALWAYS use `数据日期` as the date field.\n&quot; +
    &quot;2.ALWAYS use `datediff()` as the date function.\n&quot; +
    &quot;3.DO NOT specify date filter in the where clause if not explicitly mentioned in the query.\n&quot; +
    &quot;4.ONLY respond with the converted SQL statement.\n&quot; +
    &quot;#Exemplars:\n%s&quot; +
    &quot;#UserQuery: %s &quot; +
    &quot;#Schema: %s &quot; +
    &quot;#SQL: &quot;,
    exemplarsStr, questionAugmented, dataSemanticsStr
);</code></pre><h3 id="0ab2b66b-99ea-4d3a-a4bf-87ae73cedcce" class="">示例结果</h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="fc24ba25-5569-42c6-8fc7-ed1be4fbf236" class="code"><code class="language-Java" style="white-space:pre-wrap;word-break:break-all">#Role: You are a data analyst experienced in SQL languages.
#Task: You will be provided a natural language query asked by business users, please convert it to a SQL query so that relevant answer could be returned to the user by executing the SQL query against underlying database.
#Rules:
1.ALWAYS use `数据日期` as the date field.
2.ALWAYS use `datediff()` as the date function.
3.DO NOT specify date filter in the where clause if not explicitly mentioned in the query.
4.ONLY respond with the converted SQL statement.
#Exemplars:
#UserQuery: 超音数访问次数大于1k的部门是哪些 (补充信息:。当前的日期是2023-09-14)
#Schema: Table: 超音数产品, Metrics: [访问次数 AGGREGATE &#x27;SUM&#x27;], Dimensions: [部门]
#SQL: SELECT 部门 FROM 超音数产品 WHERE 访问次数 &gt; 1000
#UserQuery: 超音数pv最高的用户有哪些 (补充信息:。当前的日期是2023-08-31)
#Schema: Table: 超音数产品, Metrics: [访问次数 AGGREGATE &#x27;SUM&#x27;], Dimensions: [用户名]
#SQL: SELECT 用户名 FROM 超音数产品 ORDER BY 访问次数 DESC LIMIT 1
#UserQuery: 超音数近半年哪个月的访问次数汇总最高 (补充信息:。当前的日期是2023-09-04)
#Schema: Table: 超音数产品, Metrics: [访问次数 AGGREGATE &#x27;SUM&#x27;], Dimensions: [数据日期]
#SQL: SELECT MONTH(数据日期), SUM(访问次数) FROM 超音数产品 WHERE datediff(&#x27;year&#x27;, 数据日期, &#x27;2023-09-04&#x27;) &lt;= 0.5 GROUP BY MONTH(数据日期) ORDER BY SUM(访问次数) DESC LIMIT 1
#UserQuery: 超音数近半年每个月的平均访问次数 (补充信息:。当前的日期是2023-09-04)
#Schema: Table: 超音数产品, Metrics: [访问次数 AGGREGATE &#x27;AVG&#x27;], Dimensions: [数据日期]
#SQL: SELECT MONTH(数据日期), AVG(访问次数) FROM 超音数产品 WHERE datediff(&#x27;year&#x27;, 数据日期, &#x27;2023-09-04&#x27;) &lt;= 0.5 GROUP BY MONTH(数据日期)
#UserQuery: 今年以来发行的歌曲中，有哪些在近7天播放超过一千万的 (补充信息:。当前的日期是2023-08-12)
#Schema: Table: 歌曲库, Metrics: [结算播放量 AGGREGATE &#x27;SUM&#x27;], Dimensions: [发行日期, 数据日期]
#SQL: SELECT 歌曲名 FROM 歌曲库 WHERE datediff(&#x27;year&#x27;, 发行日期, &#x27;2023-08-12&#x27;) &lt;= 0 AND datediff(&#x27;day&#x27;, 数据日期, &#x27;2023-08-12&#x27;) &lt;= 7 AND 结算播放量 &gt; 10000000
#UserQuery: 超音数所有部门访问次数 (补充信息:当前的日期是2023-09-14;)
#Schema: Table: 超音数数据集, Metrics: [访问次数 AGGREGATE &#x27;SUM&#x27;], Dimensions: [部门]
#SQL:</code></pre></div></p><p id="e09d8273-445e-440e-b3b5-2fdafe01994a" class="">
</p><h2 id="fb7fc505-8d9b-4ea1-bb62-eda0521d1fdf" class="">4.6 数据存储与检索</h2><p id="54f4d171-9d8e-4fba-887e-b5f7d1963d4c" class="">本项目系统默认使用H2内存数据库，重启后会丢失数据，可以重新自行配置到MYSQL等数据库中，默认配置文件均已配置，具体参考8 常见问题。</p><p id="7d872c88-0cef-4f23-bd90-a98360efca09" class="">根据项目日志观察分析，所有信息均完整存储数据库中，所有显示信息均通过反复查询数据库调取。</p><figure id="fa4e3943-2866-49d9-9524-d360fd1c87ff" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/image%209.png"><img style="width:576px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/image%209.png"/></a></figure><h3 id="6c65d501-c57c-41d8-b56b-36118f66bdfd" class="">反复出现数据库查询示例</h3><p id="c957e54d-961b-4c68-9613-5bfe82eca4ef" class="">包含查询指标、聊天记录等：</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="3d1575f5-023d-4ea0-89c4-19e0345dfc65" class="code"><code class="language-CSS" style="white-space:pre-wrap;word-break:break-all">14:28:27 [http-nio-9080-exec-1] DEBUG org.mybatis.spring.SqlSessionUtils 49 - Creating a new SqlSession
14:28:27 [http-nio-9080-exec-1] DEBUG org.mybatis.spring.SqlSessionUtils 49 - SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@428ba2f6] was not registered for synchronization because synchronization is not active
14:28:27 [http-nio-9080-exec-1] DEBUG o.s.jdbc.datasource.DataSourceUtils 115 - Fetching JDBC Connection from DataSource
14:28:27 [http-nio-9080-exec-1] DEBUG o.m.s.t.SpringManagedTransaction 49 - JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@3404ed53] will not be managed by Spring
14:28:27 [http-nio-9080-exec-1] DEBUG c.t.s.c.s.p.m.C.selectList_COUNT 135 - ==&gt;  Preparing: SELECT count(0) FROM s2_chat_query WHERE (chat_id = ? AND user_name = ?)
14:28:27 [http-nio-9080-exec-1] DEBUG c.t.s.c.s.p.m.C.selectList_COUNT 135 - ==&gt; Parameters: 1(Long), admin(String)
14:28:27 [http-nio-9080-exec-1] DEBUG c.t.s.c.s.p.m.C.selectList_COUNT 135 - &lt;==      Total: 1
14:28:27 [http-nio-9080-exec-1] DEBUG c.t.s.c.s.p.m.C.selectList 135 - ==&gt;  Preparing: SELECT question_id,agent_id,create_time,user_name,query_state,chat_id,score,feedback,query_text,query_result,similar_queries,parse_time_cost FROM s2_chat_query WHERE (chat_id = ? AND user_name = ?) ORDER BY question_id DESC LIMIT ?
14:28:27 [http-nio-9080-exec-1] DEBUG c.t.s.c.s.p.m.C.selectList 135 - ==&gt; Parameters: 1(Long), admin(String), 3(Integer)
14:28:27 [http-nio-9080-exec-1] DEBUG c.t.s.c.s.p.m.C.selectList 135 - &lt;==      Total: 3
14:28:27 [http-nio-9080-exec-1] DEBUG org.mybatis.spring.SqlSessionUtils 49 - Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@428ba2f6]
</code></pre><p id="b3511f4e-3e30-4821-8943-9093921b0eac" class="">这段日志记录展示了一个后端服务在处理HTTP请求过程中与数据库的交互。具体步骤如下：</p><ol type="1" id="e875f477-d306-42c2-88b5-7d95b8f6c0f8" class="numbered-list" start="1"><li><strong>创建新的SqlSession</strong>：<ul id="ce18ce6d-ba74-46a4-a5ea-04bb3044ff88" class="bulleted-list"><li style="list-style-type:disc"><code>Creating a new SqlSession</code>：日志显示正在创建一个新的SQL会话（SqlSession）。这是与数据库交互的第一步，涉及到建立一个数据库会话环境。</li></ul></li></ol><ol type="1" id="6b20f9ec-3c76-4dd1-8d35-de18251873ef" class="numbered-list" start="2"><li><strong>SqlSession注册情况</strong>：<ul id="a2754e5d-a656-4254-ac90-98ae93c73ef5" class="bulleted-list"><li style="list-style-type:disc"><code>SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@428ba2f6] was not registered for synchronization because synchronization is not active</code>：这说明创建的SqlSession没有注册同步，因为当前环境没有激活同步操作。这通常意味着该操作不在事务管理之下。</li></ul></li></ol><ol type="1" id="4088c285-82b2-4c52-a080-839a748b00cb" class="numbered-list" start="3"><li><strong>获取数据库连接</strong>：<ul id="873a3515-8eea-4d89-a8be-85a817eb595b" class="bulleted-list"><li style="list-style-type:disc"><code>Fetching JDBC Connection from DataSource</code>：从数据源获取JDBC连接，这是执行SQL命令前的准备步骤。</li></ul></li></ol><ol type="1" id="f1a0a49b-1738-49de-acc8-00d9040d8f59" class="numbered-list" start="4"><li><strong>JDBC连接管理</strong>：<ul id="04d5b728-e354-4064-8947-47a63e0f4b97" class="bulleted-list"><li style="list-style-type:disc"><code>JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@3404ed53] will not be managed by Spring</code>：表明获取的JDBC连接不会被Spring框架管理。通常这种情况出现在手动管理数据库连接或在非标准事务环境下操作时。</li></ul></li></ol><ol type="1" id="754de9db-5749-4775-a8aa-76248bc55615" class="numbered-list" start="5"><li><strong>执行SQL查询</strong>（计数查询）：<ul id="c5d623f8-69bb-4249-b7c0-9dcf427fe4bc" class="bulleted-list"><li style="list-style-type:disc"><code>Preparing: SELECT count(0) FROM s2_chat_query WHERE (chat_id = ? AND user_name = ?)</code>：准备执行一个SQL查询，计算符合特定条件（chat_id和user_name）的记录数。</li></ul><ul id="54f86b1c-fb56-4d3c-b066-d3ed1d00a16c" class="bulleted-list"><li style="list-style-type:disc"><code>Parameters: 1(Long), admin(String)</code>：指明SQL查询中使用的参数，这里使用了聊天ID为1和用户名为&quot;admin&quot;。</li></ul><ul id="77a59cca-8d05-4e2b-b708-dc78511718a9" class="bulleted-list"><li style="list-style-type:disc"><code>Total: 1</code>：查询结果显示，有1条记录满足条件。</li></ul></li></ol><ol type="1" id="fe4332e7-6b7a-4963-a84b-76f637a4a319" class="numbered-list" start="6"><li><strong>执行SQL查询</strong>（选择列表）：<ul id="61352c80-1654-43b3-bf3f-489f13660269" class="bulleted-list"><li style="list-style-type:disc"><code>Preparing: SELECT question_id, agent_id, create_time, user_name, query_state, chat_id, score, feedback, query_text, query_result, similar_queries, parse_time_cost FROM s2_chat_query WHERE (chat_id = ? AND user_name = ?) ORDER BY question_id DESC LIMIT ?</code>：准备执行一个更复杂的SQL查询，选择多个字段，条件同上，并按question_id降序排列，限制返回结果数为3。</li></ul><ul id="fe700f8a-9011-4d33-a24a-83db56b9a04c" class="bulleted-list"><li style="list-style-type:disc"><code>Parameters: 1(Long), admin(String), 3(Integer)</code>：SQL查询使用的参数，包括聊天ID、用户名以及返回的最大记录数。</li></ul><ul id="624419f9-4790-42f1-a40d-a6fd47dcfe9b" class="bulleted-list"><li style="list-style-type:disc"><code>Total: 3</code>：查询结果显示，有3条记录满足条件。</li></ul></li></ol><ol type="1" id="a957e058-eee6-41fc-bef1-113fbc41a659" class="numbered-list" start="7"><li><strong>关闭SqlSession</strong>：<ul id="19822196-55b7-4b0c-85fb-ea4626598bc1" class="bulleted-list"><li style="list-style-type:disc"><code>Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@428ba2f6]</code>：日志记录了非事务性SqlSession的关闭操作，表明此次数据库会话结束。</li></ul></li></ol><h1 id="6b4cd0f9-b1c6-47aa-8548-7f7d932b3390" class="">5. 代码分析</h1><h2 id="b3bd7a95-6437-4c9d-b7fe-a5ed06f0968a" class="">5.1 源码结构</h2><p id="7fb3cddd-c31b-4dab-bb8f-e3cdcfd058f0" class="">.github：负责项目的GitHub配置，包括Issue模板和工作流配置。</p><ul id="8e8a14c0-aae2-4fd2-8620-6be653390ad9" class="bulleted-list"><li style="list-style-type:disc"><strong>ISSUE_TEMPLATE</strong>：存放各种问题模板，用于用户在提交Bug、增强请求、功能请求和问题请求时使用。</li></ul><ul id="ee6f9f07-fb27-4a44-8dff-a7a718e0e8cf" class="bulleted-list"><li style="list-style-type:disc"><strong>workflows</strong>：存放持续集成配置文件，用于不同操作系统（如CentOS、Mac、Ubuntu、Windows）上的CI配置。</li></ul><ul id="69cd0cfb-e389-4112-9088-51072900c509" class="bulleted-list"><li style="list-style-type:disc"><strong>PULL_REQUEST_TEMPLATE.md</strong>：Pull Request的模板文件，规范提交PR时的信息。</li></ul><p id="956da22d-1c55-4c94-9fc9-a80e73bd9b6f" class="">
</p><p id="d1905fac-d195-4329-a094-b04b0615384d" class="">.idea：存放项目的IDE配置文件，通常用于JetBrains系列的IDE（如IntelliJ IDEA）。</p><ul id="47ec5a4c-a385-4f03-a414-afe035909aac" class="bulleted-list"><li style="list-style-type:disc"><strong>.gitignore</strong>：忽略IDE生成的临时文件。</li></ul><ul id="ed911335-9dfc-440c-9052-386b3724b0e6" class="bulleted-list"><li style="list-style-type:disc"><strong>compiler.xml、encodings.xml、jarRepositories.xml、misc.xml、vcs.xml、workspace.xml</strong>：IDE的各种配置文件。</li></ul><p id="70a39eaa-4c9d-410b-aa71-fb3ed734477b" class="">
</p><p id="6bdfaaa4-351d-4baf-9673-42d696287551" class="">assembly：负责项目的打包和构建脚本。</p><ul id="4544710c-08a3-4067-952f-9beb4657a25d" class="bulleted-list"><li style="list-style-type:disc"><strong>bin</strong>：存放不同平台的构建和启动脚本。</li></ul><ul id="fcab7341-f206-4101-b7f9-cdedeedbb8d9" class="bulleted-list"><li style="list-style-type:disc"><strong>build</strong>：存放构建相关的配置文件和打包结果。</li></ul><p id="261cd07c-02f8-4073-b4dc-171fe0750748" class="">
</p><p id="97246b47-865e-4879-ab46-7a1ac9478888" class="">auth：负责项目的认证和授权功能。</p><ul id="483d6600-1dcd-44a8-96a2-9929fb7b8cc0" class="bulleted-list"><li style="list-style-type:disc"><strong>api</strong>：认证API的源码和目标文件。</li></ul><ul id="47952c68-d88c-4776-aa22-7c8096046be9" class="bulleted-list"><li style="list-style-type:disc"><strong>authentication</strong>：认证模块的源码和目标文件。</li></ul><ul id="59a78f35-1ea6-45bb-97c1-df5d00f1962f" class="bulleted-list"><li style="list-style-type:disc"><strong>authorization</strong>：授权模块的源码和目标文件。</li></ul><ul id="b565a419-e27b-4620-a37b-c92e80bfb0c4" class="bulleted-list"><li style="list-style-type:disc"><strong>target</strong>：构建过程中的临时文件和结果文件。</li></ul><p id="06d0311f-dc4d-46c2-87b7-67db8afb50ec" class="">
</p><p id="e0bbbbff-6016-43f2-a408-595ab4c56e83" class="">benchmark：负责性能测试和基准测试。</p><ul id="061974a7-37bf-4c0e-a444-fe8bbc2e2556" class="bulleted-list"><li style="list-style-type:disc"><strong>data</strong>：存放用于基准测试的数据文件。</li></ul><ul id="0872ea5e-ec82-42b0-b796-714e27bde4c5" class="bulleted-list"><li style="list-style-type:disc"><strong>benchmark.md、benchmark.py、requirements.txt</strong>：基准测试的说明、脚本和依赖文件。</li></ul><p id="fa624398-5e0d-429b-8826-c568c78897ca" class="">
</p><p id="109fa898-4f69-49b9-92f3-1d8e3cc41cd2" class="">chat：负责聊天功能的实现。</p><ul id="4f3ab12f-23c5-4657-a2bf-a7d18b6b6f71" class="bulleted-list"><li style="list-style-type:disc"><strong>api</strong>：聊天API的源码和目标文件。</li></ul><ul id="98b48f79-8f2e-42c8-a727-0c1594da9516" class="bulleted-list"><li style="list-style-type:disc"><strong>server</strong>：聊天服务器的源码和目标文件。</li></ul><ul id="1a52ae1c-d825-4f7b-b755-56046c68e1d4" class="bulleted-list"><li style="list-style-type:disc"><strong>target</strong>：构建过程中的临时文件和结果文件。</li></ul><p id="cf823733-8ed9-45c7-8fbf-2434760e877b" class="">
</p><p id="26f3148c-3b47-441b-b457-e2cbbb3f1500" class="">checkstyle：存放代码风格检查的配置文件。</p><ul id="f4e7ed4f-7d28-4c05-89a2-715adbc9b056" class="bulleted-list"><li style="list-style-type:disc"><strong>checkstyle.xml</strong>：Checkstyle配置文件。</li></ul><p id="05f05545-77ab-46c5-824c-777a9160bade" class="">
</p><p id="5a834b8f-65f7-4e70-9385-0130e8739de4" class="">common：存放项目的公共代码和模块。</p><ul id="461944bb-76da-4abb-bdaf-d9e94e3231f8" class="bulleted-list"><li style="list-style-type:disc"><strong>src</strong>：主代码和测试代码。</li></ul><ul id="9af32a7f-d65c-48fa-9bf4-1697e70a2cc8" class="bulleted-list"><li style="list-style-type:disc"><strong>target</strong>：构建过程中的临时文件和结果文件。</li></ul><p id="adcf475d-92b6-4dea-963c-44f2be8bd5ac" class="">
</p><p id="b60ee697-66f9-4946-aedf-5669aea2d124" class="">docker：负责项目的Docker配置和相关脚本。</p><ul id="3f907b2c-9874-4b32-9229-098a5380f81f" class="bulleted-list"><li style="list-style-type:disc"><strong>docker-build.bat、docker-build.sh</strong>：Docker构建脚本。</li></ul><ul id="ee626dd2-50ab-40ce-b97e-ceff0d929eec" class="bulleted-list"><li style="list-style-type:disc"><strong>docker-compose.yml、Dockerfile</strong>：Docker编排文件和Docker镜像配置文件</li></ul><p id="072d41b9-0156-47c3-bbac-38523104f691" class="">
</p><p id="890ab083-15e0-4f6d-a2a5-8553533fcaec" class="">evaluation：负责模型评估和数据处理。</p><ul id="1ad8a352-812b-4423-8ea8-47c483371623" class="bulleted-list"><li style="list-style-type:disc"><strong>config、data</strong>：存放评估过程中的配置文件和数据文件。</li></ul><ul id="074ca7a1-217a-4cb3-b1bb-1bbb6a598494" class="bulleted-list"><li style="list-style-type:disc"><strong>各个Python脚本</strong>：实现评估和数据处理的功能。</li></ul><p id="6eab107a-39a3-413e-bcfe-4580d19111ed" class="">
</p><p id="2123c50c-b6f2-4219-9560-373a2feee3e7" class="">headless：负责无头模式下的功能实现。</p><ul id="43ab9207-3091-4e2b-8e80-1c797ebac1d5" class="bulleted-list"><li style="list-style-type:disc"><strong>api、chat、core、server</strong>：各模块的源码和目标文件。</li></ul><ul id="b39c5909-bbb9-459a-89fe-a1c005802fda" class="bulleted-list"><li style="list-style-type:disc"><strong>target</strong>：构建过程中的临时文件和结果文件。</li></ul><p id="77fcc0bd-b6b4-4aea-99a1-62e9ee7d9c24" class="">
</p><p id="7ddd1b9a-cd94-410c-a38c-e6c4b4f71925" class="">launchers：存放项目的启动器相关代码和配置。</p><ul id="d0ae49b8-4285-4aaa-8320-da14f67e7639" class="bulleted-list"><li style="list-style-type:disc"><strong>chat、common、headless、standalone</strong>：各个启动器模块的源码和目标文件。</li></ul><ul id="1b967b59-8392-4f42-a9d8-f9f74e58be11" class="bulleted-list"><li style="list-style-type:disc"><strong>target</strong>：构建过程中的临时文件和结果文件。</li></ul><p id="35b72906-12f0-42ea-9bb1-d1afaacc1e16" class="">
</p><p id="718df580-45a8-4eaa-97d6-a2818a4343e2" class="">logs：存放项目运行过程中的日志文件。</p><ul id="534022fe-360a-4abb-b4ca-ca715eac85b3" class="bulleted-list"><li style="list-style-type:disc"><strong>各种.log和.log.gz文件</strong>：不同模块和功能的日志文件。</li></ul><p id="d7c083ce-bcda-45d7-8ebf-65441f3319a3" class="">
</p><p id="8dcaeb13-c11f-4b4a-9bd9-cfe8fe4c2a6a" class="">target：存放构建过程中的临时文件和结果文件。</p><ul id="a3677cc2-0f4d-41eb-9751-bbf4f499539d" class="bulleted-list"><li style="list-style-type:disc"><strong>checkstyle相关文件</strong>：代码风格检查的结果文件。</li></ul><p id="47a17c5b-4a13-4b02-9ea3-d6277dd4365a" class="">
</p><p id="8856ccb0-43ad-4557-8ae4-ac2ed123fd14" class="">webapp：负责Web应用的前端部分。</p><ul id="8e55d500-b3cc-4464-9fde-4b5618e2df68" class="bulleted-list"><li style="list-style-type:disc"><strong>node_modules</strong>：前端依赖的模块。</li></ul><ul id="9b41116f-d1cb-451f-882f-a36c64857b3d" class="bulleted-list"><li style="list-style-type:disc"><strong>packages</strong>：前端项目包。</li></ul><ul id="f51b600f-505c-42a9-aa8e-d12743176399" class="bulleted-list"><li style="list-style-type:disc"><strong>各个脚本和配置文件</strong>：前端开发和生产环境的启动脚本和配置文件。</li></ul><p id="53fd90fc-d66b-4012-a793-3a8ae0551396" class="">
</p><p id="c8264bd7-7d2e-4f9e-8a4f-5b1d02e4debb" class="">其他：</p><ul id="5cc5e7ad-8e18-4684-992d-d974856b565c" class="bulleted-list"><li style="list-style-type:disc"><strong>.flattened-pom.xml</strong>：扁平化的Maven配置文件。</li></ul><ul id="a5bdf351-ad42-4f57-ad82-9cda81c38f0c" class="bulleted-list"><li style="list-style-type:disc"><strong>.gitignore</strong>：Git忽略文件。</li></ul><ul id="dcad194c-f059-4eb2-a4c1-c1ade02b519f" class="bulleted-list"><li style="list-style-type:disc"><strong>CHANGELOG.md</strong>：项目变更日志。</li></ul><ul id="ac43bed0-bab5-4978-acc7-cdf8385470da" class="bulleted-list"><li style="list-style-type:disc"><strong>LICENSE</strong>：项目的许可证。</li></ul><ul id="2c66bf72-0b82-4fd7-beee-25ee251c0dca" class="bulleted-list"><li style="list-style-type:disc"><strong>pom.xml</strong>：Maven主配置文件。</li></ul><ul id="d5599621-3854-4594-a393-03a798838519" class="bulleted-list"><li style="list-style-type:disc"><strong>README.md、README_CN.md、README_JP.md</strong>：项目的说明文档，分别用英文、中文和日文编写。</li></ul><h2 id="7e93c1a5-7ed2-4cf4-a276-270719da0c92" class="">5.2 模块位置</h2><ul id="82702cb7-c022-4032-b109-90b8470ff9a0" class="bulleted-list"><li style="list-style-type:disc">项目接口（ChatBI Interface）: </li></ul><p id="24850d8d-26fe-4a97-9d83-bfb34786b00d" class=""><code>chat/server/src/main/java/com/tencent/supersonic/chat/server/service/impl/</code></p><figure id="edc13357-6226-4f4e-8eda-7c3eddbc1150" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%209.png"><img style="width:384px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%209.png"/></a></figure><ul id="b51289bc-f90e-4597-9c72-559efaccae0d" class="bulleted-list"><li style="list-style-type:disc">可视化对话（Visualization Chats）: </li></ul><p id="317f99e3-4571-4665-8b39-75b15e22c62b" class=""><code>webapp/packages/chat-sdk/src/Chat</code></p><figure id="62758637-ccd1-4e76-a9b4-fc0f2370f37b" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2010.png"><img style="width:384px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2010.png"/></a></figure><ul id="27088579-1c42-4fa4-834c-b4e68bdfa8a0" class="bulleted-list"><li style="list-style-type:disc"><strong>模式映射器(Schema Mapper)：</strong> </li></ul><p id="c7af78c3-91d6-4bc0-8972-1f2949aa629d" class="">将自然语言文本在知识库中进行匹配，为后续的语义解析提供相关信息。</p><p id="fb1024bc-f302-4b0d-8c46-18729e28c252" class=""><code>headless/chat/src/main/java/com/tencent/supersonic/headless/chat/mapper</code></p><figure id="b2db424d-d88c-41e7-b114-391ef1476d96" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2011.png"><img style="width:384px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2011.png"/></a></figure><ul id="09e7d706-c2e3-4dd7-8ef9-44f10a09cd16" class="bulleted-list"><li style="list-style-type:disc"><strong>模型知识库(Knowledge Base)：</strong></li></ul><p id="d0b06a51-9f2f-4c81-99ab-013b50841c0e" class="">定期从语义模型中提取相关的模式信息，构建词典和索引，以便后续的模式映射。</p><p id="3939ebb2-f760-49d7-8b72-05331a4aa2fc" class=""><code>headless/chat/src/main/java/com/tencent/supersonic/headless/chat/knowledge</code></p><figure id="d2a60a22-ad04-4170-a633-23ed8a36d359" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2012.png"><img style="width:384px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2012.png"/></a></figure><ul id="b112856e-5f5b-40a8-b7f6-859ef87b52a7" class="bulleted-list"><li style="list-style-type:disc"><strong>语义解析器(Semantic Parser)：</strong></li></ul><p id="57d09539-f054-4f6a-9055-088a08b38766" class="">理解用户查询并抽取语义信息，生成语义查询语句S2SQL。</p><p id="af247aad-0f6c-4735-ada9-d7fa69d7d810" class=""><code>headless/chat/src/main/java/com/tencent/supersonic/headless/chat/parser</code></p><figure id="a4f7631c-baf0-4da3-8c6c-8a24856c3020" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2013.png"><img style="width:384px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2013.png"/></a></figure><ul id="7a902620-eae3-42e6-a7bf-29d9a8b99d0e" class="bulleted-list"><li style="list-style-type:disc"><strong>问答记忆(Chat Memory)：</strong></li></ul><p id="d92b2d2a-b564-40ad-8182-c35763fa7321" class="">将历史的查询轨迹进行封装，可被召回作为few-shot样例嵌入提示词。</p><figure id="c46048b0-0529-4b35-b925-337307ba45d9" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2014.png"><img style="width:528px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2014.png"/></a></figure><ul id="4443921d-707b-4543-a537-93515275ef81" class="bulleted-list"><li style="list-style-type:disc"><strong>问答插件(Chat Plugin)：</strong></li></ul><p id="5caeb49b-2107-43ab-8a13-aeeb6ecea7b9" class="">通过第三方工具扩展功能给定所有配置的插件及其功能描述和示例问。</p><p id="df421335-569f-4542-bb1d-435425176649" class=""><code>chat/server/src/main/java/com/tencent/supersonic/chat/server/plugin</code></p><figure id="63bfe710-2339-428d-b8df-1dd30cb7e223" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2015.png"><img style="width:336px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2015.png"/></a></figure><ul id="4af68a9e-16d7-4bbc-8abc-296fed3beff7" class="bulleted-list"><li style="list-style-type:disc"><strong>语义修正器(Semantic Corrector)：</strong> </li></ul><p id="126b821f-cfb6-4dd4-9d18-c44ec7d1345c" class="">检查语义查询语句的合法性，对不合法的信息做修正和优化处理。</p><p id="bd2dc4fc-ffa4-45b2-bd0f-24bc28c2c0c2" class=""><code>headless/chat/src/main/java/com/tencent/supersonic/headless/chat/corrector</code></p><figure id="abcea21e-06d2-4304-93ad-a92f5a6bac35" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2016.png"><img style="width:336px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2016.png"/></a></figure><p id="4e235768-5345-420e-a74b-dea8fb2d3998" class="">
</p><ul id="6a274f10-09d7-4d80-ae9f-46be2af20e2e" class="bulleted-list"><li style="list-style-type:disc"><strong>语义翻译器(Semantic Translator)</strong> + （Semantic Data Model）:</li></ul><p id="2c623231-8b7f-4b05-8324-3337f23d459d" class="">将语义查询语句翻译成可在物理数据模型上执行的SQL语句。</p><figure id="9c37953d-9501-4161-acdd-e6a16d942987" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2017.png"><img style="width:288px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2017.png"/></a></figure><h2 id="c47643f7-f069-4de5-8843-3a31c936c464" class="">5.3 模块依赖关系</h2><p id="81ee4fcd-0a18-465c-a44c-6e60e2bdbb25" class="">具体联系请参考4.1 数据流图，以及4.2 数据流详细分析。</p><h1 id="ce57e276-8620-4663-a13c-316d72b91bed" class="">6. 关键技术</h1><h2 id="de31e4ec-dedd-4c8f-9cc6-42182b4b876c" class="">6.1 大模型相关技术</h2><h3 id="3e12cbef-c715-4b97-857a-b477e94b66e2" class="">少样本提示：</h3><figure id="da5d1ea7-12b1-4fb4-a7cf-76a192b06b7a"><a href="https://www.promptingguide.ai/zh/techniques/fewshot" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">少样本提示 – Nextra</div><div class="bookmark-description">A Comprehensive Overview of Prompt Engineering</div></div><div class="bookmark-href"><img src="https://www.promptingguide.ai/144-favicon.svg" class="icon bookmark-icon"/>https://www.promptingguide.ai/zh/techniques/fewshot</div></div></a></figure><h3 id="f4a41d14-692c-462d-a2ad-8ee9876a0c16" class="">自一致性：</h3><figure id="50c27155-88fd-4ac1-aea3-b4c5e27c06c5"><a href="https://www.promptingguide.ai/zh/techniques/consistency" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">自我一致性 – Nextra</div><div class="bookmark-description">A Comprehensive Overview of Prompt Engineering</div></div><div class="bookmark-href"><img src="https://www.promptingguide.ai/144-favicon.svg" class="icon bookmark-icon"/>https://www.promptingguide.ai/zh/techniques/consistency</div></div></a></figure><figure id="80e732cd-7ce1-45a0-9f9a-c4acc7800d70"><a href="https://blog.csdn.net/qq_16949707/article/details/131532600" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">ICLR 2023 | Self-Consistency: Google超简单方法改善大模型推理能力_self-consistency improves chain of thought reasoni-CSDN博客</div><div class="bookmark-description">文章浏览阅读1.5k次，点赞6次，收藏11次。论文地址：https://arxiv.org/abs/2203.11171大模型（10B以上）生成结果的多样性diversity和质量比较好。本文的一大特点是没有利用不同的多个模型来集成，而是只用当个大模型采样输出不同的推理路径和结果来集成，有一个现象就是随着模型size的变大，集成的效果越来越高，说明大size的模型（一般要求要10B以上），其多样性diversity足够好，同时其生成的答案的质量也有保障，所以最终融合的效果才会比较好。可以将其当作是一种生成高质量训练数据的方法。_self-consistency improves chain of thought reasoning in language models</div></div><div class="bookmark-href"><img src="https://g.csdnimg.cn/static/logo/favicon32.ico" class="icon bookmark-icon"/>https://blog.csdn.net/qq_16949707/article/details/131532600</div></div></a></figure><figure id="ff2e8027-280a-4485-88dc-ffec53a996c0"><a href="https://arxiv.org/pdf/2203.11171" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">arxiv.org</div></div><div class="bookmark-href">https://arxiv.org/pdf/2203.11171</div></div></a></figure><figure id="fa19bca3-3276-4f3b-b4f8-37257e2260fe"><a href="https://developer.volcengine.com/articles/7389112187136000036" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">PET-SQL：具有跨一致性的大模型Prompt增强两阶段Text-to-SQL框架！ - 文章 - 开发者社区 - 火山引擎</div><div class="bookmark-description">PET-SQL是一种新颖的两阶段Text-to-SQL方法，通过引入参考增强的提示表示和跨一致性机制，提升大模型的SQL生成。首先利用随机抽样的单元格值和模式信息指导模型生成初步SQL，然后通过模式链接简化提示信息，最终生成准确的SQL查询</div></div><div class="bookmark-href"><img src="https://lf1-cdn-tos.bytegoofy.com/goofy/tech-fe/fav.png" class="icon bookmark-icon"/>https://developer.volcengine.com/articles/7389112187136000036</div></div></a></figure><h2 id="f36bbb2f-2cf8-4678-b5cb-474fba1b1c7f" class="">6.2 SQL解析框架 Apache Calcite</h2><p id="26958f62-4ab1-406f-a05b-48853f64e64a" class="">主要负责语义翻译模块，将优化后S2SQL解析为可执行SQL语句并进行合理优化</p><h3 id="3eaa5121-20d4-432d-8170-0b1c78716c86" class="">主要功能</h3><ol type="1" id="adad5456-e8ec-428a-87b1-e9e98a5ef7c6" class="numbered-list" start="1"><li><strong>SQL 解析和验证</strong>：<ul id="cbe09927-eacf-4366-abe8-addce58849d6" class="bulleted-list"><li style="list-style-type:disc">Calcite 可以解析标准 SQL 语法，并将其转换为内部的抽象语法树 (AST) 或者关系表达式 (RelNode)。</li></ul><ul id="d5b5ee80-df09-4e05-8269-318f6398ffeb" class="bulleted-list"><li style="list-style-type:disc">它还可以验证 SQL 查询的合法性，例如检查语法错误、检查字段或表的存在性。</li></ul></li></ol><ol type="1" id="8d11ac73-c6b7-4cbc-8269-b55ccae991a8" class="numbered-list" start="2"><li><strong>查询优化</strong>：<ul id="630f6818-1c53-4587-8dcf-fbfece4b74fc" class="bulleted-list"><li style="list-style-type:disc">Calcite 提供了一套优化规则，可以对查询进行逻辑优化。比如它会将查询中的某些操作重写为更高效的形式，或者消除冗余的计算。</li></ul><ul id="361d41fc-4ff4-4ae7-a3fb-5f709cba6714" class="bulleted-list"><li style="list-style-type:disc">它支持自定义的优化规则，允许开发者根据特定需求进行扩展。</li></ul></li></ol><ol type="1" id="ec1c4926-d3fa-4fb8-8bdf-75cec50a2e17" class="numbered-list" start="3"><li><strong>查询计划生成</strong>：<ul id="9cd92e2d-6763-49c8-80fb-31db922f97cc" class="bulleted-list"><li style="list-style-type:disc">Calcite 将优化后的查询表达式转换为物理查询计划，即将查询转换为可在特定数据库引擎或执行环境中运行的形式。</li></ul></li></ol><ol type="1" id="69c4ad41-647d-4fde-91aa-d4c6d660bae6" class="numbered-list" start="4"><li><strong>多数据源支持</strong>：<ul id="57f7a3c3-3649-4676-ab66-dd3d57efde59" class="bulleted-list"><li style="list-style-type:disc">Calcite 支持对多种异构数据源的访问，如关系型数据库、NoSQL 数据库、文件系统等，并可以将它们统一为一个 SQL 接口。</li></ul></li></ol><h3 id="56a4b8d0-a8d7-49d4-8902-b8d2f3536553" class="">其他资料</h3><figure id="53f68bd6-6161-4f07-9714-67e791fa4f52"><a href="https://strongduanmu.com/blog/apache-calcite-quick-start-guide.html" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">Apache Calcite 快速入门指南</div><div class="bookmark-description">注意：本文基于 Calcite 1.35.0 版本源码进行学习研究，其他版本可能会存在实现逻辑差异，对源码感兴趣的读者请注意版本选择。   Calcite 简介 Apache Calcite 是一个动态数据管理框架，提供了：SQL 解析、SQL 校验、SQL 查询优化、SQL 生成以及数据连接查询等典型数据库管理功能。Calcite 的目标是 One Size Fits All，即一种方案适应所</div></div><div class="bookmark-href"><img src="https://strongduanmu.com/assets/placeholder/apple-touch-icon.png" class="icon bookmark-icon"/>https://strongduanmu.com/blog/apache-calcite-quick-start-guide.html</div></div><img src="https://strongduanmu.com/assets/blog/2022/07/31/1659249652.png" class="bookmark-image"/></a></figure><figure id="3471785c-ddc9-4315-9dda-54556670c093"><a href="https://blog.csdn.net/QXC1281/article/details/89481346" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">Apache Calcite教程-SQL解析-Calcite SQL解析_java使用apcahe calcite 解析sql-CSDN博客</div><div class="bookmark-description">文章浏览阅读1.1w次，点赞9次，收藏24次。Calcite SQL解析代码目录config.fmppparserImpls.ftl/compoundIdentifier.ftl生成解析器的流程Sql解析使用解析示例代码解析流程常用类SpanSqlAbstractParserImplSqlParseExceptionSqlParserSqlParserImplFactorySqlParserPosSqlParserUtilSqlNodeSq..._java使用apcahe calcite 解析sql</div></div><div class="bookmark-href"><img src="https://g.csdnimg.cn/static/logo/favicon32.ico" class="icon bookmark-icon"/>https://blog.csdn.net/QXC1281/article/details/89481346</div></div></a></figure><figure id="24865667-d0a8-442a-af93-58ea755c9c89"><a href="https://segmentfault.com/a/1190000043345921" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">segmentfault.com</div></div><div class="bookmark-href">https://segmentfault.com/a/1190000043345921</div></div></a></figure><figure id="71ac3297-1de5-4470-91d7-a44e7f155f84"><a href="https://segmentfault.com/a/1190000040829100" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title"></div></div><div class="bookmark-href">https://segmentfault.com/a/1190000040829100</div></div></a></figure><h2 id="35f06384-6ac3-4e3b-9525-7af8281064f6" class="">6.3 大模型交互框架 langchain4j</h2><figure id="6972919d-34d9-4ff6-9b8d-fba2288b5f1d" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2018.png"><img style="width:528px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2018.png"/></a></figure><figure id="f081bc73-0f34-453a-8277-f04737acbdc1"><a href="https://www.langchain.com.cn/" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">LangChain中文网:500页中文文档教程，助力大模型LLM应用开发从入门到精通</div><div class="bookmark-description">LangChain中文站，助力大语言模型LLM应用开发、chatGPT应用开发。</div></div><div class="bookmark-href">https://www.langchain.com.cn/</div></div></a></figure><figure id="93974610-742b-4e46-8afb-64e824ccc8d3"><a href="https://docs.langchain4j.dev/intro/" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">Introduction | LangChain4j</div><div class="bookmark-description">Welcome!</div></div><div class="bookmark-href"><img src="https://docs.langchain4j.dev/img/favicon.ico" class="icon bookmark-icon"/>https://docs.langchain4j.dev/intro/</div></div></a></figure><figure id="b0eb90df-5d9b-43ec-a71e-4222d2a1e5d6"><div class="source">https://github.com/langchain4j/langchain4j/</div></figure><h3 id="438a50e9-082d-410b-9535-56ac4c0101c4" class="">OPENAI协议样例（Supersonic使用）</h3><figure id="bf064966-b4ab-4b92-bdc2-8f5f8bb334e0"><a href="https://docs.langchain4j.dev/integrations/language-models/open-ai" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">OpenAI | LangChain4j</div><div class="bookmark-description">If you are using Quarkus, please refer to the</div></div><div class="bookmark-href"><img src="https://docs.langchain4j.dev/img/favicon.ico" class="icon bookmark-icon"/>https://docs.langchain4j.dev/integrations/language-models/open-ai</div></div></a></figure><figure id="772e89ef-2992-45af-a3c0-613dad11a7eb" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2019.png"><img style="width:528px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2019.png"/></a></figure><h3 id="4f60713f-d7a5-4ac7-9a5d-300e7527cb7b" class="">可参考SQL交互库（包含Fewshot模板，源代码具有参考价值）</h3><p id="c3b1c5f3-7b4a-4f4e-9bee-894bb95557b2" class="">提供了LLM生成SQL的便捷方式，跟Supersonic的获取基础模板后自行修正不一样，是连接数据库后更直接的调用大模型能力生成，效果有待验证，但实现逻辑直接。Supersonic项目中使用的是简单的问询模板。</p><p id="d52c6e23-a4a3-4222-9113-0319611ad70b" class="">LangChain 的 SQL 代理提供了一个高级的方式来与 SQL 数据库进行交互。这个代理的设计使得用户可以更灵活地操作数据库，具体优势包括：</p><ol type="1" id="49d7aa14-803b-47ab-951b-671d659de21e" class="numbered-list" start="1"><li><strong>智能问答能力</strong>：SQL 代理可以根据数据库的模式和内容回答关于数据库结构或特定表的问题，这使得用户在不直接查看数据库结构的情况下，也能快速了解和操作数据库内容。</li></ol><ol type="1" id="986d3795-05c5-4036-a60c-d92f5be4701c" class="numbered-list" start="2"><li><strong>错误恢复</strong>：在执行查询时，如果发生错误，SQL 代理可以捕获错误回溯（backtrace），并重新生成正确的查询。这个功能对于调试和优化查询非常有用，帮助用户避免常见的错误并提高查询效率。</li></ol><ol type="1" id="6367b332-0e6a-4d22-bf2e-f70510af8a73" class="numbered-list" start="3"><li><strong>迭代查询</strong>：有时候回答一个问题需要多次查询数据库。SQL 代理能够根据用户问题的需要，自动进行多次查询，直到找到满意的答案。</li></ol><ol type="1" id="e951e475-f09d-4565-8ce2-18a8c3a2ef05" class="numbered-list" start="4"><li><strong>效率优化</strong>：代理能够智能地只从相关的表中检索必要的模式信息，有效地节约资源和令牌使用，提高查询效率。</li></ol><p id="55c046ae-3363-470b-95f6-00691207fcaa" class="">为了初始化这个代理，你需要使用 <code>create_sql_agent</code> 构造函数。这个函数是基于 <code>SQLDatabaseToolkit</code> 来构建的，包含了以下工具和功能：</p><ul id="b3c54d0f-72a7-459d-8f60-7d7191d9cc02" class="bulleted-list"><li style="list-style-type:disc"><strong>创建和执行查询</strong>：允许用户定义和执行SQL查询。</li></ul><ul id="62e30cc2-4042-4ada-aeba-07c3e2d7842a" class="bulleted-list"><li style="list-style-type:disc"><strong>检查查询语法</strong>：自动检查SQL查询的语法正确性，帮助用户避免语法错误。</li></ul><ul id="b2357acb-95d6-4e5c-98ef-10bfe7c5c3da" class="bulleted-list"><li style="list-style-type:disc"><strong>检索表描述</strong>：能够提供数据库表的结构和描述信息，帮助用户更好地理解数据存储的细节。</li></ul><ul id="6475c608-0a86-4626-8246-201429e24a78" class="bulleted-list"><li style="list-style-type:disc"><strong>等等</strong>：包括更多有助于数据库管理和数据检索的工具和功能。</li></ul><p id="bfdb5c9b-ad4d-4a50-aadf-0b2b9cf1b84d" class="">实现：</p><ul id="94ef595c-9c07-4a1f-ae1a-e6324916c441" class="bulleted-list"><li style="list-style-type:disc"><strong>数据库连接</strong>：首先，SQL 代理需要与数据库建立连接。这通常通过提供数据库的连接字符串（包括数据库的类型、服务器地址、端口号、数据库名、用户名和密码等）来实现。连接一旦建立，代理就可以发送查询命令和接收数据。</li></ul><ul id="b28cdb7e-2e70-4f89-ae81-7b94969135a4" class="bulleted-list"><li style="list-style-type:disc"><strong>发送查询</strong>：用户通过代理输入查询请求，代理则将这些请求转化为适合数据库的 SQL 语句。这一过程可能涉及到解析用户的自然语言查询，转换为结构化的 SQL 查询。</li></ul><ul id="ddb23756-0cd5-46fc-85f1-e92d1987ca8f" class="bulleted-list"><li style="list-style-type:disc"><strong>执行查询</strong>：SQL 代理使用 SQLDatabaseToolkit 的功能来执行构建的 SQL 查询。这包括对 SQL 语句的语法进行检查以确保其正确性，然后将其发送到数据库服务器执行。</li></ul><ul id="c991c7c4-4bdc-4081-9b9a-c46db560ff80" class="bulleted-list"><li style="list-style-type:disc"><strong>错误处理与恢复</strong>：如果查询过程中出现错误，SQL 代理可以捕捉到这些错误（例如，语法错误、执行超时等）。代理可以基于错误的类型进行适当的调整或重试策略，如修改查询语句或调整查询参数。</li></ul><ul id="ab331108-200a-42bc-b5c8-2f8ab5459fa9" class="bulleted-list"><li style="list-style-type:disc"><strong>数据接收和处理</strong>：查询执行后，数据库会返回数据。SQL 代理接收这些数据，并根据用户的需求进行处理和格式化，以便用户可以理解和使用这些数据。</li></ul><ul id="06ab9b1a-aff9-4bbd-bb93-c4b0f0c29f7d" class="bulleted-list"><li style="list-style-type:disc"><strong>多次查询支持</strong>：对于复杂的问题，可能需要多次查询才能得到完整的答案。SQL 代理可以根据初次查询的结果决定是否需要进一步的查询，并连续执行多个查询。</li></ul><ul id="40f81a7c-4e94-4f1d-a1ac-d840e638a057" class="bulleted-list"><li style="list-style-type:disc"><strong>资源和权限管理</strong>：SQL 代理还需要管理与数据库交互时的权限和资源使用，确保数据安全性和访问效率。这可能涉及到限制某些类型的查询或调整查询频率和数据加载量。</li></ul><figure id="6e0dd2dd-ac66-424c-9334-4752e1166b29"><a href="https://www.langchain.com.cn/use_cases/sql/agents" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">代理商 | LangChain中文网:500页中文文档教程，助力大模型LLM应用开发从入门到精通</div><div class="bookmark-description">LangChain中文站，助力大语言模型LLM应用开发、chatGPT应用开发。</div></div><div class="bookmark-href"><img src="https://js.langchain.com/img/favicon.ico" class="icon bookmark-icon"/>https://www.langchain.com.cn/use_cases/sql/agents</div></div></a></figure><figure id="ac57339a-5463-4367-9eb5-1057042f4116"><a href="https://python.langchain.com/v0.2/docs/integrations/toolkits/sql_database/" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">SQL Database | 🦜️🔗 LangChain</div><div class="bookmark-description">This notebook showcases an agent designed to interact with a SQL databases.</div></div><div class="bookmark-href"><img src="https://python.langchain.com/v0.2/img/brand/favicon.png" class="icon bookmark-icon"/>https://python.langchain.com/v0.2/docs/integrations/toolkits/sql_database/</div></div><img src="https://python.langchain.com/v0.2/img/brand/theme-image.png" class="bookmark-image"/></a></figure><h2 id="1a347d70-ed9e-4d9d-99d6-c38cb950e580" class="">6.4 自动文档框架 Swagger </h2><figure id="00d50527-749b-4e19-bb98-0b6e4d8da643"><a href="https://blog.csdn.net/zhanggonglalala/article/details/98070986" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">超详细！使用swagger自动生成Api文档（swagger-ui）_swagger生成api 前端-CSDN博客</div><div class="bookmark-description">文章浏览阅读10w+次，点赞80次，收藏560次。介绍swagger是什么？swagger-ui使用swagger-ui简单使用swagger api注解本文参考：介绍这里是一些介绍，如果想直接看如何使用，请直接跳过这部分。但如果有时间，就姑且看一下吧，这部分大概用时3分钟。swagger是什么？Swagger 是一个规范和完整的框架，用于生成、描述、调用和可视化 RESTful 风格的 Web 服务的接口..._swagger生成api 前端</div></div><div class="bookmark-href"><img src="https://g.csdnimg.cn/static/logo/favicon32.ico" class="icon bookmark-icon"/>https://blog.csdn.net/zhanggonglalala/article/details/98070986</div></div></a></figure><h3 id="29e522c9-c07f-405d-9f80-1dc570f2d27c" class="">参考内容</h3><p id="43cef307-7271-4f56-b8d5-0a7bf657126b" class="">项目使用了内置了swagger自动api文档说明，启动后查看，便于后续分析调用。</p><p id="eb4a304c-d7d8-4e4b-8aae-ab23ed9b7f5b" class=""><a href="http://localhost:9080/swagger-ui/index.html">http://localhost:9080/swagger-ui/index.html</a></p><figure id="48fb691d-0218-4cbe-b257-71618be5e333" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2020.png"><img style="width:708px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2020.png"/></a></figure><figure id="80bdb03e-73ad-4eec-826c-01e201d19a1b" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2021.png"><img style="width:708px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2021.png"/></a></figure><figure id="7dd08b36-59b0-4ece-8621-7c96060093b4" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2022.png"><img style="width:708px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2022.png"/></a></figure><p id="a4628455-0333-4595-b2e4-d29073b1a6a7" class="">框架结构：</p><figure id="deb0d342-3e8d-4c59-8b7f-775ec388ab2a" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2023.png"><img style="width:708px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2023.png"/></a></figure><p id="8c275c3d-7607-4f2a-a2f4-658086406242" class="">具体接口：</p><figure id="1db64b81-06f6-4deb-814d-56da298e2154" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2024.png"><img style="width:708px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2024.png"/></a></figure><figure id="33678ccc-e74f-4433-a57c-7755153dae3e" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2025.png"><img style="width:978px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2025.png"/></a></figure><h3 id="ce9d89a3-39b7-434a-a0ac-3985e11931dc" class="">导出</h3><p id="adf12702-2351-4987-b0f1-584bd0b9fddf" class="">API文档导出</p><figure id="eda56ec6-9212-4e68-8d00-f794c09116b4"><a href="https://segmentfault.com/a/1190000044881763" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">segmentfault.com</div></div><div class="bookmark-href">https://segmentfault.com/a/1190000044881763</div></div></a></figure><figure id="bf7da4a3-4fb7-4d46-a8f0-e0b780c98ddc"><a href="http://localhost:9080/v3/api-docs" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">http://localhost:9080/v3/api-docs</div></div><div class="bookmark-href">http://localhost:9080/v3/api-docs</div></div></a></figure><figure id="0565d5ef-83ae-4795-bd88-624fe3d95e03"><div class="source"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Swagger_API.html">Swagger API.html</a></div></figure><h1 id="75372289-c070-4fd6-b3af-3e81b148824c" class="">7. 测试和验证</h1><h2 id="a5d3ae20-05bc-44d7-aa16-6eb800323cb9" class="">7.1 LLM配置验证</h2><p id="41199efb-ac9e-44bc-8868-a5b4e84aae99" class="">使用简单对话”来闲聊“直接验证即可</p><figure id="c9e24f85-ca03-4fb0-8de1-4c6a32443d53"><a href="https://supersonicbi.github.io/docs/系统部署/配置llm/" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">配置LLM</div><div class="bookmark-description">配置LLM # Chat Model # SuperSonic可以从两个粒度配置Chat Model： 1. 系统粒度 # 1.2.修改langchain4j.yaml配置文件方式 # 从0.9.4版本开始，langchain4j配置从application.yaml文件中单独抽取，方便用户配置；以langchain4j-local.yaml为例配置： 目前支持：open-ai、ollama两种方式； 1、open_ai 用于连接云端模型；通常情况下各云上模型会兼容open-ai协议 2、ollama 用于连接本地模型；由ollama适配不同的模型 注意 推荐使用open_ai、ollama；其他azure、qianfan、dashscope、zhipu方式理论上也支持，但是待验证； open-ai 配置方式： langchain4j: open-ai: chat-model: base-url: ${OPENAI_API_BASE:demo} api-key: ${OPENAI_API_KEY:demo} model-name: ${OPENAI_MODEL_NAME:gpt-3.5-turbo} temperature: ${OPENAI_TEMPERATURE:0.0} timeout: ${OPENAI_TIMEOUT:PT60S} ollama 配置方式： langchain4j: ollama: chat-model: base-url: ${OPENAI_API_BASE:demo} api-key: ${OPENAI_API_KEY:demo} model-name: ${OPENAI_MODEL_NAME:gpt-3.5-turbo} temperature: ${OPENAI_TEMPERATURE:0.0} timeout: ${OPENAI_TIMEOUT:PT60S} azure 配置方式： langchain4j: azure-open-ai: chat-model: endpoint: https://xxx.openai.azure.com/ api-key: xxxx deployment-name: gpt-35-turbo max-tokens: 500 注意 以下方式配置，待验证： zhipu 配置方式： langchain4j: zhipu: chat-model: base-url: base-url api-key: demo model-name: xxx temperature: 0.</div></div><div class="bookmark-href"><img src="https://supersonicbi.github.io/favicon.png" class="icon bookmark-icon"/>https://supersonicbi.github.io/docs/系统部署/配置llm/</div></div></a></figure><figure id="9aa16e47-5fba-44f8-a50c-abe95bd142b8" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2026.png"><img style="width:2507px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2026.png"/></a></figure><h2 id="1f182e22-2847-44c0-b82e-4977a7dad66a" class="">7.2 Mysql数据库验证</h2><figure id="7c1b60b2-0ae7-468b-8628-fc8611db2ebc"><a href="https://supersonicbi.github.io/docs/系统部署/配置db/" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">配置DB</div><div class="bookmark-description">配置DB # 注意 系统默认使用H2内存数据库, 重启后会丢失数据, 若需要替换为自己的MySQL, 请按以下进行配置. 1. 执行SQL脚本 # 初次配置DB请依次执行conf/db下schema-mysql.sql、 data-mysql.sql, 这两个脚本均为最新表结构 若是已配置过DB并部署好的服务, 可参考sql-update.sql, 这里会注明每次功能改动需要改动的表结构 2. 配置YAML文件 # conf下application-local.yaml中默认的DB配置为H2配置, 替换为自己的MySQL即可 spring: datasource: url: jdbc:mysql://localhost:3306/your_database?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false&amp;allowMultiQueries=true username: your_username password: your_password driver-class-name: com.mysql.jdbc.Driver</div></div><div class="bookmark-href"><img src="https://supersonicbi.github.io/favicon.png" class="icon bookmark-icon"/>https://supersonicbi.github.io/docs/系统部署/配置db/</div></div></a></figure><figure id="ef10a420-c941-474e-a608-46d524c5e0d1" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2027.png"><img style="width:708px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2027.png"/></a></figure><h2 id="e9ea3236-2721-474d-9617-80194a2a41f9" class="">7.3 大模型LLM输出验证</h2><figure id="97fb5e75-1c28-4cb9-8832-a14fa55336eb" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2028.png"><img style="width:708px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2028.png"/></a></figure><figure id="52a137ca-fcd9-49e6-8549-928945256a50" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2029.png"><img style="width:708px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2029.png"/></a></figure><figure id="477d31cb-34fc-4add-a5bb-b27fd978e280" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2030.png"><img style="width:708px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2030.png"/></a></figure><figure id="eb74f9bb-0363-4cb1-a14e-0930d3d67616" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2031.png"><img style="width:708px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2031.png"/></a></figure><figure id="1f3196e7-7973-4625-9caa-8bfefa83cc9b" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2032.png"><img style="width:708px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2032.png"/></a></figure><p id="14c668bb-d928-412c-804c-a4a3ba274009" class="">Schema + Few-shot + LLM解析：已经验证完毕</p><h1 id="f488256d-1079-4299-96b7-ba64f8a28f2e" class="">8. 常见问题与解决方案</h1><h2 id="1e34d064-3e45-489c-83ac-eb94e8deab0b" class="">8.1 常见疑问</h2><h3 id="2ba9036f-f539-438f-9204-24f8de6d2973" class="">官方FAQ?</h3><figure id="b401d72f-941c-4f02-8f3a-57569fb9c72c"><a href="https://supersonicbi.github.io/docs/faq/" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">FAQ</div><div class="bookmark-description">FAQ # 项目有没有体验的地址？ # A: Playground访问地址：http://117.72.46.148:9080 初始启动后为什么能显示DEMO问答对话？ # A: 为了便于快速体验，系统内置DEMO语义模型，且实现了基于规则的解析器，所以不需要大模型也可以进行问答对话。不过，规则解析器能力有限，推荐仅用于测试验证，生产使用还是需要大模型解析。 是否自带大模型服务？ # A: 项目内置langchain4j社区提供的demo API key，但单次请求openai大模型限制在1000 token，因而只能用于快速体验。要正常体验问答对话，请自行申请大模型服务。 支持哪些大模型服务？ # A: 当前主要支持兼容open_ai接口协议的大模型服务，比如GPT、GLM、DeepSeek、Qwen、Moonshot等。文心和混元正在验证中，敬请期待。 是否支持文本知识库？ # A: 当前主要聚焦于结构化数据的问答，文本数据将在未来版本加入支持。 是否支持多轮对话？ # A: 自0.9.2版本起已经支持多轮对话，但默认是关闭的，需要在助理配置里开启。 重启系统后为什么配置的助理/模型数据丢失了？ # A: 系统默认使用H2内存数据库，如果需要持久化存储需配置DB，参考文档 系统默认的账号和密码是什么？ # A: 系统默认创建的用户有admin, jack, tom, lucy, alice，密码都是：123456 如果要用我自己的数据进行测试，我至少需要经过哪些步骤 # A: 连接数据库 -&gt; 构造模型(创建指标和维度) -&gt; 组装数据集 -&gt; 创建助理和工具 是否可以提供接口供第三方应用调用？ # A: 可以，启动系统后查看swagger接口文档：http://localhost:9080/swagger-ui/index.html 有哪些国内的大模型服务对接？ # A: 当前我们验证过一些主流大模型服务，其申请链接如下表所示： 提供商 API申请链接 推荐模型 智谱AI https://open.bigmodel.cn/api/paas/v4 glm-4 阿里云 https://dashscope.aliyuncs.com/compatible-mode/v1 qwen-max 幻方 https://api.</div></div><div class="bookmark-href"><img src="https://supersonicbi.github.io/favicon.png" class="icon bookmark-icon"/>https://supersonicbi.github.io/docs/faq/</div></div></a></figure><ul id="bc790772-1ebd-4961-a705-ed893128d9b5" class="bulleted-list"><li style="list-style-type:disc"><a href="https://supersonicbi.github.io/docs/faq/#%E9%A1%B9%E7%9B%AE%E6%9C%89%E6%B2%A1%E6%9C%89%E4%BD%93%E9%AA%8C%E7%9A%84%E5%9C%B0%E5%9D%80">项目有没有体验的地址？</a></li></ul><ul id="dba6f5f0-8c80-4afe-8a19-6d171c554e27" class="bulleted-list"><li style="list-style-type:disc"><a href="https://supersonicbi.github.io/docs/faq/#%E5%88%9D%E5%A7%8B%E5%90%AF%E5%8A%A8%E5%90%8E%E4%B8%BA%E4%BB%80%E4%B9%88%E8%83%BD%E6%98%BE%E7%A4%BAdemo%E9%97%AE%E7%AD%94%E5%AF%B9%E8%AF%9D">初始启动后为什么能显示DEMO问答对话？</a></li></ul><ul id="384390e8-4fe0-4f7d-9d7f-027cd054ef6b" class="bulleted-list"><li style="list-style-type:disc"><a href="https://supersonicbi.github.io/docs/faq/#%E6%98%AF%E5%90%A6%E8%87%AA%E5%B8%A6%E5%A4%A7%E6%A8%A1%E5%9E%8B%E6%9C%8D%E5%8A%A1">是否自带大模型服务？</a></li></ul><ul id="eb64669e-12cb-4056-b6b6-d4bc7a63f1e9" class="bulleted-list"><li style="list-style-type:disc"><a href="https://supersonicbi.github.io/docs/faq/#%E6%94%AF%E6%8C%81%E5%93%AA%E4%BA%9B%E5%A4%A7%E6%A8%A1%E5%9E%8B%E6%9C%8D%E5%8A%A1">支持哪些大模型服务？</a></li></ul><ul id="2139e685-f56e-404a-afb7-50ab804c8645" class="bulleted-list"><li style="list-style-type:disc"><a href="https://supersonicbi.github.io/docs/faq/#%E6%98%AF%E5%90%A6%E6%94%AF%E6%8C%81%E6%96%87%E6%9C%AC%E7%9F%A5%E8%AF%86%E5%BA%93">是否支持文本知识库？</a></li></ul><ul id="95fb40b1-c15d-4ca5-9629-b9f6be1eeaee" class="bulleted-list"><li style="list-style-type:disc"><a href="https://supersonicbi.github.io/docs/faq/#%E6%98%AF%E5%90%A6%E6%94%AF%E6%8C%81%E5%A4%9A%E8%BD%AE%E5%AF%B9%E8%AF%9D">是否支持多轮对话？</a></li></ul><ul id="819e9ecb-079a-4f2c-a72f-dfb723d809a6" class="bulleted-list"><li style="list-style-type:disc"><a href="https://supersonicbi.github.io/docs/faq/#%E9%87%8D%E5%90%AF%E7%B3%BB%E7%BB%9F%E5%90%8E%E4%B8%BA%E4%BB%80%E4%B9%88%E9%85%8D%E7%BD%AE%E7%9A%84%E5%8A%A9%E7%90%86%E6%A8%A1%E5%9E%8B%E6%95%B0%E6%8D%AE%E4%B8%A2%E5%A4%B1%E4%BA%86">重启系统后为什么配置的助理/模型数据丢失了？</a></li></ul><ul id="61d5df2a-f564-4df2-91bb-95fc3cd21c37" class="bulleted-list"><li style="list-style-type:disc"><a href="https://supersonicbi.github.io/docs/faq/#%E7%B3%BB%E7%BB%9F%E9%BB%98%E8%AE%A4%E7%9A%84%E8%B4%A6%E5%8F%B7%E5%92%8C%E5%AF%86%E7%A0%81%E6%98%AF%E4%BB%80%E4%B9%88">系统默认的账号和密码是什么？</a></li></ul><ul id="c4e38f74-1d31-4d9b-a29e-20cad56cbbde" class="bulleted-list"><li style="list-style-type:disc"><a href="https://supersonicbi.github.io/docs/faq/#%E5%A6%82%E6%9E%9C%E8%A6%81%E7%94%A8%E6%88%91%E8%87%AA%E5%B7%B1%E7%9A%84%E6%95%B0%E6%8D%AE%E8%BF%9B%E8%A1%8C%E6%B5%8B%E8%AF%95%E6%88%91%E8%87%B3%E5%B0%91%E9%9C%80%E8%A6%81%E7%BB%8F%E8%BF%87%E5%93%AA%E4%BA%9B%E6%AD%A5%E9%AA%A4">如果要用我自己的数据进行测试，我至少需要经过哪些步骤</a></li></ul><ul id="321941fe-e3c2-42d3-8b10-6f56250e47cb" class="bulleted-list"><li style="list-style-type:disc"><a href="https://supersonicbi.github.io/docs/faq/#%E6%98%AF%E5%90%A6%E5%8F%AF%E4%BB%A5%E6%8F%90%E4%BE%9B%E6%8E%A5%E5%8F%A3%E4%BE%9B%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%94%E7%94%A8%E8%B0%83%E7%94%A8">是否可以提供接口供第三方应用调用？</a></li></ul><ul id="50a3f437-f208-4345-9b22-80190054aeba" class="bulleted-list"><li style="list-style-type:disc"><a href="https://supersonicbi.github.io/docs/faq/#%E6%9C%89%E5%93%AA%E4%BA%9B%E5%9B%BD%E5%86%85%E7%9A%84%E5%A4%A7%E6%A8%A1%E5%9E%8B%E6%9C%8D%E5%8A%A1%E5%AF%B9%E6%8E%A5">有哪些国内的大模型服务对接？</a></li></ul><ul id="e3aa31f2-a70a-4dd2-a73b-c73f8339d992" class="bulleted-list"><li style="list-style-type:disc"><a href="https://supersonicbi.github.io/docs/faq/#%E8%AF%AD%E4%B9%89%E6%A8%A1%E5%9E%8B%E5%92%8C%E6%95%B0%E6%8D%AE%E9%9B%86%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB">【语义模型】和【数据集】有什么区别？</a></li></ul><ul id="cac5ce23-7ed6-413d-bc92-76bcf9c37c6e" class="bulleted-list"><li style="list-style-type:disc"><a href="https://supersonicbi.github.io/docs/faq/#%E6%98%AF%E5%90%A6%E5%8F%AF%E4%BB%A5%E5%AE%9A%E5%88%B6few-shot%E7%A4%BA%E4%BE%8B">是否可以定制few-shot示例？</a></li></ul><ul id="248a6c44-9243-4674-a250-c76f04699f5d" class="bulleted-list"><li style="list-style-type:disc"><a href="https://supersonicbi.github.io/docs/faq/#%E4%BD%BF%E7%94%A8ollama%E6%97%B6%E9%97%AE%E7%AD%94%E5%87%BA%E7%8E%B0%E5%9C%A8python%E4%B8%ADxxxx%E7%9A%84%E5%A6%82%E4%B8%8B%E5%9B%BE%E9%94%99%E8%AF%AF">使用ollama时，问答出现&quot;在Python中xxxx&quot;的如下图错误？</a></li></ul><h3 id="29507826-5566-467e-aa11-4a88553de7d1" class="">S2SQL歧义指正？</h3><p id="1fd6faaa-3187-48f7-8023-c385a7621769" class="">一般意义上S2SQL指<a href="https://www.notion.so/cae82e2fe6a24c49931c385191cfbf66?pvs=21">阿里巴巴Text2SQL模型</a>，主要指代的是Question-Schema interaction graph Encoder使用的是传统意义上的深度学习神经网络模型，但是进行了编译器结构优化和效率。</p><figure id="a93525dc-9483-4eb2-abad-582d13d60092" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2033.png"><img style="width:356px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2033.png"/></a></figure><p id="73712b1e-f605-4c29-8200-ebe00213d985" class="">此处对于说明文档中的S2SQL个人判断不是一个概念，更可能的解释是Structured to SQL，在此仅仅只是名字重合。</p><p id="afc520ac-7507-4930-b08b-236ad782a411" class="">&quot;Structured to SQL&quot;的意思是将结构化的查询语句或数据转换为SQL语句。这个过程包括从文本或语句中解析出维度、维度值和指标等信息，并构造成一个初始的SQL查询（S2SQL），然后经过修正和优化，最终生成可以在数据库引擎上执行的SQL代码。</p><p id="d8bd9c32-3bcd-44ff-839b-9a670bc261ee" class="">这个解析和转换过程在数据库查询、报表生成、数据分析等领域非常常见，旨在自动化地将用户输入的结构化或半结构化数据转换为可执行的SQL查询，从而简化用户与数据库的交互。</p><h3 id="d40dc298-8179-422e-9b02-31fd4c92435a" class="">项目中数据集指代什么？</h3><figure id="aeab0b48-a105-4a04-a2ab-4c61c86cf478" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2034.png"><img style="width:576px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2034.png"/></a></figure><p id="b4aa52aa-3ae0-484b-9887-5a2476f86059" class="">数据集指代概念就是数据库概念中一样，但是supersonic项目中想要使用数据集比较繁琐，需要经过：</p><p id="3d560659-a081-4067-8b68-5bf5e725c911" class="">1、数据库连接（目前发现必须指定具体数据库）</p><figure id="89a81a1c-c4af-4cba-8988-be61bc2b0543" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2035.png"><img style="width:1056px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2035.png"/></a></figure><p id="20bcf4e9-478a-46da-8fd7-d0ad44fdbf6f" class="">2、语义建模（选择连接数据库，添加所需表，数据建模连接相关表，添加便于后续查询的标签对象，最后再进行权限管理）</p><figure id="d9af825f-4a11-4a0e-9e75-c4661843b7c6" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2036.png"><img style="width:708px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2036.png"/></a></figure><figure id="8c04ddf0-3ca3-48af-b3ae-3edb8be2d7fb" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2037.png"><img style="width:2480px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2037.png"/></a></figure><p id="547fe0b8-956d-48ef-b712-d47565776ab0" class="">3、助手设置（进入工具管理，指定数据集，但测试下来发现不指定即默认情况下会关联所有可能的数据模型）</p><figure id="d4224e14-04c2-4ca4-828e-d939b9635e2f" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2038.png"><img style="width:2520px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2038.png"/></a></figure><p id="92a6f0e9-578e-4d65-ace7-c739714648b9" class="">
</p><ul id="d1b6bc71-b5d0-45b8-9eb4-36867b263792" class="bulleted-list"><li style="list-style-type:disc"><strong>连接问题（可行性分析）：</strong></li></ul><figure id="9fe2c127-3375-4481-8fac-76d1fe80c1da" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2039.png"><img style="width:708px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2039.png"/></a></figure><p id="8b78793c-a028-4475-ab6a-511a1bb9a602" class=""><strong><span style="border-bottom:0.05em solid">官方教程指定了数据库，所以可能针对每一个数据库都要单独创建连接</span></strong></p><p id="06406dca-1118-4419-8700-9341514ebd42" class="">在JDBC连接字符串中，通常会指定一个默认的数据库名称，这样在连接到数据库服务器后，所有操作都会在这个默认数据库中进行。在你的连接字符串中，<code>sakila</code>是默认的数据库：</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="d87b3c51-f8b9-4b7d-b438-ed2409a3dfc5" class="code"><code class="language-Shell" style="white-space:pre-wrap;word-break:break-all">jdbc:mysql://localhost:3306/sakila?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false&amp;allowMultiQueries=true</code></pre><p id="33eb900f-f5fd-4da2-83a3-aa00f3408c77" class="">如果你想连接到MySQL服务器而不指定默认的数据库，可以省略数据库名称。这样你可以在连接后选择要使用的数据库，或者在每个SQL查询中显式指定数据库名称。修改后的连接字符串如下：</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="dba10501-0ab2-4c21-a7e1-d7c4c2481734" class="code"><code class="language-Ruby" style="white-space:pre-wrap;word-break:break-all">jdbc:mysql://localhost:3306/?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false&amp;allowMultiQueries=true</code></pre><p id="9486f4ac-79aa-46fe-a350-d5f2aa141b9b" class="">在这种情况下，你需要在每个SQL查询中指定数据库，或者在连接后选择数据库。例如：</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="3c1358ff-6db2-4abf-8f56-c55bd3fb4899" class="code"><code class="language-Java" style="white-space:pre-wrap;word-break:break-all">Connection connection = DriverManager.getConnection(&quot;jdbc:mysql://localhost:3306/?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false&amp;allowMultiQueries=true&quot;, &quot;username&quot;, &quot;password&quot;);

// 选择数据库
Statement statement = connection.createStatement();
statement.execute(&quot;USE sakila&quot;);

// 执行查询
ResultSet resultSet = statement.executeQuery(&quot;SELECT * FROM sakila.film&quot;);</code></pre><p id="75c96db7-2d3d-4111-96d4-7f1741190809" class="">或者你可以在每个查询中显式指定数据库名称：</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="5c5800d5-a57f-4187-84af-af428fe78636" class="code"><code class="language-Java" style="white-space:pre-wrap;word-break:break-all">ResultSet resultSet = statement.executeQuery(&quot;SELECT * FROM sakila.film&quot;);</code></pre><p id="dc75d6bc-6b21-4da3-a571-8df6c4c555c7" class="">这样，你的连接将不再限制在一个特定的数据库中，你可以在代码中灵活地选择和切换数据库。</p><h3 id="83e081d7-326a-46bf-8c5e-9e2d11295b49" class="">语义解析是什么？</h3><p id="7a178dca-302c-4eae-957f-25467e0a2f0e" class="">指的是LLM模块中，用于生成的增强问题代码，会根据之前所说的语义建模中的标签信息，加上表单中解析出来的内容Schema等进行说明。例如添加了”部门“指标：代码解析出了HR在表单中属于这个类，则会在问题增强中对大模型进行说明（“HR”是一个“部门”），这样可以让大模型更好的理解问题的结构和内容，达到增强问题的目的。</p><h3 id="992a40a4-702f-4bc5-af4f-47021d6fc076" class="">一致性投票是如何进行的？</h3><p id="5025262e-2c19-43e3-b4fc-be5bed39bca1" class=""><a href="https://www.notion.so/cae82e2fe6a24c49931c385191cfbf66?pvs=21">需要代码解析</a>：<code>ResponseHelper.selfConsistencyVote</code></p><figure id="298101ac-bff3-4b9f-b8a6-94a5885c6a14" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2040.png"><img style="width:2421px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2040.png"/></a></figure><p id="59b90cca-8b3f-48e9-a5ce-6576580ce609" class="">使用场景：generate函数 <span style="border-bottom:0.05em solid">分析：</span></p><ol type="1" id="21a58804-31cc-4116-be99-1c1315d0bfaa" class="numbered-list" start="1"><li><strong>召回示例（exemplars）</strong><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="8489c57b-00e0-4aff-b6ed-0619358ff9be" class="code"><code class="language-Java" style="white-space:pre-wrap;word-break:break-all">List&lt;List&lt;SqlExemplar&gt;&gt; exemplarsList = promptHelper.getFewShotExemplars(llmReq);</code></pre><p id="0571bda3-837d-4333-a7c9-d61ac4a56ec9" class="">这一步从 <code>promptHelper</code> 中获取示例列表，每个列表包含多个 <code>SqlExemplar</code>。这些示例是用于生成SQL查询的参考示例。</p></li></ol><ol type="1" id="339fcb86-25eb-42dd-8442-e6f42cd23b54" class="numbered-list" start="2"><li><strong>为每个自一致性推断生成SQL生成提示</strong><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="6b825866-0544-440d-9748-9ad15e56d617" class="code"><code class="language-Java" style="white-space:pre-wrap;word-break:break-all">Map&lt;Prompt, List&lt;SqlExemplar&gt;&gt; prompt2Exemplar = new HashMap&lt;&gt;();
for (List&lt;SqlExemplar&gt; exemplars : exemplarsList) {
    Prompt prompt = generatePrompt(llmReq, exemplars);
    prompt2Exemplar.put(prompt, exemplars);
}</code></pre><p id="834194c7-7279-4977-a16f-78b2049263c6" class="">为每个示例生成一个 <code>Prompt</code> 对象，并将其与示例关联起来。<code>Prompt</code> 对象是用于生成SQL查询的提示信息。</p></li></ol><ol type="1" id="d2ed99c5-22b0-4aa0-a2f6-ddde8534fd2f" class="numbered-list" start="3"><li><strong>并行执行多个自一致性推断</strong><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="6e5f08ae-899b-4f8b-9b22-4c108dadfdd1" class="code"><code class="language-Java" style="white-space:pre-wrap;word-break:break-all">Map&lt;Prompt, String&gt; prompt2Output = new ConcurrentHashMap&lt;&gt;();
prompt2Exemplar.keySet().parallelStream().forEach(prompt -&gt; {
    keyPipelineLog.info(&quot;OnePassSCSqlGenStrategy reqPrompt:\n{}&quot;, prompt.toUserMessage());
    ChatLanguageModel chatLanguageModel = getChatLanguageModel(llmReq.getLlmConfig());
    Response&lt;AiMessage&gt; response = chatLanguageModel.generate(prompt.toUserMessage());
    String result = response.content().text();
    prompt2Output.put(prompt, result);
    keyPipelineLog.info(&quot;OnePassSCSqlGenStrategy modelResp:\n{}&quot;, result);
});</code></pre><p id="212b311c-ef31-463b-86ea-666500eef529" class="">并行执行多个自一致性推断，即并行调用大模型生成SQL查询，并将每个 <code>Prompt</code> 生成的SQL查询存储在 <code>prompt2Output</code> 中。</p></li></ol><ol type="1" id="bbd26aed-ced5-4f7f-93c6-910605c23e60" class="numbered-list" start="4"><li><strong>记录 </strong><code><strong>prompt2Output</strong></code><strong> 的内容</strong><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="7371326b-2e58-46c7-9970-fba92e45a00f" class="code"><code class="language-Java" style="white-space:pre-wrap;word-break:break-all">prompt2Output.forEach((prompt, result) -&gt; {
    keyPipelineLog.info(&quot;Prompt: {}\nResult: {}&quot;, prompt, result);
});</code></pre><p id="deed0c9a-4fd3-4f3e-960e-2d428a48a4fa" class="">这一步用于记录每个 <code>Prompt</code> 及其生成的结果，方便调试和分析。</p></li></ol><ol type="1" id="866fae83-fd53-4564-928a-555b8e1fb9e6" class="numbered-list" start="5"><li><strong>格式化响应</strong><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="49f0e711-dc17-4b5a-9904-1acdcddfd72b" class="code"><code class="language-Java" style="white-space:pre-wrap;word-break:break-all">Pair&lt;String, Map&lt;String, Double&gt;&gt; sqlMapPair = ResponseHelper.selfConsistencyVote(Lists.newArrayList(prompt2Output.values()));
LLMResp llmResp = new LLMResp();
llmResp.setQuery(promptHelper.buildAugmentedQuestion(llmReq));
llmResp.setDbSchema(promptHelper.buildSchemaStr(llmReq));
llmResp.setSqlOutput(sqlMapPair.getLeft());
llmResp.setSqlRespMap(ResponseHelper.buildSqlRespMap(exemplarsList.get(0), sqlMapPair.getRight()));</code></pre><p id="0bf44c48-e912-4446-95b3-195344f22410" class="">这一步包括以下内容：</p><ul id="c48a39c5-7cdb-4027-ba02-e264654064af" class="bulleted-list"><li style="list-style-type:disc">调用 <code>ResponseHelper.selfConsistencyVote</code> 方法进行投票，选择最有可能正确的SQL查询。</li></ul><ul id="f96a0516-220b-4df2-9a8a-81fd0fb83bf0" class="bulleted-list"><li style="list-style-type:disc">使用 <code>promptHelper</code> 构建增强问题和数据库架构字符串。</li></ul><ul id="d619e70c-d694-40a9-83b0-4ad1a1cc5444" class="bulleted-list"><li style="list-style-type:disc">将投票选出的SQL查询设置为响应的 <code>sqlOutput</code>。</li></ul><ul id="3065f446-4e51-43c6-a86c-4b16bb4992eb" class="bulleted-list"><li style="list-style-type:disc">构建SQL响应映射，并设置为响应的 <code>sqlRespMap</code>。</li></ul></li></ol><p id="aa6e79fa-7614-47be-b01b-4a5d87ea02df" class=""><strong><span style="border-bottom:0.05em solid">自一致性投票机制的具体实现</span></strong></p><ol type="1" id="44f7e669-3ba1-47d1-a4a8-b080bc92ad25" class="numbered-list" start="1"><li><strong>从 </strong><code><strong>prompt2Output</strong></code><strong> 中获取所有生成的SQL查询</strong><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="afbdb09c-b304-4995-999a-09bf1bb42cb3" class="code"><code class="language-Java" style="white-space:pre-wrap;word-break:break-all">Pair&lt;String, Map&lt;String, Double&gt;&gt; sqlMapPair = ResponseHelper.selfConsistencyVote(Lists.newArrayList(prompt2Output.values()));</code></pre><p id="59f541f5-96a9-4bb7-92c5-fa602ce5e492" class="">这一步调用 <code>ResponseHelper.selfConsistencyVote</code> 方法，对所有生成的SQL查询进行投票。传入的参数是 <code>prompt2Output</code> 中所有的SQL查询。</p></li></ol><ol type="1" id="cf43a0b6-dea5-4415-afab-b4b5362d98eb" class="numbered-list" start="2"><li><strong>统计每个SQL查询的出现次数</strong><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="ab820727-7740-4194-803b-2aade799b65a" class="code"><code class="language-Java" style="white-space:pre-wrap;word-break:break-all">Map&lt;String, Integer&gt; inputCounts = new HashMap&lt;&gt;();
for (String input : outputList) {
    inputCounts.put(input, inputCounts.getOrDefault(input, 0) + 1);
}</code></pre><p id="5aca6b36-3f7c-4ec1-97e7-035fb7ad5268" class="">在 <code>selfConsistencyVote</code> 方法中，首先统计每个SQL查询的出现次数。使用一个 <code>HashMap</code> 来存储每个SQL查询的出现次数。</p></li></ol><ol type="1" id="052ea7fc-4a8a-4044-a07d-0bae6d391fb0" class="numbered-list" start="3"><li><strong>确定出现次数最多的SQL查询</strong><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="65072c51-b53a-4708-9ede-bb0dfc795915" class="code"><code class="language-Java" style="white-space:pre-wrap;word-break:break-all">String inputMax = null;
int maxCount = 0;
int inputSize = outputList.size();
Map&lt;String, Double&gt; votePercentage = new HashMap&lt;&gt;();
for (Map.Entry&lt;String, Integer&gt; entry : inputCounts.entrySet()) {
    String input = entry.getKey();
    int count = entry.getValue();
    if (count &gt; maxCount) {
        inputMax = input;
        maxCount = count;
    }
    double percentage = (double) count / inputSize;
    votePercentage.put(input, percentage);
}</code></pre><p id="3f5c35e6-8113-4974-8e0b-f8c97a69f456" class="">遍历 <code>inputCounts</code>，找出出现次数最多的SQL查询（<code>inputMax</code>），并计算每个SQL查询的出现次数占总数的百分比（<code>votePercentage</code>）。</p></li></ol><ol type="1" id="8d4f37eb-cf31-44b1-8356-144d1cc47593" class="numbered-list" start="4"><li><strong>返回结果</strong><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1e54daae-cc40-4241-bf28-f2ef94ad6b5f" class="code"><code class="language-Java" style="white-space:pre-wrap;word-break:break-all">return Pair.of(inputMax, votePercentage);</code></pre><p id="2a054967-562f-42a1-9b11-ac8c101f66b0" class="">最后返回出现次数最多的SQL查询及每个SQL查询的投票百分比。</p></li></ol><figure id="8c0c1176-98bd-433c-b9dd-20495c7b70c1" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2041.png"><img style="width:708px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2041.png"/></a></figure><p id="4f73b426-0a60-4494-9765-78c721dd0a54" class="">这个方法用于对多个SQL查询候选进行投票，选择出现次数最多的SQL查询作为最终结果。具体步骤如下：</p><ul id="5a6ee6c2-2492-44e2-90db-f0ab7b534e2e" class="bulleted-list"><li style="list-style-type:disc"><strong>计数每个SQL查询的出现次数</strong>：使用一个 <code>Map&lt;String, Integer&gt;</code> 来存储每个SQL查询的出现次数。</li></ul><ul id="df04bf3e-b53e-48a6-afb0-8da58a6035ac" class="bulleted-list"><li style="list-style-type:disc"><strong>确定出现次数最多的SQL查询</strong>：遍历 <code>inputCounts</code>，找出出现次数最多的SQL查询（<code>inputMax</code>）。</li></ul><ul id="ab7d84c8-28cc-43b2-b70a-7249d17d0347" class="bulleted-list"><li style="list-style-type:disc"><strong>计算每个SQL查询的投票百分比</strong>：计算每个SQL查询的出现次数占总数的百分比，并存储在 <code>votePercentage</code> 中。</li></ul><ul id="154d1fae-f03d-4f6d-a215-72c0f2a32cce" class="bulleted-list"><li style="list-style-type:disc"><strong>返回结果</strong>：返回出现次数最多的SQL查询及每个SQL查询的投票百分比。</li></ul><p id="a1b59ee0-06cf-47db-b71b-27a1976cbfe6" class=""><strong><span style="border-bottom:0.05em solid">投票机制的实现</span></strong></p><ul id="8ad474a8-baf9-4b0b-8fcd-5e2a3c3defb5" class="bulleted-list"><li style="list-style-type:disc"><strong>投票的对象</strong>：多个由大模型生成的SQL查询候选。</li></ul><ul id="b7e678d6-9802-41a2-a2c0-2895aa8e25fc" class="bulleted-list"><li style="list-style-type:disc"><strong>投票的过程</strong>：通过统计每个SQL查询在候选列表中的出现次数，来确定最常出现的SQL查询。这个过程在 <code>selfConsistencyVote</code> 方法中实现。</li></ul><ul id="84ad4f4e-ed4a-4460-9e5a-acbba687b4f9" class="bulleted-list"><li style="list-style-type:disc"><strong>投票的标准</strong>：标准是SQL查询的出现次数，出现次数最多的SQL查询被认为是最可能正确的查询。</li></ul><p id="77d21bcb-6fd2-4511-ab06-c274321c89c3" class="">总结而言：就是简单粗暴选择出现最多的那个SQL查询语句</p><p id="1624a0a1-6aff-42ea-ab41-8995c65f1872" class="">
</p><h2 id="5661688f-f4ec-416f-843a-72cf7021c54f" class="">8.2 故障排查</h2><h3 id="368f25cf-f214-4e98-bec9-60c8e5dc0af8" class="">编译bug修正</h3><figure id="9bf3d7f7-5446-4959-90d1-b9b22accff1b" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2042.png"><img style="width:2433px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2042.png"/></a></figure><p id="5f017672-be51-48ca-8218-8c51b47947c2" class="">impl改大写：<code>package com.tencent.supersonic.auth.authentication.persistence.repository.Impl;</code></p><p id="a5cd4266-5c0b-4932-9bbf-37c0b58904de" class="">
</p><h3 id="52099e58-1149-4fa6-b0a1-a9cb8b8501bf" class="">数据库连接bug修正</h3><figure id="04cc48b4-4544-4c79-9e6b-66e624fa27df" class="image"><a href="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2043.png"><img style="width:1392px" src="SuperSonic%20%E5%88%86%E6%9E%90%E6%96%87%E6%A1%A3%204c6b9ed87a8146b78a51419e54e7b612/Untitled%2043.png"/></a></figure><p id="51e0467d-ae84-4bfd-a289-24b61bac1b64" class="">由于 MySQL 的连接配置中，<code>Public Key Retrieval is not allowed</code> 造成。该问题通常与 MySQL 8.0+ 版本中的新安全功能有关，需要进行以下配置调整：<div class="indented"><p id="d3847eff-6841-460a-b10a-65869afb310e" class="">解决方法：</p></div></p><ol type="1" id="c242fd2b-ae37-4020-8f10-8df45212388c" class="numbered-list" start="1"><li><strong>修改 JDBC URL</strong>：<br/>在 JDBC URL 中添加 <br/><code>allowPublicKeyRetrieval=true</code> 参数。例如：<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="a688d249-6c6f-4548-8867-954ea88e77a0" class="code"><code class="language-YAML" style="white-space:pre-wrap;word-break:break-all">jdbc:mysql://localhost:3306/supersonic?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false&amp;allowMultiQueries=true&amp;allowPublicKeyRetrieval=true

</code></pre></li></ol><ol type="1" id="d490cc10-7694-45e5-a457-e38ff0c9fa37" class="numbered-list" start="2"><li><strong>修改 MySQL 配置</strong>：<br/>如果你有权限修改 MySQL 服务器配置，可以在 MySQL 配置文件（通常是 <br/><code>my.cnf</code> 或 <code>my.ini</code>）中添加以下内容：<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="0243c766-e794-48e5-b211-9804804033f7" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">caching_sha2_password=off</code></pre></li></ol><h3 id="a9c64795-73d2-45d5-9537-3380d3bbc6ef" class="">无影响-JWT报错</h3><p id="5b6d1cb5-e86d-446d-a338-31bf1be6e026" class="">系统在尝试验证 JWT (JSON Web Token) 时遇到了令牌过期的问题。具体错误信息是 <code>io.jsonwebtoken.ExpiredJwtException: JWT expired</code>，这意味着当前时间已经超过了令牌的有效期。</p><p id="108f331f-6101-45de-936e-ecf6ebda62da" class=""><strong>解决方法：</strong></p><ol type="1" id="333afe23-498d-4094-a838-e41a4601b2e6" class="numbered-list" start="1"><li><strong>刷新令牌</strong>：确保令牌在有效期内，可以通过刷新令牌来延长其有效期。</li></ol><ol type="1" id="720abef9-2f4a-4578-90a1-64f5af7e6d22" class="numbered-list" start="2"><li><strong>增加时钟偏差</strong>：在验证 JWT 时增加一个允许的时钟偏差 (clock skew)，这样可以允许一些时间偏差。如下是一个示例：<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="338b0d3c-ac75-4e70-abc2-499643507072" class="code"><code class="language-Java" style="white-space:pre-wrap;word-break:break-all">Jwts.parser()
    .setAllowedClockSkewSeconds(60)  // 允许60秒的时钟偏差
    .setSigningKey(secretKey)
    .parseClaimsJws(token);

</code></pre></li></ol><ol type="1" id="2619e8be-ceb0-426a-9952-5641429adce5" class="numbered-list" start="3"><li><strong>检查服务器时间</strong>：确保服务器的系统时间是正确且同步的，避免因为服务器时间不准确导致的 JWT 过期错误。</li></ol><ol type="1" id="284416b6-a6db-4025-b87e-eb141a1045d5" class="numbered-list" start="4"><li><strong>处理令牌过期的逻辑</strong>：在应用中增加对令牌过期的处理逻辑，例如引导用户重新登录或者自动刷新令牌。</li></ol><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="0c5c61e9-4a36-4cca-bb85-f8a523d4b16b" class="code"><code class="language-Java" style="white-space:pre-wrap;word-break:break-all">try {
    Claims claims = Jwts.parser()
                        .setAllowedClockSkewSeconds(60)  // 允许60秒的时钟偏差
                        .setSigningKey(secretKey)
                        .parseClaimsJws(token)
                        .getBody();
    // 处理成功解析的令牌
} catch (ExpiredJwtException e) {
    // 处理令牌过期的情况，例如引导用户重新登录
    throw new CustomException(&quot;Token has expired&quot;, e);
}</code></pre><p id="2e6d22ca-75d5-4119-afdc-c006c51f2f23" class="">
</p></div></article><span class="sans" style="font-size:14px;padding-top:2em"></span></body></html>